<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-06-13 Tue 16:04 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CodeAcademy Flask</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="DESKTOP-AUDMJ7D" />
<meta name="description" content="CodeAcademy Flask notes"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<head> <meta charset="UTF-8"> <meta name="description" content="CodeAcademy Python notes"> <link rel="alternate" type="application/rss+xml" href="https://arvydasg.github.io/rss.xml" title="RSS feed for https://arvydasg.github.io/"> <title>CodeAcademy Python</title> <!-- Google Tag Manager --> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-MC4ZQHP');</script> <!-- End Google Tag Manager --> <meta name="author" content="Arvydas Gasparavicius"> <meta name="referrer" content="no-referrer"> <meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1"><link href= "../style-lightbox.css" rel="stylesheet" type="text/css" /> <link href= "../readtheorg.css" rel="stylesheet" type="text/css" /> <script src="../lightbox.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" /> <script src="static/lightbox.js"></script> <script src="static/auto-render.min.js"></script> <link rel="icon" href="static/ag.ico"></head>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<body>

<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MC4ZQHP"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <nav class="text-center navbar navbar-expand-lg navbar-light bg-light">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div style="justify-content:center" class="collapse navbar-collapse " id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="https://arvydas.dev/codeacademy/">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://arvydas.dev/codeacademy/html_css/index.html">HTML/CSS</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://arvydas.dev/codeacademy/javascript/index.html">JavaScript</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="https://arvydas.dev/codeacademy/python/index.html">Python</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active " href="https://arvydas.dev/codeacademy/databases/index.html">Databases</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="https://arvydas.dev/codeacademy/flask/index.html">Flask</a>
                    </li>
                </ul>
            </div>
    </nav>
</div>
<div id="content">
<h1 class="title">CodeAcademy Flask</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3c40a99">1. Įžanga į Flask</a>
<ul>
<li><a href="#org748a5f0">1.1. Kaip sukurti minimalią svetainę:</a></li>
<li><a href="#orgca323f6">1.2. Kaip puslapyje atvaizduoti įvestą kintamąjį:</a></li>
<li><a href="#org75ce9e8">1.3. Kaip sukurti ir panaudoti HTML šabloną:</a></li>
<li><a href="#org8f3b222">1.4. Kaip kintamuosius perkelti į šabloną:</a></li>
<li><a href="#orgf8cf79f">1.5. Kaip perduoti duomenis iš svetainės į programą:</a></li>
<li><a href="#orga72b380">1.6. Naudojame base.html šabloną:</a></li>
<li><a href="#org5153e24">1.7. Stiliui panaudojame "Bootstrap":</a></li>
<li><a href="#orgdc933df">1.8. Užduotys</a></li>
</ul>
</li>
<li><a href="#orgda1355b">2. Flask 1 dalis</a>
<ul>
<li><a href="#org055bc75">2.1. Susikurkime paprastą flask aplikaciją</a></li>
</ul>
</li>
<li><a href="#org5a187cf">3. Flask 2 dalis</a>
<ul>
<li><a href="#org76e840e">3.1. Dinaminiai maršrutai ir formos</a></li>
<li><a href="#orge7f5c20">3.2. Uzduotis</a></li>
</ul>
</li>
<li><a href="#orgc2878d2">4. Flask 3 dalis</a>
<ul>
<li><a href="#org8cabfdc">4.1. Duomenų bazės sukūrimas</a></li>
<li><a href="#orgff122dc">4.2. Duomenų bazės migracija</a></li>
<li><a href="#org83b7e62">4.3. Uzduotis</a></li>
</ul>
</li>
<li><a href="#org728174a">5. Flask 4 dalis</a>
<ul>
<li><a href="#org6b06b70">5.1. One2Many</a></li>
<li><a href="#orgdefe961">5.2. Many2Many</a></li>
<li><a href="#org4147a0e">5.3. Many2One ryšio įgyvendinimas su Flask</a></li>
<li><a href="#org255ea38">5.4. One2Many ryšio įgyvendinimas su Flask</a></li>
<li><a href="#orgf749f51">5.5. Many2Many ryšio įgyvendinimas su Flask</a></li>
</ul>
</li>
<li><a href="#org96a6a13">6. REST API kūrimas su Flask</a>
<ul>
<li><a href="#org25402e4">6.1. REST API su Flask</a></li>
<li><a href="#org9a9a9a8">6.2. REST API su duomenų baze kūrimas</a></li>
<li><a href="#org4da5942">6.3. Užduotis: Flask API</a></li>
</ul>
</li>
<li><a href="#org4a0174b">7. Vartotojų registravimas ir prisijungimas</a>
<ul>
<li><a href="#orgfdde649">7.1. Registracija</a></li>
<li><a href="#orgb6a2306">7.2. Prisijungimas</a></li>
<li><a href="#orgd4636e7">7.3. Vartotojo turinys</a></li>
<li><a href="#orgea831d8">7.4. Užduotis: Biudžeto programa su vartotojais</a></li>
</ul>
</li>
<li><a href="#org8cb324e">8. Nuotraukos pridėjimas, admin puslapis, puslapiavimas</a>
<ul>
<li><a href="#org5657c91">8.1. Paskyros nuotraukos pridėjimas ir paskyros redagavimo puslapis</a></li>
<li><a href="#org834716d">8.2. Admin puslapis</a></li>
<li><a href="#orgdafa3f2">8.3. Įrašų puslapiavimas svetainėje</a></li>
<li><a href="#org1eb48de">8.4. Užduotis: Biudžeto programa su nuotraukomis, admin ir puslapiavimu</a></li>
</ul>
</li>
<li><a href="#org70bf933">9. Slaptažodžio keitimas ir klaidų puslapiai</a>
<ul>
<li><a href="#org78a89c3">9.1. Slaptažodžio keitimas</a></li>
<li><a href="#org08525e3">9.2. Klaidų (404, 403, 500) puslapių kūrimas</a></li>
<li><a href="#org0f1d029">9.3. Užduotis: Biudžeto programa su slaptažodžio keitimu ir klaidų puslapiais</a></li>
<li><a href="#org5e049b3">9.4. Projekto struktūrizavimas naudojant paketus</a></li>
</ul>
</li>
<li><a href="#org2765c1b">10. Diegimas į serverį</a>
<ul>
<li><a href="#org6f89aad">10.1. Virtualios aplinkos paruošimas</a></li>
<li><a href="#orgbf6fc6f">10.2. nginx ir gunicorn konfigūracija</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3c40a99" class="outline-2">
<h2 id="org3c40a99"><span class="section-number-2">1</span> Įžanga į Flask</h2>
<div class="outline-text-2" id="text-1">
<p>
Flask yra populiariausias Python microframework. Jeigu projektas nėra
labai didelis, arba tiesiog norime pasidaryti kažkokį GUI per
naršyklę, kažką greitai prototipuoti, Flask yra labai geras
pasirinkimas. Su flask yra pakankamai paprasta kurti API's. Ši
paskaita bus greita įžanga, kitose nagrinėsime išsamiau.
</p>

<p>
Flask galima įdiegti su pip naudojant <code>pip install flask</code>.
</p>
</div>

<div id="outline-container-org748a5f0" class="outline-3">
<h3 id="org748a5f0"><span class="section-number-3">1.1</span> Kaip sukurti minimalią svetainę:</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">home</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #b8bb26;">"&lt;h1&gt;&#268;ia mano naujas puslapis&lt;/h1&gt;"</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>:
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca323f6" class="outline-3">
<h3 id="orgca323f6"><span class="section-number-3">1.2</span> Kaip puslapyje atvaizduoti įvestą kintamąjį:</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/&lt;name&gt;"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">user</span><span style="color: #fe8019;">(</span>name<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">"Labas, {name}"</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org75ce9e8" class="outline-3">
<h3 id="org75ce9e8"><span class="section-number-3">1.3</span> Kaip sukurti ir panaudoti HTML šabloną:</h3>
<div class="outline-text-3" id="text-1-3">
<p>
main.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">user</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"index.html"</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">()</span>
</pre>
</div>

<p>
templates/index.html:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Mano Puslapis</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Labas, pasauli!</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>

<p>
Įdėkime į šabloną šiek tiek logikos:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Skai&#269;iavimai</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Skai&#269;iavimai: </span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
{<span style="color: #83a598;">%for</span> x in range(10)%}
{<span style="color: #83a598;">%if</span> x % 2 == 0 %}
&lt;<span style="color: #b8bb26;">p</span>&gt;{{x}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endif %}
{<span style="color: #83a598;">%endfor</span>%}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f3b222" class="outline-3">
<h3 id="org8f3b222"><span class="section-number-3">1.4</span> Kaip kintamuosius perkelti į šabloną:</h3>
<div class="outline-text-3" id="text-1-4">
<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">home</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardai</span> = <span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'Jonas'</span>, <span style="color: #b8bb26;">'Antanas'</span>, <span style="color: #b8bb26;">'Petras'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"index.html"</span>, sarasas=vardai<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">()</span>
</pre>
</div>

<p>
templates/index.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Sara&#353;as</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#381;moni&#371; sara&#353;as: </span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
{<span style="color: #83a598;">%for</span> vardas in sarasas%}
&lt;<span style="color: #b8bb26;">p</span>&gt;{{vardas}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endfor %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8cf79f" class="outline-3">
<h3 id="orgf8cf79f"><span class="section-number-3">1.5</span> Kaip perduoti duomenis iš svetainės į programą:</h3>
<div class="outline-text-3" id="text-1-5">
<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, request, render_template
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/login"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">login</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> request.method == <span style="color: #b8bb26;">"POST"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'vardas'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"greetings.html"</span>, vardas=vardas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">else</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"login.html"</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">()</span>
</pre>
</div>

<p>
templates/index.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Prisijungimas</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Vardas:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"vardas"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"submit"</span> <span style="color: #83a598;">value</span>=<span style="color: #b8bb26;">"submit"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">form</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>


<p>
templates/greetings.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Sveikiname</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">{{vardas}}, sveikiname prisijungus!</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga72b380" class="outline-3">
<h3 id="orga72b380"><span class="section-number-3">1.6</span> Naudojame base.html šabloną:</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Failas templates/base.html:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
  &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Mano puslapis</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">div</span>&gt;
  &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Sveiki,</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
  &lt;<span style="color: #b8bb26;">p</span>&gt;&#268;ia yra mano super puslapis!&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
  {% block content %}{% endblock %}
&lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>

<p>
Failas templates/login.html:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Vardas:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"vardas"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"submit"</span> <span style="color: #83a598;">value</span>=<span style="color: #b8bb26;">"submit"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
Failas templates/greetings.html:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">{{vardas}}, sveikiname prisijungus!</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5153e24" class="outline-3">
<h3 id="org5153e24"><span class="section-number-3">1.7</span> Stiliui panaudojame "Bootstrap":</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Faile base.html:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
  &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Mano puslapis</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"utf-8"</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"viewport"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">"width=device-width, initial-scale=1"</span>&gt;
  &lt;<span style="color: #b8bb26;">link</span> <span style="color: #83a598;">rel</span>=<span style="color: #b8bb26;">"stylesheet"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"</span>&gt;
  &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
  &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
  &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;

<span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Navigation </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">nav</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar navbar-expand-lg navbar-light bg-light static-top mb-5 shadow"</span>&gt;
  &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-brand"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"#"</span>&gt;
    Mano puslapis&lt;/<span style="color: #b8bb26;">a</span>&gt;
    &lt;<span style="color: #b8bb26;">button</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler"</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"button"</span> <span style="color: #83a598;">data-toggle</span>=<span style="color: #b8bb26;">"collapse"</span> <span style="color: #83a598;">data-target</span>=<span style="color: #b8bb26;">"#navbarResponsive"</span> <span style="color: #83a598;">aria-controls</span>=<span style="color: #b8bb26;">"navbarResponsive"</span> <span style="color: #83a598;">aria-expanded</span>=<span style="color: #b8bb26;">"false"</span> <span style="color: #83a598;">aria-label</span>=<span style="color: #b8bb26;">"Toggle navigation"</span>&gt;
          &lt;<span style="color: #b8bb26;">span</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler-icon"</span>&gt;&lt;/<span style="color: #b8bb26;">span</span>&gt;
        &lt;/<span style="color: #b8bb26;">button</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"collapse navbar-collapse"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"navbarResponsive"</span>&gt;
      &lt;<span style="color: #b8bb26;">ul</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-nav ml-auto"</span>&gt;
        &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
          &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/login"</span>&gt;Prisijungti&lt;/<span style="color: #b8bb26;">a</span>&gt;
        &lt;/<span style="color: #b8bb26;">li</span>&gt;
      &lt;/<span style="color: #b8bb26;">ul</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;/<span style="color: #b8bb26;">nav</span>&gt;

&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"jumbotron text-center"</span>&gt;
  &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Sveiki,</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
  &lt;<span style="color: #b8bb26;">p</span>&gt;&#268;ia yra mano super puslapis!&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">div</span>&gt;

&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
{% block content %}{% endblock %}
&lt;/<span style="color: #b8bb26;">div</span>&gt;

&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc933df" class="outline-3">
<h3 id="orgdc933df"><span class="section-number-3">1.8</span> Užduotys</h3>
<div class="outline-text-3" id="text-1-8">
</div>
<div id="outline-container-orge15b6ce" class="outline-4">
<h4 id="orge15b6ce"><span class="section-number-4">1.8.1</span> 1 užduotis</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
Sukurti programą, kuri turėtų statinį puslapį, pvz. localhost:5000 su
norimu tekstu (rekomenduojama naudoti šablonus)
</p>

<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">home</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"home.html"</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
template/home.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Labas</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Norimas tekstas</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/1.png" alt="1.png" width="600px" />
</p>
</div>
</div>
</div>

<div id="outline-container-org406b3b5" class="outline-4">
<h4 id="org406b3b5"><span class="section-number-4">1.8.2</span> 2 užduotis</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
Sukurti programą, kuri įvedus norimą žodį adreso eilutėje (po /
simbolio) ir paspaudus ENTER, atspausdintų jį penkis kartus.
</p>

<p>
Still not sure where this is useful.
</p>

<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/&lt;word&gt;"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">word</span><span style="color: #fe8019;">(</span>word<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"word.html"</span>, word = word<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
templates/word.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#381;od&#382;iai</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
    {% for x in range(5) %}
        {{word}}
    {% endfor %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>



<div class="figure">
<p><img src="./static/images/2.png" alt="2.png" width="600px" />
</p>
</div>
</div>
</div>

<div id="outline-container-org6b1e47a" class="outline-4">
<h4 id="org6b1e47a"><span class="section-number-4">1.8.3</span> 3 užduotis</h4>
<div class="outline-text-4" id="text-1-8-3">
<p>
Sukurti programą, kuri puslapyje localhost:5000/keliamieji parodytų
visus keliamuosius metus nuo 1900 iki 2100 metų.
</p>

<p>
Cool use of calendar.
</p>

<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template
<span style="color: #fb4934;">import</span> calendar

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/keliamieji"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">leap</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"leap.html"</span>, calendar = calendar<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
templates/leap.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Leap</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
    {% for year in range(1900, 2100) %}
    {% if calendar.isleap(year) %}
    {{year}}
    {% endif %}
    {% endfor %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/3.png" alt="3.png" width="600px" />
</p>
</div>
</div>
</div>

<div id="outline-container-org15d58cf" class="outline-4">
<h4 id="org15d58cf"><span class="section-number-4">1.8.4</span> 4 užduotis</h4>
<div class="outline-text-4" id="text-1-8-4">
<p>
Sukurti programą, kuri leistų įvesti metus ir paspaudus patvirtinimo
mygtuką parodytų, ar jie yra keliamieji.
</p>

<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template, request
<span style="color: #fb4934;">import</span> calendar

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">home</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #b8bb26;">"&lt;h1&gt;Labas, cia yra pradinis&lt;/h1&gt;&lt;p&gt;Paziurek kas slepiasi po http://localhost:5000/arkeliamieji&lt;/p&gt;"</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/arkeliamieji"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">"GET"</span>, <span style="color: #b8bb26;">"POST"</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">isleap</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> request.method == <span style="color: #b8bb26;">"GET"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"getyear.html"</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">elif</span> request.method == <span style="color: #b8bb26;">"POST"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">year</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"year"</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"isleap.html"</span>, year=<span style="color: #fe8019;">int</span><span style="color: #cc241d;">(</span>year<span style="color: #cc241d;">)</span>, calendar=calendar<span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
templates/getyear.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Get Year</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Metai:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"year"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"submit"</span> <span style="color: #83a598;">value</span>=<span style="color: #b8bb26;">"Patikrinti"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">form</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>

<p>
templates/isleap.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Is Leap</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
    {% if calendar.isleap(year) %}
    &lt;<span style="color: #b8bb26;">p</span>&gt;Keliamieji&lt;/<span style="color: #b8bb26;">p</span>&gt;
    {% else %}
    &lt;<span style="color: #b8bb26;">p</span>&gt;Nekeliamieji&lt;/<span style="color: #b8bb26;">p</span>&gt;
    {% endif %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/4.gif" alt="4.gif" width="600px" />
</p>
</div>
</div>
</div>


<div id="outline-container-org0179ec6" class="outline-4">
<h4 id="org0179ec6"><span class="section-number-4">1.8.5</span> 5 užduotis (papildomai)</h4>
<div class="outline-text-4" id="text-1-8-5">
<p>
Patobulinti anksčiau kurtą biudžeto programą, panaudojant Flask
(bendravimui su vartotoju) ir SQLAlchemy (darbui su duomenų baze,
kurioje bus saugomi pajamų ir išlaidų įrašai).
</p>

<p>
Run db.py file first to create a database:
</p>

<p>
db.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> datetime
<span style="color: #fb4934;">import</span> os
<span style="color: #fb4934;">from</span> sqlalchemy <span style="color: #fb4934;">import</span> Column, Integer, String, Float, DateTime, create_engine
<span style="color: #fb4934;">from</span> sqlalchemy.ext.declarative <span style="color: #fb4934;">import</span> declarative_base

<span style="color: #83a598;">engine</span> = create_engine<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"sqlite:///.db"</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">Base</span> = declarative_base<span style="color: #fe8019;">()</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Projektas</span><span style="color: #fe8019;">(</span>Base<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"Projektas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = Column<span style="color: #fe8019;">(</span>Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">name</span> = Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavadinimas"</span>, String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">price</span> = Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Kaina"</span>, Float<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">created_date</span> = Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Suk&#363;rimo data"</span>, DateTime, default=datetime.datetime.utcnow<span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">aprasom taip pat kaip paprasta klase. Asocijuojam su klase. Kad zinotu i kuri collumn deti kintamaji</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">created_date matai neidetas apacioje, nes nereikia jo mum patiem irasyti, jis turi default reiksme</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">jeigu noretum irasyti ir keisti - tuomet prie init turetum prirasyti</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, name, price<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.name = name
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.price = price

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">Kada kvieciam klase su query, kad ja israsytu ir KAIP israsytu apibudinam cia</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">"{self.id} {self.name} - {self.price}: {self.created_date}"</span>


<span style="color: #928374;"># </span><span style="color: #928374;">kviecia connectiona ir sukuria visas lenteles jeigu jos neegzistuoja. Jos neupdeitins.</span>
Base.metadata.create_all<span style="color: #fe8019;">(</span>engine<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
main.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> os
<span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, request, render_template, url_for, redirect
<span style="color: #fb4934;">from</span> flask_sqlalchemy <span style="color: #fb4934;">import</span> SQLAlchemy

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">from</span> models.irasas <span style="color: #fb4934;">import</span> Irasas

<span style="color: #83a598;">basedir</span> = os.path.abspath<span style="color: #fe8019;">(</span>os.path.dirname<span style="color: #cc241d;">(</span>__file__<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>


<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"SQLALCHEMY_DATABASE_URI"</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">"sqlite:///"</span> + os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">"biudzetas.db"</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"SQLALCHEMY_TRACK_MODIFICATIONS"</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">False</span>
<span style="color: #83a598;">db</span> = SQLAlchemy<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>

db.create_all<span style="color: #fe8019;">()</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/prideti"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">"GET"</span>, <span style="color: #b8bb26;">"POST"</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">prideti</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> request.method == <span style="color: #b8bb26;">"POST"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">suma</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"suma"</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">info</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"info"</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">irasas</span> = Irasas<span style="color: #fe8019;">(</span>suma, info<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>irasas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> sarasas<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">elif</span> request.method == <span style="color: #b8bb26;">"GET"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"prideti.html"</span><span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">sarasas</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">biudzetas</span> = Irasas.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"sarasas.html"</span>, biudzetas=biudzetas<span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/balansas"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">balansas</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">biudzetas</span> = db.session.query<span style="color: #fe8019;">(</span>Irasas<span style="color: #fe8019;">)</span>.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">balansas</span> = 0
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">for</span> irasas <span style="color: #fb4934;">in</span> biudzetas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">balansas</span> += irasas.suma
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"balansas.html"</span>, balansas=balansas<span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/irasas_delete/&lt;int:id&gt;"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">irasas_delete</span><span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">uzklausa</span> = db.session.query<span style="color: #fe8019;">(</span>Irasas<span style="color: #fe8019;">)</span>.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.delete<span style="color: #fe8019;">(</span>uzklausa<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">"sarasas"</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/irasas_update/&lt;int:id&gt;"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">"GET"</span>, <span style="color: #b8bb26;">"POST"</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">irasas_update</span><span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> request.method == <span style="color: #b8bb26;">"POST"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">irasas</span> = db.session.query<span style="color: #fe8019;">(</span>Irasas<span style="color: #fe8019;">)</span>.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">irasas.suma</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"suma"</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">irasas.info</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">"info"</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">"sarasas"</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">elif</span> request.method == <span style="color: #b8bb26;">"GET"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">irasas</span> = db.session.query<span style="color: #fe8019;">(</span>Irasas<span style="color: #fe8019;">)</span>.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"redaguoti.html"</span>, irasas=irasas<span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">"__main__"</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
models/irasas.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> main <span style="color: #fb4934;">import</span> db


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Irasas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"Irasas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">suma</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Suma"</span>, db.Float<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">info</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Info"</span>, db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, suma, info<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.suma = suma
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.info = info

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">"{self.id}: suma - {self.suma}, info - {self.info}"</span>


db.create_all<span style="color: #fe8019;">()</span>
</pre>
</div>

<p>
templates/balansas.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Balansas: </span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{balansas}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endblock %}
</pre>
</div>

<p>
templates/prideti.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Suma:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"suma"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Info:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"info"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"submit"</span> <span style="color: #83a598;">value</span>=<span style="color: #b8bb26;">"&#302;vesti"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
templates/redaguoti.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Suma:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"suma"</span> value={{irasas.suma}} /&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;Info:&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"info"</span> value={{irasas.info}} /&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"submit"</span> <span style="color: #83a598;">value</span>=<span style="color: #b8bb26;">"&#302;vesti"</span>/&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}&gt;
</pre>
</div>

<p>
templates/sarasas.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Biud&#382;eto &#303;ra&#353;ai: </span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
{<span style="color: #83a598;">%for</span> irasas in biudzetas%}
&lt;<span style="color: #b8bb26;">p</span>&gt;{{irasas}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('irasas_delete', id=irasas['id']) }}"</span>&gt;I&#353;trinti&lt;/<span style="color: #b8bb26;">a</span>&gt;
&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('irasas_update', id=irasas['id']) }}"</span>&gt;Redaguoti&lt;/<span style="color: #b8bb26;">a</span>&gt;
&lt;<span style="color: #b8bb26;">hr</span>&gt;
{% endfor %}
{% endblock %}
</pre>
</div>

<p>
templates/base.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
  &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Mano biud&#382;etas</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"utf-8"</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"viewport"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">"width=device-width, initial-scale=1"</span>&gt;
  &lt;<span style="color: #b8bb26;">link</span> <span style="color: #83a598;">rel</span>=<span style="color: #b8bb26;">"stylesheet"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"</span>&gt;
  &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
  &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
  &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;

<span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Navigation </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">nav</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar navbar-expand-lg navbar-light bg-light static-top mb-5 shadow"</span>&gt;
  &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-brand"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"#"</span>&gt;
    &lt;<span style="color: #b8bb26;">svg</span> <span style="color: #83a598;">width</span>=<span style="color: #b8bb26;">"1em"</span> <span style="color: #83a598;">height</span>=<span style="color: #b8bb26;">"1em"</span> <span style="color: #83a598;">viewBox</span>=<span style="color: #b8bb26;">"0 0 16 16"</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"bi bi-cash"</span> <span style="color: #83a598;">fill</span>=<span style="color: #b8bb26;">"currentColor"</span> <span style="color: #83a598;">xmlns</span>=<span style="color: #b8bb26;">"http://www.w3.org/2000/svg"</span>&gt;
    &lt;<span style="color: #b8bb26;">path</span> <span style="color: #83a598;">fill-rule</span>=<span style="color: #b8bb26;">"evenodd"</span> <span style="color: #83a598;">d</span>=<span style="color: #b8bb26;">"M15 4H1v8h14V4zM1 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H1z"</span>/&gt;
    &lt;<span style="color: #b8bb26;">path</span> <span style="color: #83a598;">d</span>=<span style="color: #b8bb26;">"M13 4a2 2 0 0 0 2 2V4h-2zM3 4a2 2 0 0 1-2 2V4h2zm10 8a2 2 0 0 1 2-2v2h-2zM3 12a2 2 0 0 0-2-2v2h2zm7-4a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"</span>/&gt;
    &lt;/<span style="color: #b8bb26;">svg</span>&gt;
    Mano biud&#382;etas&lt;/<span style="color: #b8bb26;">a</span>&gt;
    &lt;<span style="color: #b8bb26;">button</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler"</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"button"</span> <span style="color: #83a598;">data-toggle</span>=<span style="color: #b8bb26;">"collapse"</span> <span style="color: #83a598;">data-target</span>=<span style="color: #b8bb26;">"#navbarResponsive"</span> <span style="color: #83a598;">aria-controls</span>=<span style="color: #b8bb26;">"navbarResponsive"</span> <span style="color: #83a598;">aria-expanded</span>=<span style="color: #b8bb26;">"false"</span> <span style="color: #83a598;">aria-label</span>=<span style="color: #b8bb26;">"Toggle navigation"</span>&gt;
          &lt;<span style="color: #b8bb26;">span</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler-icon"</span>&gt;&lt;/<span style="color: #b8bb26;">span</span>&gt;
        &lt;/<span style="color: #b8bb26;">button</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"collapse navbar-collapse"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"navbarResponsive"</span>&gt;
      &lt;<span style="color: #b8bb26;">ul</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-nav ml-auto"</span>&gt;
        &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
          &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/"</span>&gt;S&#261;ra&#353;as&lt;/<span style="color: #b8bb26;">a</span>&gt;
        &lt;/<span style="color: #b8bb26;">li</span>&gt;
        &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
          &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/balansas"</span>&gt;Balansas&lt;/<span style="color: #b8bb26;">a</span>&gt;
        &lt;/<span style="color: #b8bb26;">li</span>&gt;
        &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
            &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/prideti"</span>&gt;Prid&#279;ti&lt;/<span style="color: #b8bb26;">a</span>&gt;
        &lt;/<span style="color: #b8bb26;">li</span>&gt;
      &lt;/<span style="color: #b8bb26;">ul</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;/<span style="color: #b8bb26;">nav</span>&gt;

&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
    {% block content %}{% endblock %}
&lt;/<span style="color: #b8bb26;">div</span>&gt;

&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>

<p>
Run main.py and open <a href="http://127.0.0.1:5000">http://127.0.0.1:5000</a>, see the magic :)
</p>


<div class="figure">
<p><img src="./static/images/5.gif" alt="5.gif" width="600px" />
</p>
</div>

<p>
<code>Important notes</code>!!
</p>

<p>
Jeigu norite paleistį šį projektą savo kompiuteryje, prieš tai
įsitikinkite, jog turite šiam projektui reikiamą flask_sqlalchemy
v2.5.1 versiją.
</p>

<p>
Tai galite padaryti savo virtualioje, šiam projektui skirtoje python
aplinkoje. Terminale tiesiog paleiskite šią komandą, kad įrašyti
reikiamą flask-sqlalchemy versiją:
</p>

<p>
<code>pip install flask-sqlalchemy==2.5.1</code>
</p>

<p>
Arba galite pasinaudoti requirements.txt. failiuku ir vos tik
parsisiuntus šį branch į savo kompiuterį ir pasiruošus virtualią
aplinką, susirašyti visas šiam projektui būtinas "dependencies" su šia
komanda:
</p>

<p>
<code>pip install -r requirements.txt</code>
</p>

<p>
requirements.txt
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #83a598;">click</span>==8.1.3
<span style="color: #83a598;">Flask</span>==2.2.2
Flask-SQLAlchemy==2.5.1
<span style="color: #83a598;">greenlet</span>==2.0.1
importlib-metadata==6.0.0
<span style="color: #83a598;">itsdangerous</span>==2.1.2
<span style="color: #83a598;">Jinja2</span>==3.1.2
<span style="color: #83a598;">MarkupSafe</span>==2.1.2
<span style="color: #83a598;">SQLAlchemy</span>==1.4.46
<span style="color: #83a598;">Werkzeug</span>==2.2.2
<span style="color: #83a598;">zipp</span>==3.11.0
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgda1355b" class="outline-2">
<h2 id="orgda1355b"><span class="section-number-2">2</span> Flask 1 dalis</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org055bc75" class="outline-3">
<h3 id="org055bc75"><span class="section-number-3">2.1</span> Susikurkime paprastą flask aplikaciją</h3>
<div class="outline-text-3" id="text-2-1">
<p>
app.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template
<span style="color: #928374;"># </span><span style="color: #928374;">i&#353; flask bibliotekos importuojame klas&#281; Flask ir f-j&#261; render_template.</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">inicijuojame klas&#279;s Flask objekt&#261;, priskiriame kintam&#261;jam app.</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/'</span><span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">&#303;velkame f-j&#261; &#303; flask dekoratori&#371;. Be jo  funkcija b&#363;t&#371; bereik&#353;m&#279;. Dekorato riaus parametruose nurodome, kad nor&#279;sime rezultato 127.0.0.1:8000/ url adrese."""</span>

<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">index</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'index.html'</span><span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">funkcijoje index nurodome, kad nor&#279;sime sugeneruoti index.html</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> app.run<span style="color: #fe8019;">(</span>host=<span style="color: #b8bb26;">'127.0.0.1'</span>, port=8000, debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">patikrin&#281;, ar programa leid&#382;iama ne i&#353; kito failo, leid&#382;iame m&#363;s&#371; app, su parametrais. debug = True klaidos atveju mums rodys informatyvias &#382;inutes nar&#353;ykl&#279;je.</span>
</pre>
</div>

<p>
Komentaruose šiek tiek informacijos, kas vyksta. Dabar mums reikės
susikurti html šabloną. Flask šablonų ieško templates kataloge. :
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
&lt;<span style="color: #b8bb26;">head</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"UTF-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"viewport"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">http-equiv</span>=<span style="color: #b8bb26;">"X-UA-Compatible"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">"ie=edge"</span>&gt;
    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Demo</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
&lt;/<span style="color: #b8bb26;">head</span>&gt;
&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Flask Flask Flask</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>

<p>
Patikrinkime, ar veikia:
</p>


<div class="figure">
<p><img src="./static/images/flask1_1.png" alt="flask1_1.png" width="600px" />
</p>
</div>


<p>
Logikos naudojimas šablonuose:
</p>

<p>
Už logiką šablonuose atsako Jinja2 šablonų generatorius (templating
engine), jis per savo sintaksę leidžia mums įterpti kintamuosius ir
logiką į html failus.
</p>

<p>
paruoškime paprastą žodynų sąrašą, kuris galės būti mūsų duomenų bazės
imitacija:
</p>

<p>
dictionary.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">data</span> =<span style="color: #fe8019;">[</span><span style="color: #cc241d;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'data'</span>:<span style="color: #b8bb26;">'2020 01 01'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'autorius'</span>: <span style="color: #b8bb26;">'Autorius 1'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'pavadinimas'</span>: <span style="color: #b8bb26;">'Apie niek&#261;'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'tekstas'</span>: <span style="color: #b8bb26;">'Zombie ipsum reversus ab viral inferno, nam rick grimes malum cerebro. De carne lumbering animata corpora quaeritis. Summus brains sit&#8203;&#8203;, morbo vel maleficia? De apocalypsi gorger omero undead survivor dictum mauris.'</span>
<span style="color: #cc241d;">}</span>,
<span style="color: #cc241d;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'data'</span>:<span style="color: #b8bb26;">'2020 02 01'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'autorius'</span>: <span style="color: #b8bb26;">'KITAS AUTORIUS'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'pavadinimas'</span>: <span style="color: #b8bb26;">'Apie zombius'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'tekstas'</span>: <span style="color: #b8bb26;">'Zombie ipsum reversus ab viral inferno, nam rick grimes malum cerebro. De carne lumbering animata corpora quaeritis. Summus brains sit&#8203;&#8203;, morbo vel maleficia? De apocalypsi gorger omero undead survivor dictum mauris. '</span>
<span style="color: #cc241d;">}</span>,
<span style="color: #cc241d;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'data'</span>:<span style="color: #b8bb26;">'2020 03 01'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'autorius'</span>: <span style="color: #b8bb26;">'Dar ka&#382;kas'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'pavadinimas'</span>: <span style="color: #b8bb26;">'Braiiins!'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'tekstas'</span>: <span style="color: #b8bb26;">'Zombie ipsum reversus ab viral inferno, nam rick grimes malum cerebro. De carne lumbering animata corpora quaeritis. Summus brains sit&#8203;&#8203;, morbo vel maleficia? De apocalypsi gorger omero undead survivor dictum mauris.'</span>
<span style="color: #cc241d;">}</span><span style="color: #fe8019;">]</span>
</pre>
</div>


<p>
Pagrindiniame faile importuokime šį kintamąjį ir perduokime į šabloną:
</p>

<p>
app.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template
<span style="color: #fb4934;">from</span> dictionary <span style="color: #fb4934;">import</span> data <span style="color: #928374;"># </span><span style="color: #928374;">IMPORTUOJAME</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/'</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">index</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'index.html'</span>, data=data<span style="color: #fe8019;">)</span> <span style="color: #928374;"># </span><span style="color: #928374;">PERDUODAME &#302; &#352;ABLON&#260;</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> app.run<span style="color: #fe8019;">(</span>host=<span style="color: #b8bb26;">'127.0.0.1'</span>, port=8000, debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Dabar dirbsime su šablonu. Pradžiai tiesiog perduokime kintamąjį į
body:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai:</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
    {{ data }}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/flask1_2.png" alt="flask1_2.png" width="600px" />
</p>
</div>

<p>
Čia yra grubus žodynų sąrašo perdavimas, jį ir matome. Pabandykime tai
paversti straipsnių puslapiu:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
    {% for straipsnis in data %}
    &lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">{{ straipsnis['pavadinimas'] }}</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['data'] }}, {{ straipsnis['autorius'] }}&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">hr</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['tekstas'] }}&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">hr</span>&gt;
    {% endfor %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/flask1_3.png" alt="flask1_3.png" width="600px" />
</p>
</div>

<p>
Matome, kaip galime iteruoti per duomenis html'e. Pamėginkime įtraukti
if logiką. Pradžiai papildykime 'duomenų bazę'. Kiekviename žodyne
įtraukime 'status'. Dalies statusas bus 'published', dalies
'unpublished':
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fe8019;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'data'</span>:<span style="color: #b8bb26;">'2020 01 01'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'autorius'</span>: <span style="color: #b8bb26;">'Autorius 1'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'pavadinimas'</span>: <span style="color: #b8bb26;">'Apie niek&#261;'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'tekstas'</span>: <span style="color: #b8bb26;">'Zombie ipsum reversus ab viral inferno, nam rick grimes malum cerebro. De carne lumbering animata corpora quaeritis. Summus brains sit&#8203;&#8203;, morbo vel maleficia? De apocalypsi gorger omero undead survivor dictum mauris.'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'status'</span>: <span style="color: #b8bb26;">'published'</span>
<span style="color: #fe8019;">}</span>, <span style="color: #928374;"># </span><span style="color: #928374;">ir t.t.</span>
</pre>
</div>

<p>
įtraukime if logiką į šabloną:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;
    {% for straipsnis in data %}
    {% if straipsnis['status'] == 'published' %}
    &lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">{{ straipsnis['pavadinimas'] }}</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['data'] }}, &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">{{ straipsnis['autorius'] }}</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">hr</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['tekstas'] }}&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
    {% endif %}
    {% endfor %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/flask1_4.png" alt="flask1_4.png" width="600px" />
</p>
</div>

<p>
Matome, kad straipsnis su statusu != 'published' nebuvo publikuotas.
Kaip ir python'e, galima naudoti {%elif %} ir {% else %}. Pvz.:
</p>


<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;
    {% for straipsnis in data %}
    {% if straipsnis['status'] == 'published' %}
    &lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">{{ straipsnis['pavadinimas'] }}</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['data'] }}, &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">{{ straipsnis['autorius'] }}</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">hr</span>&gt;
    &lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['tekstas'] }}&lt;/<span style="color: #b8bb26;">p</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
    {% else %}
    &lt;<span style="color: #b8bb26;">h3</span>&gt;{{ straipsnis['pavadinimas'] }} - &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">Publikavimas laikinai i&#353;jungtas</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">h3</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
    {% endif %}
    {% endfor %}
&lt;/<span style="color: #b8bb26;">body</span>&gt;
</pre>
</div>


<div class="figure">
<p><img src="./static/images/flask1_5.png" alt="flask1_5.png" width="600px" />
</p>
</div>

<p>
Paveldėjimas šablonuose
</p>

<p>
Dažniausiai interneto svetainės turi struktūrą, kai kiekviename
puslapyje atsikartoja tam tikri komponentai. Tai gali būti titulinė
puslapio dalis, &lt;head&gt; komponentai, navigacijos panelė, footer'is,
nuorodos į CSS, JavaScript ir pan. Jinja2 turi mechanizmą, leidžiantį
mums kiekvieną kartą nerašyti į šabloną šių komponentų, t.y. išsaugoti
juos atskirai ir naudoti tik nuorodas į juos. Pabandykime pritaikyti
praktikoje.
</p>

<p>
Pasiskolinkime standartinį išdėstymą iš <a href="https://github.com/StartBootstrap/startbootstrap-bare/blob/master/dist/index.html">čia</a>.
</p>

<p>
Tam, kad veiktų mobiliosios versijos navigacija, data-toggle ir
data-target reikia pakeisti data-bs-toggle ir data-bs-target.
</p>

<p>
Nusikopijuokime nuorodos HTML'ą į kokį nors html failą.
</p>

<p>
Pakeiskime lokalias css ir JavaScript nuorodas į <a href="https://getbootstrap.com/docs/4.3/getting-started/introduction/">Bootstrap CDN</a>
</p>

<p>
Perkelkime savo &lt;body&gt; dalį vietoje tos dalies, kuri yra po komentaru
&lt;!&#x2013; Page Content &#x2013;&gt;
</p>

<p>
senąjį failą pervadinkime backup.html, naująjį - index html.
</p>

<p>
Rezultatas atrodys maždaug taip:
</p>


<div class="figure">
<p><img src="./static/images/flask1_6.png" alt="flask1_6.png" width="600px" />
</p>
</div>

<p>
Įsivaizduokime, kad mums reikės dar puslapio 'apie', galbūt dar keleto
puslapių ateityje. Visi jie turės tą patį bootstrap'ą, ir tą pačią
navigacijos panelę.
</p>

<p>
templates kataloge susikurkime failą base.html
</p>

<p>
visą turinį iš index.html nukopijuokime į naują base.html.
</p>

<p>
tuomet viską kas yra &lt;div class="container"&gt; viduje, triname ir
pakeičiame į {% block content %}{% endblock %}:
</p>

<div class="org-src-container">
<pre class="src src-html">          &lt;/<span style="color: #b8bb26;">ul</span>&gt;
        &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;/<span style="color: #b8bb26;">nav</span>&gt;

<span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Page Content </span><span style="color: #928374;">--&gt;</span>

&lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
        {% block content %}
        {% endblock %}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;/<span style="color: #b8bb26;">body</span>&gt;


<span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Bootstrap core JavaScript </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://code.jquery.com/jquery-3.3.1.slim.min.js"</span>
    <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"</span>
    <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
</pre>
</div>

<p>
Išsaugokime base.html.
</p>

<p>
index.html pertvarkykime taip:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;
{% for straipsnis in data %}
{% if straipsnis['status'] == 'published' %}
&lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">{{ straipsnis['pavadinimas'] }}</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['data'] }}, &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">{{ straipsnis['autorius'] }}</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['tekstas'] }}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
{% else %}
&lt;<span style="color: #b8bb26;">h3</span>&gt;{{ straipsnis['pavadinimas'] }} - &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">Publikavimas laikinai i&#353;jungtas</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">h3</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
{% endif %}
{% endfor %}

{% endblock %}
</pre>
</div>


<p>
papildykime savo app.py nauju maršrutu:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/about'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">about</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'about.html'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
base.html susiraskime navigacijoje nuorodą 'About', ir nukreipkime į
savo naująjį maršrutą:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/about"</span>&gt;About&lt;/<span style="color: #b8bb26;">a</span>&gt;
&lt;/<span style="color: #b8bb26;">li</span>&gt;
susikurkime dar vien&#261; &#353;ablon&#261;, about.html:


{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Apie</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;&#352;iame puslapyje rasite labai daug naudingos informacijos apie beveik visk&#261;&lt;/<span style="color: #b8bb26;">p</span>&gt;

{% endblock %}
</pre>
</div>

<p>
Svetainėje, paspaudę nuorodą atsidursime puslapyje "Apie":
</p>


<div class="figure">
<p><img src="./static/images/flask1_7.png" alt="flask1_7.png" width="600px" />
</p>
</div>

<p>
<a href="https://github.com/CodeAcademy-Online/Python/tree/lesson-14">result here</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-org5a187cf" class="outline-2">
<h2 id="org5a187cf"><span class="section-number-2">3</span> Flask 2 dalis</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org76e840e" class="outline-3">
<h3 id="org76e840e"><span class="section-number-3">3.1</span> Dinaminiai maršrutai ir formos</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org723bdff" class="outline-4">
<h4 id="org723bdff"><span class="section-number-4">3.1.1</span> Dinaminiai maršrutai</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Tęskime su praeitos paskaitos medžiaga. Įsivaizduokime, kad mums
reikės straipsnių sąrašo, su dalimi teksto, ir po kiekvienu sąrašo
elementu nuorodos 'skaityti toliau&#x2026;'. Tokiose situacijose labai
praverčia dinaminiai maršrutai. Susikurkime naują maršrutą app.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/&lt;string:title&gt;'</span><span style="color: #fe8019;">)</span> <span style="color: #928374;"># </span><span style="color: #928374;">parametruose nurodomas kintamasis (title) ir jo tipas (string)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">article</span><span style="color: #fe8019;">(</span>title<span style="color: #fe8019;">)</span>: <span style="color: #928374;"># </span><span style="color: #928374;">kintam1j&#303; b&#363;tinai nurodykite ir funkcijos parametruose</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'article.html'</span>, title=title, data=data<span style="color: #fe8019;">)</span> <span style="color: #928374;"># </span><span style="color: #928374;">taip pat ir &#269;ia reikia j&#303; perduoti</span>
</pre>
</div>

<p>
dabar pakoreguokime mūsų index.html:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;
{% for straipsnis in data %}
&lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">{{ straipsnis['pavadinimas'] }}</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['data'] }}, &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">{{ straipsnis['autorius'] }}</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['tekstas'][:30] }}&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('article', title=straipsnis['pavadinimas']) }}"</span>&gt;...skaityti toliau&lt;/<span style="color: #b8bb26;">a</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
{% endfor %}

{% endblock %}
</pre>
</div>

<p>
panagrinėkime &lt;p&gt; bloką.
</p>

<ul class="org-ul">
<li>{{ straipsnis['tekstas'][:30] }} - vietoje pilno teksto pasiliekame
ištrauką pirmų 30ties simbolių</li>

<li>nuorodoje naudojama url_for() yra pagalbinė Jinja funkcija. Į
parametrus priima maršruto funkcijos pavadinimą. Paprastesniu
atveju, url_for('about') nukreiptų į mūsų 'Apie' puslapį.</li>

<li>{{ url_for('article', title=straipsnis['pavadinimas']) }} - šiuo
atveju mes nurodėme, kad norime į 'article' ir kad jo parametruose
esantis title būtų prilygintas straipsnio pavadinimui.</li>
</ul>

<p>
Mūsų straipsnių puslapis dabar atrodo taip:
</p>


<div class="figure">
<p><img src="./static/images/flask2_1.png" alt="flask2_1.png" width="300px" />
</p>
</div>

<p>
Susikurkime tuščią article.html ir pažiūrėkime, kas vyksta:
</p>

<p>
article.html tuščias, todėl nėra jokio turinio. Tačiau URL eilutėje
matome, kad puslaio endpoint'as yra straipsnio pavadinimas. Padarykime
taip, kad matytumėm straipsnio turinį
</p>

<p>
article.html:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fe8019;">{</span>% extends <span style="color: #b8bb26;">"base.html"</span> %<span style="color: #fe8019;">}</span>

<span style="color: #fe8019;">{</span>% block content %<span style="color: #fe8019;">}</span>

<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">for</span> straipsnis <span style="color: #fb4934;">in</span> data %<span style="color: #fe8019;">}</span>
<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">if</span> straipsnis<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'pavadinimas'</span><span style="color: #cc241d;">]</span> == title %<span style="color: #fe8019;">}</span>

&lt;h1&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> straipsnis<span style="color: #b8bb26;">[</span><span style="color: #b8bb26;">'pavadinimas'</span><span style="color: #b8bb26;">]</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/h1&gt;
&lt;p&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> straipsnis<span style="color: #b8bb26;">[</span><span style="color: #b8bb26;">'data'</span><span style="color: #b8bb26;">]</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>, &lt;i&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> straipsnis<span style="color: #b8bb26;">[</span><span style="color: #b8bb26;">'autorius'</span><span style="color: #b8bb26;">]</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/i&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> straipsnis<span style="color: #b8bb26;">[</span><span style="color: #b8bb26;">'tekstas'</span><span style="color: #b8bb26;">]</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/p&gt;
&lt;br&gt;&lt;br&gt;

<span style="color: #fe8019;">{</span>% endif %<span style="color: #fe8019;">}</span>
<span style="color: #fe8019;">{</span>% endfor %<span style="color: #fe8019;">}</span>

<span style="color: #fe8019;">{</span>% endblock %<span style="color: #fe8019;">}</span>
</pre>
</div>

<p>
išbandykime:
</p>


<div class="figure">
<p><img src="./static/images/flask2_2.png" alt="flask2_2.png" width="800px" />
</p>
</div>
</div>
</div>
<div id="outline-container-org41e987f" class="outline-4">
<h4 id="org41e987f"><span class="section-number-4">3.1.2</span> Formos</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Formas flaske galima kurti dviem būdais. Aptarsime abu. Pirmas iš jų
būtų paprastos formos iš HTML duomenų surinkimas. Tinka įvairiems
testavimams, ne kritiniams duomenims apdoroti. Veikimo principas buvo
glaustai pademonstruotas įžangos skyriuje. Žinoma, tas formas galima
privesti iki profesionalaus lygmens, tačiau reikės nemažai papildomo
darbo.
</p>

<p>
sukurkime naują maršrutą:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/add_article'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">add_article</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'add_article.html'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
papildykime index.html nuoroda po straipsniais "Rašyti straipsnį"
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Straipsniai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;
{% for straipsnis in data %}
&lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">{{ straipsnis['pavadinimas'] }}</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['data'] }}, &lt;<span style="color: #b8bb26;">i</span>&gt;<span style="font-style: italic;">{{ straipsnis['autorius'] }}</span>&lt;/<span style="color: #b8bb26;">i</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{ straipsnis['tekstas'][:30] }}&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('article', title=straipsnis['pavadinimas']) }}"</span>&gt;...skaityti toliau&lt;/<span style="color: #b8bb26;">a</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
{% endfor %}
&lt;<span style="color: #b8bb26;">h1</span>&gt;&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('add_article') }}"</span>&gt; Ra&#353;yti straipsn&#303;&lt;/<span style="color: #b8bb26;">a</span>&gt;&lt;/<span style="color: #b8bb26;">h1</span>&gt;
{% endblock %}
</pre>
</div>

<p>
sukurkime naują šabloną add_article.html:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"/"</span>, <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span>&gt;
  &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
    &lt;<span style="color: #b8bb26;">label</span> <span style="color: #83a598;">for</span>=<span style="color: #b8bb26;">"autorius"</span>&gt;Autorius&lt;/<span style="color: #b8bb26;">label</span>&gt;
    &lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-control"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"autorius"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"autorius"</span>&gt;
  &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
    &lt;<span style="color: #b8bb26;">label</span> <span style="color: #83a598;">for</span>=<span style="color: #b8bb26;">"pavadinimas"</span>&gt;Pavadinimas&lt;/<span style="color: #b8bb26;">label</span>&gt;
    &lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-control"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"pavadinimas"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"pavadinimas"</span>&gt;
  &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
    &lt;<span style="color: #b8bb26;">label</span> <span style="color: #83a598;">for</span>=<span style="color: #b8bb26;">"date"</span>&gt;Data&lt;/<span style="color: #b8bb26;">label</span>&gt;
    &lt;<span style="color: #b8bb26;">input</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"text"</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-control"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"date"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"date"</span>&gt;
  &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
    &lt;<span style="color: #b8bb26;">label</span> <span style="color: #83a598;">for</span>=<span style="color: #b8bb26;">"tekstas"</span>&gt;Example textarea&lt;/<span style="color: #b8bb26;">label</span>&gt;
    &lt;<span style="color: #b8bb26;">textarea</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-control"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"tekstas"</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"tekstas"</span> <span style="color: #83a598;">rows</span>=<span style="color: #b8bb26;">"3"</span>&gt;&lt;/<span style="color: #b8bb26;">textarea</span>&gt;
  &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;<span style="color: #b8bb26;">button</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"submit"</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"btn btn-primary"</span>&gt;I&#353;saugoti&lt;/<span style="color: #b8bb26;">button</span>&gt;
&lt;/<span style="color: #b8bb26;">form</span>&gt;

{% endblock %}
</pre>
</div>


<p>
užeikime į "Rašyti straipsnį" nuorodą:
</p>


<div class="figure">
<p><img src="./static/images/flask2_3.png" alt="flask2_3.png" width="600px" />
</p>
</div>

<p>
Turime neveikiančią formą.
</p>

<p>
Prie importų iš flask pridėkime <code>request</code>. Pakoreguokime index()
funkciją:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">index</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> request.method == <span style="color: #b8bb26;">'POST'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">date</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'date'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">autorius</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'autorius'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">tekstas</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'tekstas'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavadinimas</span> = request.form<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'pavadinimas'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   data.append<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'data'</span>: date,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'autorius'</span>: autorius,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'pavadinimas'</span>: pavadinimas,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'tekstas'</span>: tekstas,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">'status'</span>: <span style="color: #b8bb26;">'published'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'index.html'</span>, data=data<span style="color: #fe8019;">)</span>
</pre>
</div>


<p>
funkcijoje pasitikriname, ar yra 'post' užklausa, jeigu yra, tai
papildome mūsų "duomenų bazę" naujais duomenimis:
</p>


<div class="figure">
<p><img src="./static/images/flask2_4.png" alt="flask2_4.png" width="600px" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgd553b68" class="outline-4">
<h4 id="orgd553b68"><span class="section-number-4">3.1.3</span> flask-wtf</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Antras būdas tvarkytis su formomis yra trečios šalies bibliotekos
<code>flask_wtf</code> naudojimas. Ji pasirūpina saugumo klausimais "out of the
box" ir yra industrijos standartas dirbant su flask. Pamėginsime
kontaktuose sukurti paprastą formą. Reikia šiek tiek pasiruošti:
</p>

<ul class="org-ul">
<li>sukurkime naują tuščią maršrutą contact_us</li>

<li>sukurkime naują tuščią šabloną tam maršrutui</li>

<li>navigacijoje aktyvuokime nuorodą į contact_us</li>

<li>sukurkime naują failą forms.py</li>

<li>įsidiekime flask-wtf biblioteką (pip install flask-wtf)</li>
</ul>

<p>
forms.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> StringField, TextAreaField, SubmitField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired, Length, Email


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">ContactForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">name</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Vardas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">email</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'El.pa&#353;tas'</span>, <span style="color: #cc241d;">[</span>Email<span style="color: #b8bb26;">(</span>message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Neteisingas adresas.'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span>, DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">body</span> = TextAreaField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'J&#363;s&#371; prane&#353;imas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   Length<span style="color: #b8bb26;">(</span><span style="color: #fe8019;">min</span>=10,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Per trumpas tekstas.'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Submit'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Šį kartą mūsų forma aprašoma, kaip klasė. Visus laukų tipus ir
validatorius (patvirtintojus?..) reikia importuotis atskirai. Pvz.:
eilutę priskirtą kintamąjam body galima dekonstruoti taip:
</p>

<p>
TextAreaField - nurodome, kokio tipo formos lauką generuoti.
</p>

<p>
'Jūsų pranešimas' - formos lauko pavadinimas (label).
</p>

<p>
[DataRequired(), Length(min=10, message=('Per trumpas tekstas.'))]) -
sąraše yra validators - Nurodome kad laukas būtinas užpildyti, kad
minimum 10 simbolių, ir kokia klaidos žinutė.
</p>

<p>
Kokie yra galimi laukai, galima pažiūrėti <a href="https://wtforms.readthedocs.io/en/stable/fields/">čia</a>. Kokie yra galimi
validators, galima pažiūrėti <a href="https://wtforms.readthedocs.io/en/stable/validators/">čia</a>.
</p>

<p>
pakoreguokime maršrutą:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/contact_us'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">contact_us</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = ContactForm<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'contact_success.html'</span>, form=form<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'contact_us.html'</span>, form=form<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Pakoregavome contact_us maršrutą taip, kad jeigu forma sėkmingai
praėjo validaciją, nukreiptų mus į sėkmės puslapį.
</p>

<p>
pasidarykime šablonus - contact_us.html:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

  &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"{{ url_for('contact_success') }}"</span>&gt;
      {{ form.hidden_tag() }}
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.name.label(class="form-control-label") }}
      {{ form.name(class="form-control") }}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.email.label(class="form-control-label") }}
      {{ form.email(class="form-control") }}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.body.label(class="form-control-label") }}
      {{ form.body(class="form-control", <span style="color: #83a598;">rows</span>="5") }}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      {{ form.submit }}
  &lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
reikėtų atkreipti dėmesį, kad Bootstrap klasės rašomos į kintamųjų
parametrus
</p>

<p>
ir sėkmės puslapiui - contact_success.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Forma u&#382;pildyta s&#279;kmingai!</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;Vardas: {{form.name.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;El. pa&#353;tas: {{form.email.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;Tekstas:&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{form.body.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;

{% endblock %}
</pre>
</div>

<p>
kadangi apie duomenų bazes kalbėsime sekančioje paskaitoje, su šiuo
labai nesistengėme, išgaudysime formos reikšmes į pliką HTML.
</p>


<div class="figure">
<p><img src="./static/images/flask2_5.png" alt="flask2_5.png" width="600px" />
</p>
</div>

<p>
paspaudus 'Submit' mygtuką, mes niekur nenukreipiami, nes forma
nepraėjo validacijos filtrų. Būtų gerai, jeigu mus informuotų, kas
atsitiko. Reikia koreguoti formos šabloną:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

  &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span>&gt;
      {{ form.csrf_token }}
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.name.label(class="form-control-label") }}
      {{ form.name(class="form-control") }}
      {% if form.name.errors %}
        {% for error in form.name.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
      {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.email.label(class="form-control-label") }}
      {{ form.email(class="form-control") }}
      {% if form.email.errors %}
        {% for error in form.email.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
      {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.body.label(class="form-control-label") }}
      {{ form.body(class="form-control", <span style="color: #83a598;">rows</span>="5") }}
      {% if form.body.errors %}
        {% for error in form.body.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
      {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      {{ form.submit }}
  &lt;/<span style="color: #b8bb26;">form</span>&gt;

{% endblock %}
</pre>
</div>

<p>
Atrodo painiai :) Tai tik po kiekvienu lauku nurodyta sąlyga, kad
jeigu tam laukui yra kažkokios klaidos, praiteruojame jas, ir
parašome, kas tai per klaida:
</p>


<div class="figure">
<p><img src="./static/images/flask2_6.png" alt="flask2_6.png" width="600px" />
</p>
</div>

<p>
Na ir pagaliau pabandykime teisingai suvesti:
</p>


<div class="figure">
<p><img src="./static/images/flask2_7.png" alt="flask2_7.png" width="600px" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orge7f5c20" class="outline-3">
<h3 id="orge7f5c20"><span class="section-number-3">3.2</span> Uzduotis</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org73aeb6f" class="outline-4">
<h4 id="org73aeb6f"><span class="section-number-4">3.2.1</span> app.py</h4>
<div class="outline-text-4" id="text-3-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template, request, redirect, url_for, flash
<span style="color: #fb4934;">from</span> form <span style="color: #fb4934;">import</span> ContactForm


<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SECRET_KEY'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'bet kokia simboli&#371; eilut&#279;'</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">form</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = ContactForm<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'success.html'</span>, form=form<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'form.html'</span>, form=form<span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> app.run<span style="color: #fe8019;">(</span>host=<span style="color: #b8bb26;">'127.0.0.1'</span>, port=8000, debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org0b4725e" class="outline-4">
<h4 id="org0b4725e"><span class="section-number-4">3.2.2</span> form.py</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> StringField, PasswordField, SelectField, SubmitField, BooleanField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired, Length, Email, InputRequired


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">ContactForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">email</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Vardas'</span>, <span style="color: #cc241d;">[</span>Email<span style="color: #b8bb26;">(</span>message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Neteisingas adresas.'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span>, DataRequired<span style="color: #b8bb26;">(</span>message=<span style="color: #b8bb26;">'Lauk&#261; b&#363;tina u&#382;pildyti'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">password</span> = PasswordField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Slapta&#382;odis'</span>, validators=<span style="color: #cc241d;">[</span>Length<span style="color: #b8bb26;">(</span><span style="color: #fe8019;">min</span>=8, message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Per ma&#382;ai simboli&#371;!'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span>, DataRequired<span style="color: #b8bb26;">(</span>message=<span style="color: #b8bb26;">'Lauk&#261; b&#363;tina u&#382;pildyti'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">address1</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Adresas (pirma eilut&#279;)'</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">(</span>message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Lauk&#261; b&#363;tina u&#382;pildyti'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span>, Length<span style="color: #b8bb26;">(</span><span style="color: #fe8019;">min</span>=4, message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Per ma&#382;ai simboli&#371;!'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">address2</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Adresas (antra eilut&#279;)'</span>, validators=<span style="color: #cc241d;">[</span>Length<span style="color: #b8bb26;">(</span><span style="color: #fe8019;">min</span>=4, message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Per ma&#382;ai simboli&#371;'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">city</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Miestas'</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">(</span>message=<span style="color: #b8bb26;">'Lauk&#261; b&#363;tina u&#382;pildyti'</span><span style="color: #b8bb26;">)</span>, Length<span style="color: #b8bb26;">(</span><span style="color: #fe8019;">min</span>=4, message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Per ma&#382;ai simboli&#371;'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">state</span> = SelectField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Rajonas'</span>, choices=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'vln'</span>, <span style="color: #b8bb26;">'Vilniaus'</span><span style="color: #b8bb26;">)</span>, <span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'kns'</span>, <span style="color: #b8bb26;">'Kauno'</span><span style="color: #b8bb26;">)</span>, <span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'klp'</span>, <span style="color: #b8bb26;">'Klaip&#279;dos'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">(</span>message=<span style="color: #b8bb26;">'Lauk&#261; b&#363;tina u&#382;pildyti'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">zip_code</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pa&#353;to kodas'</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">(</span>message=<span style="color: #b8bb26;">'Lauk&#261; b&#363;tina u&#382;pildyti'</span><span style="color: #b8bb26;">)</span>, Length<span style="color: #b8bb26;">(</span><span style="color: #fe8019;">min</span>=4, message=<span style="color: #83a598;">(</span><span style="color: #b8bb26;">'Per ma&#382;ai simboli&#371;'</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">agree</span> = BooleanField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Sutinku gauti &#353;lam&#353;t&#261;'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Submit'</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf449a8a" class="outline-4">
<h4 id="orgf449a8a"><span class="section-number-4">3.2.3</span> templates/base.html</h4>
<div class="outline-text-4" id="text-3-2-3">
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #fb4934;">!doctype</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;
  &lt;<span style="color: #b8bb26;">head</span>&gt;
    <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Required meta tags </span><span style="color: #928374;">--&gt;</span>
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"utf-8"</span>&gt;
    &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"viewport"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;

    <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Bootstrap CSS </span><span style="color: #928374;">--&gt;</span>
    &lt;<span style="color: #b8bb26;">link</span> <span style="color: #83a598;">rel</span>=<span style="color: #b8bb26;">"stylesheet"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;

    &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Superform</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;
  &lt;/<span style="color: #b8bb26;">head</span>&gt;
  &lt;<span style="color: #b8bb26;">body</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;
        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
            {% block content %}
            {% endblock %}
        &lt;/<span style="color: #b8bb26;">div</span>&gt;

    <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Optional JavaScript </span><span style="color: #928374;">--&gt;</span>
    <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">jQuery first, then Popper.js, then Bootstrap JS </span><span style="color: #928374;">--&gt;</span>
    &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://code.jquery.com/jquery-3.4.1.slim.min.js"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
    &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
    &lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
  &lt;/<span style="color: #b8bb26;">body</span>&gt;
&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc756917" class="outline-4">
<h4 id="orgc756917"><span class="section-number-4">3.2.4</span> templates/form.html</h4>
<div class="outline-text-4" id="text-3-2-4">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}

&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span>&gt;
    {{ form.csrf_token }}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-row"</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group col-md-6"</span>&gt;
        {{ form.email.label(class="form-control-label") }}
        {{ form.email(class="form-control") }}
        {% if form.email.errors %}
        {% for error in form.email.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
        {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group col-md-6"</span>&gt;
        {{ form.password.label(class="form-control-label") }}
        {{ form.password(class="form-control") }}
        {% if form.password.errors %}
        {% for error in form.password.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
        {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.address1.label(class="form-control-label") }}
        {{ form.address1(class="form-control") }}
        {% if form.address1.errors %}
        {% for error in form.address1.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
        {% endif %}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.address2.label(class="form-control-label") }}
        {{ form.address2(class="form-control") }}
        {% if form.address2.errors %}
        {% for error in form.address2.errors %}
          &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
        {% endfor %}
        {% endif %}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-row"</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group col-md-6"</span>&gt;
            {{ form.city.label(class="form-control-label") }}
            {{ form.city(class="form-control") }}
            {% if form.city.errors %}
            {% for error in form.city.errors %}
                &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
            {% endfor %}
            {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group col-md-4"</span>&gt;
            {{ form.state.label(class="form-control-label") }}
            {{ form.state(class="form-control") }}
            {% if form.state.errors %}
            {% for error in form.state.errors %}
                &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
            {% endfor %}
            {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group col-md-2"</span>&gt;
            {{ form.zip_code.label(class="form-control-label") }}
            {{ form.zip_code(class="form-control") }}
            {% if form.zip_code.errors %}
            {% for error in form.zip_code.errors %}
                &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
            {% endfor %}
            {% endif %}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-check"</span>&gt;
            {{ form.agree(class="form-check-input") }}
            {{ form.agree.label(class="form-check-label") }}
            {% if form.agree.errors %}
            {% for error in form.agree.errors %}
                &lt;<span style="color: #b8bb26;">small</span>&gt;&lt;<span style="color: #b8bb26;">font</span> <span style="color: #83a598;">color</span>=<span style="color: #b8bb26;">"red"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">font</span>&gt;&lt;/<span style="color: #b8bb26;">small</span>&gt;
            {% endfor %}
            {% endif %}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;
    {{ form.submit }}
  &lt;/<span style="color: #b8bb26;">form</span>&gt;

{% endblock %}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf35fc23" class="outline-4">
<h4 id="orgf35fc23"><span class="section-number-4">3.2.5</span> templates/success.html</h4>
<div class="outline-text-4" id="text-3-2-5">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Forma u&#382;pildyta s&#279;kmingai!</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;&lt;<span style="color: #b8bb26;">br</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;Email: {{form.email.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;Password: {{form.password.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;Adresas:&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{form.address1.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{form.address2.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{form.zip_code.data}} {{form.city.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{form.state.data}} raj.&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{form.agree.data}}&lt;/<span style="color: #b8bb26;">p</span>&gt;

{% endblock %}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc2878d2" class="outline-2">
<h2 id="orgc2878d2"><span class="section-number-2">4</span> Flask 3 dalis</h2>
<div class="outline-text-2" id="text-4">
<p>
once again, do pip install flask-sqlalchemy==2.5.1
</p>

<p>
we will use this, not the current +3 version for some of the projects
listed below to work.
</p>
</div>

<div id="outline-container-org8cabfdc" class="outline-3">
<h3 id="org8cabfdc"><span class="section-number-3">4.1</span> Duomenų bazės sukūrimas</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Flask leidžia mums dirbti su duomenų bazėmis, praktiškai nesitepant
rankų su SQL užklausomis. Viskuo pasirūpina modulis Flask-SQLAlchemy.
Iš principo tai yra SQLAlchemy, optimizuota Flask'ui. Ją galima
įdiegti naudojant pip install Flask-SQLAlchemy komandą.
</p>

<p>
Susikurkime pirmą duomenų bazę:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> os
<span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask
<span style="color: #fb4934;">from</span> flask_sqlalchemy <span style="color: #fb4934;">import</span> SQLAlchemy

<span style="color: #83a598;">basedir</span> = os.path.abspath<span style="color: #fe8019;">(</span>os.path.dirname<span style="color: #cc241d;">(</span>__file__<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">pilnas kelias iki &#353;io failo.</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
app.app_context<span style="color: #fe8019;">()</span>.push<span style="color: #fe8019;">()</span>

<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span>+os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'data.sqlite'</span><span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">nustat&#279;me, kad m&#363;s&#371; duomen&#371; baz&#279; bus &#353;alia &#353;io failo esants data.sqlite failas</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">False</span>
<span style="color: #928374;"># </span><span style="color: #928374;">neseksime kiekvienos modifikacijos</span>
<span style="color: #83a598;">db</span> = SQLAlchemy<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">sukuriame duomen&#371; baz&#279;s objekt&#261;</span>
<span style="color: #928374;"># </span><span style="color: #928374;">sukurkime model&#303; u&#382;klausos formai, kuris sukurs duomen&#371; baz&#279;je lentel&#281;</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Message</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">DB lentelei priskiria pavadinim&#261;, jei nenurodysite, priskirs automati&#353;kai pagal klas&#279;s pavadinim&#261;.</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'messages'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>  <span style="color: #928374;"># </span><span style="color: #928374;">stulpelis, kurio reik&#353;m&#279;s integer. Taip pat jis bus primary_key.</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">name</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>80<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">email</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">message</span> = db.Column<span style="color: #fe8019;">(</span>db.Text, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, name, email, message<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.name = name
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.email = email
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.message = message

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">'{self.name} - {self.email}'</span>
</pre>
</div>

<p>
class Message yra aprašyta mūsų duomenų bazės lentelė. Paleidus šį
failą, duomenų bazė nesusikurs, reikia inicijuoti šį veiksmą iš išorės
(per konsolę arba kitą Python script'ą). Susikurkime dar vieną Python
failą:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> app <span style="color: #fb4934;">import</span> db, Message

db.create_all<span style="color: #fe8019;">()</span>  <span style="color: #928374;"># </span><span style="color: #928374;">sukurs m&#363;s&#371; lentel&#281; DB</span>

<span style="color: #928374;"># </span><span style="color: #928374;">I&#353; karto inicijuosime testams kelet&#261; &#303;ra&#353;&#371;:</span>
<span style="color: #83a598;">jonas</span> = Message<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Jonas'</span>, <span style="color: #b8bb26;">'jonas@mail.com'</span>, <span style="color: #b8bb26;">'Ka&#382;koks labai rimtas atsiliepimas.'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">antanas</span> = Message<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Antanas'</span>, <span style="color: #b8bb26;">'antanas@mail.lt'</span>, <span style="color: #b8bb26;">'Antano nuomon&#279; labai svarbi.'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">juozas</span> = Message<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Juozas'</span>, <span style="color: #b8bb26;">'juozukas@friends.lt'</span>, <span style="color: #b8bb26;">'A&#353; labai piktas, nes blogai.'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">bronius</span> = Message<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Bronius'</span>, <span style="color: #b8bb26;">'bronka@yahoo.com'</span>, <span style="color: #b8bb26;">'A&#353; tai linksmas esu, man patinka.'</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">Prid&#279;sime &#353;iuos veik&#279;jus &#303; m&#363;s&#371; DB</span>
db.session.add_all<span style="color: #fe8019;">(</span><span style="color: #cc241d;">[</span>jonas, antanas, juozas, bronius<span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #928374;"># </span><span style="color: #928374;">.commit i&#353;saugo pakeitimus</span>
db.session.commit<span style="color: #fe8019;">()</span>

<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>jonas.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>antanas.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>bronius.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>juozas.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">1</span>
<span style="color: #928374;"># </span><span style="color: #928374;">2</span>
<span style="color: #928374;"># </span><span style="color: #928374;">4</span>
<span style="color: #928374;"># </span><span style="color: #928374;">3</span>
</pre>
</div>

<p>
.create_all() įrašė lentelę į DB, inicijuoti testiniai duomenys taip
pat sėkmingai nukeliavo į lentelę, atsispausdinome jų ID, kurie buvo
sugeneruoti automatiškai.
</p>
</div>

<div id="outline-container-org5c19413" class="outline-4">
<h4 id="org5c19413"><span class="section-number-4">4.1.1</span> Paprastos CRUD operacijos</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
Susikurkime dar vieną failą, crud operacijų demonstracijai.
Atsispausdinkime visus lentelėje esančius objektus:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> app <span style="color: #fb4934;">import</span> db, Message

<span style="color: #83a598;">all_messages</span> = Message.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>all_messages<span style="color: #fe8019;">)</span>

<span style="color: #928374;">#  </span><span style="color: #928374;">[Jonas - jonas@mail.com, Antanas - antanas@mail.lt, Juozas - juozukas@friends.lt, Bronius - bronka@yahoo.com]</span>
</pre>
</div>

<p>
Atsispausdinkime vieną iš objektų:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">message_1</span> = Message.query.get<span style="color: #fe8019;">(</span>1<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>message_1<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">Jonas - jonas@mail.com</span>
</pre>
</div>


<p>
Išfiltruokime objektą pagal nurodytą požymį:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">message_antanas</span> = Message.query.filter_by<span style="color: #fe8019;">(</span>name=<span style="color: #b8bb26;">'Antanas'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>message_antanas.<span style="color: #fe8019;">all</span><span style="color: #cc241d;">()</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">[Antanas - antanas@mail.lt]</span>
</pre>
</div>

<p>
filter_by išrinks mums visus įrašus, kuriuose name='Antanas'
</p>

<p>
Pakeiskime Antano el. paštą:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">antanas</span> = Message.query.get<span style="color: #fe8019;">(</span>2<span style="color: #fe8019;">)</span>
<span style="color: #83a598;">antanas.email</span> = <span style="color: #b8bb26;">'geras.zmogus@lrs.lt'</span>
db.session.add<span style="color: #fe8019;">(</span>antanas<span style="color: #fe8019;">)</span>
db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>Message.query.<span style="color: #fe8019;">all</span><span style="color: #cc241d;">()</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">[Jonas - jonas@mail.com, Antanas - geras.zmogus@lrs.lt, Juozas - juozukas@friends.lt, Bronius - bronka@yahoo.com]</span>
</pre>
</div>

<p>
Ištrinkime Joną:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">jonas</span> = Message.query.get<span style="color: #fe8019;">(</span>1<span style="color: #fe8019;">)</span>
db.session.delete<span style="color: #fe8019;">(</span>jonas<span style="color: #fe8019;">)</span>
db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>Message.query.<span style="color: #fe8019;">all</span><span style="color: #cc241d;">()</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">[Antanas - geras.zmogus@lrs.lt, Juozas - juozukas@friends.lt, Bronius - bronka@yahoo.com]</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff122dc" class="outline-3">
<h3 id="orgff122dc"><span class="section-number-3">4.2</span> Duomenų bazės migracija</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Jeigu mums prireiktų papildyti savo lentelę papildomu stulpeliu,
tiesiog papildžius klasę Message nauja eilute mums nepavyktų, kadangi
duomenų bazė jau inicijuota tokia, kokią nurodėme pirmą kartą. Tą
reikia turėti omenyje, kas kartą, kuriant duomenų bazę stengtis
pasidaryti ją kuo išbaigtesnę. Tuomet ateityje, norint ją papildyti
naujais stulpeliais, ar pakeisti esamų nustatymus, reikės mažiau
migracijos procesų. Susitvarkykime savo projektą taip, kad galėtumėm
vykdyti migracijas:
</p>

<p>
nustatykime FLASK-APP aplinkos kintamąjį (environment variable). Tą
reikės padaryti Windows komandinėje eilutėje, arba Linux/MacOS
terminale:
</p>

<p>
<b>windows</b> - set FLASK_APP=failas_kuriame_musu_db_modelis.py
</p>

<p>
<b>linux/macOS</b> - <code>export FLASK_APP=failas_kuriame_musu_db_modelis.py</code>
</p>

<p>
įsitikinkite, kad komandą leidžiate iš to paties katalogo, kuriame
failas su jūsų DB modeliu.
</p>

<p>
įdiekime Flask-Migrate paketą (pip install Flask-Migrate)
</p>

<p>
pertvarkykime savo .py failą:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> os
<span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask
<span style="color: #fb4934;">from</span> flask_sqlalchemy <span style="color: #fb4934;">import</span> SQLAlchemy
<span style="color: #fb4934;">from</span> flask_migrate <span style="color: #fb4934;">import</span> Migrate  <span style="color: #928374;"># </span><span style="color: #928374;">importuojame migracijas</span>

<span style="color: #83a598;">basedir</span> = os.path.abspath<span style="color: #fe8019;">(</span>os.path.dirname<span style="color: #cc241d;">(</span>__file__<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span>+os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'data.sqlite'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">False</span>
<span style="color: #83a598;">db</span> = SQLAlchemy<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>

Migrate<span style="color: #fe8019;">(</span>app, db<span style="color: #fe8019;">)</span>  <span style="color: #928374;"># </span><span style="color: #928374;">Susiejame app ir db.</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Message</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'messages'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">name</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>80<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">email</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">phone</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>40<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>  <span style="color: #928374;"># </span><span style="color: #928374;">Papildome duomen&#371; baz&#279;s model&#303; nauju stulpeliu.</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">message</span> = db.Column<span style="color: #fe8019;">(</span>db.Text, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">prie konstruktoriaus irgi nepamir&#353;tame prid&#279;ti:</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, name, email, message, phone<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.name = name
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.email = email
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.message = message
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.phone = phone

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">'{self.name} - {self.email}'</span>
</pre>
</div>

<p>
Importus papildėme migracijos 'tarnyba':) Jai nurodėme, kokią
aplikaciją susieti su kokia duomenų baze. Papildėme duomenų bazės
modelį nauju stulpeliu (phone).
</p>

<p>
Inicijuokime migracijas mūsų projektui su komanda <code>flask db init</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>flask-kursui<span style="color: #fe8019;">)</span> robotautas@robotautas-MS-7A34:~/Dropbox/Flask 3 dalis/Code$ flask db init
Creating directory /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations ...  done
Creating directory /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/versions ...  done
Generating /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/alembic.ini ...  done
Generating /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/README ...  done
Generating /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/env.py ...  done
Generating /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/script.py.mako ...  done
Please edit configuration/connection/logging settings<span style="color: #fb4934;"> in</span> <span style="color: #b8bb26;">'/home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/alembic.ini'</span> before proceeding.
<span style="color: #fe8019;">(</span>flask-kursui<span style="color: #fe8019;">)</span> robotautas@robotautas-MS-7A34:~/Dropbox/Flask 3 dalis/Code$ ls
app.py  data.sqlite  migrations  __pycache__  setupdb.py  simple_crud.py  test.py
</pre>
</div>

<p>
matome, kad sukurtas migracijų katalogas. Dabar paruoškime savo pirmą
migraciją, <code>flask db migrate -m "žinutė atminčiai"</code>:
</p>

<p>
(jei tai darome pakartotinai ir matome klaidą "ERROR [flask_migrate]
Error: Target database is not up to date.", reikės prieš tai paleisti
"flask db stamp head")
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>flask-kursui<span style="color: #fe8019;">)</span> robotautas@robotautas-MS-7A34:~/Dropbox/Flask 3 dalis/Code$ flask db migrate -m <span style="color: #b8bb26;">"prid&#279;tas stulpelis phone"</span>
INFO  <span style="color: #fe8019;">[</span>alembic.runtime.migration<span style="color: #fe8019;">]</span> Context impl SQLiteImpl.
INFO  <span style="color: #fe8019;">[</span>alembic.runtime.migration<span style="color: #fe8019;">]</span> Will assume non-transactional DDL.
INFO  <span style="color: #fe8019;">[</span>alembic.autogenerate.compare<span style="color: #fe8019;">]</span> Detected added column <span style="color: #b8bb26;">'messages.phone'</span>
INFO  <span style="color: #fe8019;">[</span>alembic.autogenerate.compare<span style="color: #fe8019;">]</span> Detected added unique constraint <span style="color: #b8bb26;">'None'</span> on <span style="color: #b8bb26;">'['</span>phone<span style="color: #b8bb26;">']'</span>
Generating /home/robotautas/Dropbox/Flask 3 dalis/Code/migrations/versions/d31d8cda085d_prid&#279;tas_stulpelis_phone.py ...  done
</pre>
</div>

<p>
matome, kad aptikti pakeitimai. Dabar įvykdykime pačią migraciją,
<code>flask db upgrade</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>flask-kursui<span style="color: #fe8019;">)</span> robotautas@robotautas-MS-7A34:~/Dropbox/Flask 3 dalis/Code$ flask db upgrade
INFO  <span style="color: #fe8019;">[</span>alembic.runtime.migration<span style="color: #fe8019;">]</span> Context impl SQLiteImpl.
INFO  <span style="color: #fe8019;">[</span>alembic.runtime.migration<span style="color: #fe8019;">]</span> Will assume non-transactional DDL.
INFO  <span style="color: #fe8019;">[</span>alembic.runtime.migration<span style="color: #fe8019;">]</span> Running upgrade  -&gt; d31d8cda085d, prid&#279;tas stulpelis phone
ERROR <span style="color: #fe8019;">[</span>root<span style="color: #fe8019;">]</span> Error: No support for ALTER of constraints<span style="color: #fb4934;"> in</span> SQLite dialect

<span style="color: #928374;"># </span><span style="color: #928374;">klaidel&#281; galime ignoruoti, ne visi&#353;kas dialekto palaikymas..</span>
</pre>
</div>

<p>
patikrinkime, ar suveikė:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">messages</span> = Message.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>

<span style="color: #fb4934;">for</span> i <span style="color: #fb4934;">in</span> messages:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">random_phone</span> = randint<span style="color: #fe8019;">(</span>999999, 10000000<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">i.phone</span> = <span style="color: #fe8019;">str</span><span style="color: #fe8019;">(</span>random_phone<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>i<span style="color: #fe8019;">)</span>

db.session.commit<span style="color: #fe8019;">()</span>

<span style="color: #fb4934;">for</span> x <span style="color: #fb4934;">in</span> messages:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">print</span> <span style="color: #fe8019;">(</span>f<span style="color: #b8bb26;">'{x.id}, {x.name}, {x.email}, {x.phone}, {x.message}'</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">2, Antanas, geras.zmogus@lrs.lt, 9033639, Antano nuomon&#279; labai svarbi.</span>
<span style="color: #928374;"># </span><span style="color: #928374;">3, Juozas, juozukas@friends.lt, 2233484, A&#353; labai piktas, nes blogai.</span>
<span style="color: #928374;"># </span><span style="color: #928374;">4, Bronius, bronka@yahoo.com, 4211290, A&#353; tai linksmas esu, man patinka.</span>
</pre>
</div>

<p>
Jeigu atkreipėte dėmesį, migracijų procesas labai panašus į GIT procesus.
</p>
</div>
</div>

<div id="outline-container-org83b7e62" class="outline-3">
<h3 id="org83b7e62"><span class="section-number-3">4.3</span> Uzduotis</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Sukurkite peticijos puslapį. Gali pažiūrėti <a href="https://github.com/robotautas/kursas/blob/master/Flask/Flask_3_uzduotis/Uzduotis/take1.mkv">demonstraciją</a>, kaip turėtų
atrodyti galutinis rezultatas.
</p>

<p>
Šiame puslapyje turėtų būti išpildyti žemiau išvardinti reikalavimai:
</p>

<p>
Puslapio navigacijoje turi būti nuorodos į pagrindinį puslapį ir
/about.
</p>

<p>
Pagrindiniame puslapyje turi būti forma, kurioje reikia įvesti vardą,
pavardę ir komentarą. Po ja - pasirašiusiųjų sąrašas: eil.nr, vardas
pavardė, data ir komentaras
</p>

<p>
Jeigu forma užpildyta sėkmingai, sąrašas papildomas paskutiniu įrašu,
o vietoje formos atsiranda padėkos žinutė (angl. success message).
</p>

<p>
Įrašus saugokite sqlite duomenų bazėjė.
</p>

<p>
Jums reikės atrasti būdą, kaip prieš sugeneruojant šabloną į duomenų
bazę perkelti formos duomenis
</p>

<p>
Pavienės wtf-formos reikšmės traukiamos taip, pvz: form.name.data
</p>

<p>
Padaryti formos validaciją (šitą galite pasilikti pabaigai ir
padaryti, jeigu liks laiko)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #928374;"># </span><span style="color: #928374;">app.py</span>

<span style="color: #fb4934;">import</span> os
<span style="color: #fb4934;">from</span> datetime <span style="color: #fb4934;">import</span> datetime
<span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, render_template
<span style="color: #fb4934;">from</span> flask_migrate <span style="color: #fb4934;">import</span> Migrate
<span style="color: #fb4934;">from</span> flask_sqlalchemy <span style="color: #fb4934;">import</span> SQLAlchemy
<span style="color: #fb4934;">from</span> form <span style="color: #fb4934;">import</span> MessageForm


<span style="color: #83a598;">basedir</span> = os.path.abspath<span style="color: #fe8019;">(</span>os.path.dirname<span style="color: #cc241d;">(</span>__file__<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SECRET_KEY'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'bet kokia simboli&#371; eilut&#279;'</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span>+os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'data.sqlite'</span><span style="color: #fe8019;">)</span>

<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">False</span>
<span style="color: #83a598;">db</span> = SQLAlchemy<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>
Migrate<span style="color: #fe8019;">(</span>app, db<span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Message</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'messages'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">fname</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>80<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">lname</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>80<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">date</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>80<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">comment</span> = db.Column<span style="color: #fe8019;">(</span>db.Text, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, fname, lname, comment, date<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.fname = fname
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.lname = lname
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.comment = comment
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.date = date

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">'{self.fname} - {self.lname}'</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">index</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">data</span> = Message.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()[</span>::-1<span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = MessageForm<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">fname</span> = form.fname.data
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">lname</span> = form.lname.data
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">comment</span> = form.comment.data
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">now</span> = datetime.now<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">date</span> = now.strftime<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"%d/%m/%Y %H:%M:%S"</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">entry</span> = Message<span style="color: #fe8019;">(</span>fname=fname, lname=lname, comment=comment, date=date<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>entry<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">data</span> = Message.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()[</span>::-1<span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">stats</span> = 20000 - <span style="color: #fe8019;">len</span><span style="color: #fe8019;">(</span>data<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'index.html'</span>, form=<span style="color: #d3869b;">False</span>, data=data, stats = stats<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'index.html'</span>, form=form, data=data<span style="color: #fe8019;">)</span>


<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/about'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">about</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'about.html'</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> app.run<span style="color: #fe8019;">(</span>host=<span style="color: #b8bb26;">'127.0.0.1'</span>, port=8000, debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #928374;"># </span><span style="color: #928374;">form.py</span>
<span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> StringField, TextAreaField, SubmitField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">MessageForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">fname</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Vardas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">lname</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">comment</span> = TextAreaField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Komentaras'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pasira&#353;yti'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">about.html </span><span style="color: #928374;">--&gt;</span>
{% extends "base.html" %}

{% block content %}
&lt;<span style="color: #b8bb26;">img</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://images2.minutemediacdn.com/image/upload/c_fill,g_auto,h_1248,w_2220/f_auto,q_auto,w_1100/v1555446335/shape/mentalfloss/istock_000019974211_small.jpg"</span> /&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;Zombie ipsum reversus ab viral inferno, nam rick grimes malum cerebro. De carne lumbering animata corpora quaeritis.
  Summus brains sit&#8203;&#8203;, morbo vel maleficia? De apocalypsi gorger omero undead survivor dictum mauris. Hi mindless
  mortuis soulless creaturas, imo evil stalking monstra adventus resi dentevil vultus comedat cerebella viventium.
  Qui animated corpse, cricket bat max brucks terribilem incessu zomby. The voodoo sacerdos flesh eater, suscitat
  mortuos comedere carnem virus. Zonbi tattered for solum oculi eorum defunctis go lum cerebro. Nescio brains an
  Undead zombies. Sicut malus putrid voodoo horror. Nigh tofth eliv ingdead.
&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endblock %}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">base.html </span><span style="color: #928374;">--&gt;</span>

&lt;<span style="color: #fb4934;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #b8bb26;">html</span> <span style="color: #83a598;">lang</span>=<span style="color: #b8bb26;">"en"</span>&gt;

&lt;<span style="color: #b8bb26;">head</span>&gt;

  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">charset</span>=<span style="color: #b8bb26;">"utf-8"</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"viewport"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"description"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">""</span>&gt;
  &lt;<span style="color: #b8bb26;">meta</span> <span style="color: #83a598;">name</span>=<span style="color: #b8bb26;">"author"</span> <span style="color: #83a598;">content</span>=<span style="color: #b8bb26;">""</span>&gt;

  &lt;<span style="color: #b8bb26;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Bare - Start Bootstrap Template</span>&lt;/<span style="color: #b8bb26;">title</span>&gt;

  <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Bootstrap core CSS </span><span style="color: #928374;">--&gt;</span>
  &lt;<span style="color: #b8bb26;">link</span> <span style="color: #83a598;">rel</span>=<span style="color: #b8bb26;">"stylesheet"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;


&lt;/<span style="color: #b8bb26;">head</span>&gt;

&lt;<span style="color: #b8bb26;">body</span>&gt;

  <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Navigation </span><span style="color: #928374;">--&gt;</span>
  &lt;<span style="color: #b8bb26;">nav</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar navbar-expand-lg navbar-dark bg-primary static-top"</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
      &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-brand"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/"</span>&gt;Bebr&#371; med&#382;ioklei NE!&lt;/<span style="color: #b8bb26;">a</span>&gt;
      &lt;<span style="color: #b8bb26;">button</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler"</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"button"</span> <span style="color: #83a598;">data-toggle</span>=<span style="color: #b8bb26;">"collapse"</span> <span style="color: #83a598;">data-target</span>=<span style="color: #b8bb26;">"#navbarResponsive"</span> <span style="color: #83a598;">aria-controls</span>=<span style="color: #b8bb26;">"navbarResponsive"</span> <span style="color: #83a598;">aria-expanded</span>=<span style="color: #b8bb26;">"false"</span> <span style="color: #83a598;">aria-label</span>=<span style="color: #b8bb26;">"Toggle navigation"</span>&gt;
        &lt;<span style="color: #b8bb26;">span</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler-icon"</span>&gt;&lt;/<span style="color: #b8bb26;">span</span>&gt;
      &lt;/<span style="color: #b8bb26;">button</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"collapse navbar-collapse"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"navbarResponsive"</span>&gt;
        &lt;<span style="color: #b8bb26;">ul</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-nav ml-auto"</span>&gt;
          &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
            &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/"</span>&gt;Peticija&lt;/<span style="color: #b8bb26;">a</span>&gt;
          &lt;/<span style="color: #b8bb26;">li</span>&gt;
          &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
            &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/about"</span>&gt;Apie&lt;/<span style="color: #b8bb26;">a</span>&gt;
          &lt;/<span style="color: #b8bb26;">li</span>&gt;
        &lt;/<span style="color: #b8bb26;">ul</span>&gt;
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
  &lt;/<span style="color: #b8bb26;">nav</span>&gt;

  <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Page Content </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
  &lt;<span style="color: #b8bb26;">br</span>&gt;
{% block content %}
{% endblock %}
&lt;/<span style="color: #b8bb26;">div</span>&gt;


  <span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Bootstrap core JavaScript </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://code.jquery.com/jquery-3.3.1.slim.min.js"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
&lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;
&lt;<span style="color: #b8bb26;">script</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"</span> <span style="color: #83a598;">integrity</span>=<span style="color: #b8bb26;">"sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"</span> <span style="color: #83a598;">crossorigin</span>=<span style="color: #b8bb26;">"anonymous"</span>&gt;&lt;/<span style="color: #b8bb26;">script</span>&gt;

&lt;/<span style="color: #b8bb26;">body</span>&gt;

&lt;/<span style="color: #b8bb26;">html</span>&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">index.html </span><span style="color: #928374;">--&gt;</span>

{% extends "base.html" %}

{% block content %}
{% if form %}
&lt;<span style="color: #b8bb26;">h4</span>&gt;<span style="text-decoration: underline;">M&#363;s&#371; &#353;ventas tikslas yra u&#382;kirsti keli&#261; barbari&#353;kai bebr&#371; med&#382;ioklei. Pra&#353;ome pasira&#353;yti peticij&#261;!</span>&lt;/<span style="color: #b8bb26;">h4</span>&gt;
&lt;<span style="color: #b8bb26;">br</span>&gt;

&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span>&gt;
      {{ form.hidden_tag() }}
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.fname.label(class="form-control-label") }}
      {{ form.fname(class="form-control") }}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.lname.label(class="form-control-label") }}
      {{ form.lname(class="form-control") }}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
      {{ form.comment.label(class="form-control-label") }}
      {{ form.comment(class="form-control", <span style="color: #83a598;">rows</span>="5") }}
      &lt;/<span style="color: #b8bb26;">div</span>&gt;
      {{ form.submit }}
  &lt;/<span style="color: #b8bb26;">form</span>&gt;
{% else %}

&lt;<span style="color: #b8bb26;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">A&#269;i&#363;, kad pasira&#353;&#279;te. Mums liko surinkti {{stats}} para&#353;&#371;!</span>&lt;/<span style="color: #b8bb26;">h3</span>&gt;

{% endif %}
{% for i in data %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{i.id}}. {{i.fname}} {{i.lname}}, {{i.date}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{i.comment}}&lt;/<span style="color: #b8bb26;">p</span>&gt;


{% endfor %}
{% endblock %}
</pre>
</div>


<p>
<a href="https://github.com/CodeAcademy-Online/Python/tree/lesson-16">Atsakymai</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org728174a" class="outline-2">
<h2 id="org728174a"><span class="section-number-2">5</span> Flask 4 dalis</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org6b06b70" class="outline-3">
<h3 id="org6b06b70"><span class="section-number-3">5.1</span> One2Many</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Dauguma programų turi po daugiau negu vieną duomenų bazės modelį.
Įsivaizduokime, kad turime du modelius - knyga ir leidykla:
</p>

<ul class="org-ul">
<li>Knyga
<ul class="org-ul">
<li>ISBN (Primary Key)</li>
<li>Autorius</li>
<li>Pavadinimas</li>
<li>Leidyklos ID (Foreign Key)</li>
</ul></li>

<li>Leidykla
<ul class="org-ul">
<li>ID (Primary Key)</li>
<li>Pavadinimas</li>
<li>Adresas</li>
</ul></li>
</ul>

<p>
Viena leidykla gali turėti daug knygų, pabandykime sumodeliuoti
duomenų bazę šiam atvejui.
</p>

<p>
Susikurkime app.py:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> os
<span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask
<span style="color: #fb4934;">from</span> flask_sqlalchemy <span style="color: #fb4934;">import</span> SQLAlchemy
<span style="color: #fb4934;">from</span> flask_migrate <span style="color: #fb4934;">import</span> Migrate

<span style="color: #83a598;">basedir</span> = os.path.abspath<span style="color: #fe8019;">(</span>os.path.dirname<span style="color: #cc241d;">(</span>__file__<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
app.app_context<span style="color: #fe8019;">()</span>.push<span style="color: #fe8019;">()</span>

<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span> + os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'data.sqlite'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">False</span>

<span style="color: #83a598;">db</span> = SQLAlchemy<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>
Migrate<span style="color: #fe8019;">(</span>app, db<span style="color: #fe8019;">)</span>

<span style="color: #b8bb26;">'''</span>
<span style="color: #b8bb26;">Klas&#279;je Book mus domina publisher_id kintamasis. Jis susieja klas&#281; Book su klase Publisher per ForeignKey,</span>
<span style="color: #b8bb26;">kuriame parametruose nurodytas kitos lentel&#279;s pavadinimas ir prie kurio lauko ri&#353;ame, t.y. prie id,</span>
<span style="color: #b8bb26;">kuris publishers lentel&#279;je yra primary_key.</span>
<span style="color: #b8bb26;">'''</span>
<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Book</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'books'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">author</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>150<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">title</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>300<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">publisher_id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, db.ForeignKey<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'publishers.id'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, author, title, publisher_id<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.author = author
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.title = title
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.publisher_id = publisher_id

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fb4934;">self</span>.title

<span style="color: #b8bb26;">'''</span>
<span style="color: #b8bb26;">Klas&#279;je Publisher, atgalin&#303; ry&#353;&#303; su Books klase sukuria books kintam&#261;jam priskirta eilut&#279;.</span>
<span style="color: #b8bb26;">Parametruose nurodyta klas&#279;, su kuria siejame ir backref - kol kas &#382;i&#363;r&#279;kite, kaip &#303; papildom&#261;</span>
<span style="color: #b8bb26;">sait&#261; tarp python klasi&#371;.</span>
<span style="color: #b8bb26;">'''</span>
<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Publisher</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'publishers'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">name</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>100<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">books</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Book'</span>, backref=<span style="color: #b8bb26;">'publisher'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, name<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.name = name

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fb4934;">self</span>.name
</pre>
</div>

<p>
Sukūrėme du modelius, šiek tiek detalių rasite komentaruose.
Išbandykime, ar veikia:
</p>

<p>
terminale -
</p>
<ul class="org-ul">
<li>set FLASK_APP=app.py,</li>
<li>flask db init,</li>
<li>flask db migrate -m "pirma migracija",</li>
<li>flask db upgrade.</li>
</ul>

<p>
šį kartą dirbsime iš python konsolės:
</p>

<div class="org-src-container">
<pre class="src src-python">Python 3.7.3 <span style="color: #fe8019;">(</span>default, Mar 27 2019, 22:11:17<span style="color: #fe8019;">)</span>
<span style="color: #fe8019;">[</span>GCC 7.3.0<span style="color: #fe8019;">]</span> :: Anaconda, Inc. on linux
Type <span style="color: #b8bb26;">"help"</span>, <span style="color: #b8bb26;">"copyright"</span>, <span style="color: #b8bb26;">"credits"</span> <span style="color: #fb4934;">or</span> <span style="color: #b8bb26;">"license"</span> <span style="color: #fb4934;">for</span> more information.
&gt;&gt;&gt; <span style="color: #fb4934;">from</span> app <span style="color: #fb4934;">import</span> db, Book, Publisher
&gt;&gt;&gt; <span style="color: #83a598;">pub1</span> = Publisher<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Baltos Lankos'</span><span style="color: #fe8019;">)</span>
&gt;&gt;&gt; <span style="color: #83a598;">pub2</span> = Publisher<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Alma Littera'</span><span style="color: #fe8019;">)</span>
&gt;&gt;&gt; db.session.add_all<span style="color: #fe8019;">(</span><span style="color: #cc241d;">[</span>pub1, pub2<span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
&gt;&gt;&gt; db.session.commit<span style="color: #fe8019;">()</span>
&gt;&gt;&gt; <span style="color: #83a598;">book1</span> = Book<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Bili&#363;nas'</span>, <span style="color: #b8bb26;">'Kliud&#382;iau'</span>, 1<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; <span style="color: #83a598;">book2</span> = Book<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#381;emait&#279;'</span>, <span style="color: #b8bb26;">'Marti'</span>, 1<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; <span style="color: #83a598;">book3</span> = Book<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Ma&#382;vydas'</span>, <span style="color: #b8bb26;">'Katekizmas'</span>, 2<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; db.session.add_all<span style="color: #fe8019;">(</span><span style="color: #cc241d;">[</span>book1, book2, book3<span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
&gt;&gt;&gt; db.session.commit<span style="color: #fe8019;">()</span>
</pre>
</div>

<p>
Susikūrėme bandomuosius duomenis. Patikrinkime, ar pavyko:
</p>

<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span style="color: #83a598;">books</span> = Book.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
&gt;&gt;&gt; books
<span style="color: #fe8019;">[</span>Kliud&#382;iau, Marti, Katekizmas<span style="color: #fe8019;">]</span>
&gt;&gt;&gt; <span style="color: #83a598;">pubs</span> = Publisher.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
&gt;&gt;&gt; pubs
<span style="color: #fe8019;">[</span>Baltos Lankos, Alma Littera<span style="color: #fe8019;">]</span>
&gt;&gt;&gt; <span style="color: #fb4934;">for</span> i <span style="color: #fb4934;">in</span> books:
...     <span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>i, i.publisher<span style="color: #fe8019;">)</span>
...
Kliud&#382;iau Baltos Lankos
Marti Baltos Lankos
Katekizmas Alma Littera
&gt;&gt;&gt; <span style="color: #fb4934;">for</span> i <span style="color: #fb4934;">in</span> pubs:
...     <span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>i, i.books<span style="color: #fe8019;">)</span>
...
Baltos Lankos <span style="color: #fe8019;">[</span>Kliud&#382;iau, Marti<span style="color: #fe8019;">]</span>
Alma Littera <span style="color: #fe8019;">[</span>Katekizmas<span style="color: #fe8019;">]</span>
&gt;&gt;&gt;
</pre>
</div>

<p>
Matome, kad įrašai kuriasi, ryšiai veikia. Atkreipkite dėmesį, kai
iteravome knygas, nurodėme spausdinti i.publisher, nors tokio
stulpelio ir nėra. Tai reikšmė iš back reference parametro, galima ją
taip naudoti.
</p>
</div>
</div>
<div id="outline-container-orgdefe961" class="outline-3">
<h3 id="orgdefe961"><span class="section-number-3">5.2</span> Many2Many</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Pasitaiko, kad knygos turi ne po vieną autorių. Gaunasi situacija,
daug knygų - daug autorių. Pabandykime sumodeliuoti:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">helper_table</span> = db.Table<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'helper'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.Column<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'book_id'</span>, db.Integer, db.ForeignKey<span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'books.id'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.Column<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'author_id'</span>, db.Integer, db.ForeignKey<span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'authors.id'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Book</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'books'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">title</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>300<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">publisher_id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, db.ForeignKey<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'publishers.id'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">authors</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Author'</span>, secondary=helper_table, backref=<span style="color: #b8bb26;">'books'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, title, publisher_id<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.title = title
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.publisher_id = publisher_id

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fb4934;">self</span>.title


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Publisher</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'publishers'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">name</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>100<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">books</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Book'</span>, backref=<span style="color: #b8bb26;">'publisher'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, name<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.name = name

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fb4934;">self</span>.name


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Author</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'authors'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">fname</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>150<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">lname</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>300<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__init__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, fname, lname<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.fname = fname
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">self</span>.lname = lname

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">__repr__</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> f<span style="color: #b8bb26;">'{self.fname} {self.lname}'</span>
</pre>
</div>

<p>
Pirmiausiai sukūrėme helper_table. Tai ne modelis, o tiesiog pagalbinė
lentelė duomenų bazėje, apjungianti modelius Book ir Author.
</p>

<p>
Modelyje Books vietoje seno author, sukūrėme naują authors stulpelį.
Nurodėme, kad kreipsimės į Author modelį, per pagalbinę lentelę.
Nurodėme backref='books'. Per šio parametro reikšmę vėliau galėsime
kreiptis iš autoriaus į knygos modelį.
</p>

<p>
Sukūrėme modelį Author. Jame jokiais ryšiais rūpintis nereikia, tai
padaryta ankstesniuose punktuose.
</p>

<p>
Viską inicijavus, ir DB atidarius per duombazių administravimo
programą (dbeaver), matome tokią schemą:
</p>


<div class="figure">
<p><img src="./static/images/flask4_1.png" alt="flask4_1.png" width="800px" />
</p>
</div>

<p>
Patikrinimui suvedėme šiek tiek duomenų bandymams:
</p>

<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; books
<span style="color: #fe8019;">[</span>M&#363;s&#371; bendra knyga, Knyga apie gyvenim&#261;, Kaip mes kartu tarnavome<span style="color: #fe8019;">]</span>
&gt;&gt;&gt; pubs
<span style="color: #fe8019;">[</span>Baltos Lankos, Alma Littera<span style="color: #fe8019;">]</span>
&gt;&gt;&gt; authors
<span style="color: #fe8019;">[</span>Valdas Adamkus, Algimantas &#268;ekuolis, Andrius Mamontovas, Antanas Baranauskas<span style="color: #fe8019;">]</span>
</pre>
</div>

<p>
Pažiūrėkime, kaip veikia many2many mechanizmas flask aplinkoje:
</p>

<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span style="color: #83a598;">bendra_knyga</span> = Book.query.filter_by<span style="color: #fe8019;">(</span>title=<span style="color: #b8bb26;">'M&#363;s&#371; bendra knyga'</span><span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
&gt;&gt;&gt; bendra_knyga
M&#363;s&#371; bendra knyga
&gt;&gt;&gt; <span style="color: #83a598;">v_adamkus</span> = Author.query.filter_by<span style="color: #fe8019;">(</span>fname=<span style="color: #b8bb26;">'Valdas'</span><span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
&gt;&gt;&gt; v_adamkus
Valdas Adamkus
&gt;&gt;&gt; <span style="color: #83a598;">a_chuck</span> = Author.query.filter_by<span style="color: #fe8019;">(</span>fname = <span style="color: #b8bb26;">'Algimantas'</span><span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
&gt;&gt;&gt; a_chuck
Algimantas &#268;ekuolis
&gt;&gt;&gt; bendra_knyga.authors.append<span style="color: #fe8019;">(</span>v_adamkus<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; bendra_knyga.authors.append<span style="color: #fe8019;">(</span>a_chuck<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; bendra_knyga.authors
<span style="color: #fe8019;">[</span>Valdas Adamkus, Algimantas &#268;ekuolis<span style="color: #fe8019;">]</span>
</pre>
</div>

<p>
Vienai knygai priskyrėme porą autorių. Pabandykime atvirkštinį
veiksmą:
</p>

<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span style="color: #83a598;">knyga_ag</span> = Book.query.filter_by<span style="color: #fe8019;">(</span>title=<span style="color: #b8bb26;">'Knyga apie gyvenim&#261;'</span><span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
&gt;&gt;&gt; knyga_ag
Knyga apie gyvenim&#261;
&gt;&gt;&gt; <span style="color: #83a598;">knyga_tarnavome</span> = Book.query.filter_by<span style="color: #fe8019;">(</span>title=<span style="color: #b8bb26;">'Kaip mes kartu tarnavome'</span><span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
&gt;&gt;&gt; knyga_tarnavome
Kaip mes kartu tarnavome
&gt;&gt;&gt; a_chuck.books.append<span style="color: #fe8019;">(</span>knyga_tarnavome<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; a_chuck.books.append<span style="color: #fe8019;">(</span>knyga_ag<span style="color: #fe8019;">)</span>
&gt;&gt;&gt; a_chuck.books
<span style="color: #fe8019;">[</span>M&#363;s&#371; bendra knyga, Knyga apie gyvenim&#261;, Kaip mes kartu tarnavome<span style="color: #fe8019;">]</span>
</pre>
</div>

<p>
Pavyko. Čekuolis parašė tris knygas, vieną iš kurių su bendraautoriumi
:) Dar kartą akcentuosiu, kad iš Author į Book modelį kreipiamasi per
backref, šiuo atveju 'books'.
</p>


<div class="figure">
<p><img src="./static/images/flask4_2.png" alt="flask4_2.png" width="800px" />
</p>
</div>

<p>
Taip atrodo helper lentelė - tiesiog knygų ID sąsajos su autorių ID.
</p>
</div>
</div>
<div id="outline-container-org4147a0e" class="outline-3">
<h3 id="org4147a0e"><span class="section-number-3">5.3</span> Many2One ryšio įgyvendinimas su Flask</h3>
<div class="outline-text-3" id="text-5-3">
<p>
<code>Sqlalchemy dalis</code>:
</p>

<p>
Vienas tėvas gali turėti vieną vaiką. Vaikas gali turėti kelis tėvus.
Šiam ryšiui tėvo klasėje sukuriamas vaiko id (foreign key) ir vaiko
objektas (relationship laukas). Iš vaiko pusės ryšio laukai nebūtini.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Tevas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"tevas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavard&#279;"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikas_id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, db.ForeignKey<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">"vaikas.id"</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikas</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vaikas"</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vaikas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"vaikas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavard&#279;"</span>, db.String<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Formos python failas</code>:
</p>

<p>
Tam, kad tėvo formoje galėtume turėti pasirenkamą vaiko lauką, turime
panaudoti QuerySelectField lauką. Atkreipkite dėmesį, kad jį reikia
importuoti iš wtforms_sqlalchemy.fields, o ne wtforms. Štai ką reiškia
šio lauko argumentai:
</p>

<p>
query_factory nurodome funkciją su gražinama vaikų užklausa
(Vaikas.query, priekyje pridėtas app, nes importuotas visas app
failas, kad pasiektume vaiko ir tėvo objektus).
</p>

<p>
allow_blank nustatome reikšmę True. Tai reiškia, kad tėvui leidžiama
ir nepasirinkti jokio vaiko.
</p>

<p>
get_label nurodoma, kokį vaiko lauką norime matyti, pasirinkdami vaiką
tėvo formoje.
</p>

<p>
get_pk nurodome, kad laukas pasiimtų vaiko id, kaip stringą. Tam
parašome lambda funkciją (lambda obj: str(obj)). Čia galima naudoti ir
paprastą funkciją.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> StringField, SubmitField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired
<span style="color: #fb4934;">from</span> wtforms_sqlalchemy.fields <span style="color: #fb4934;">import</span> QuerySelectField
<span style="color: #fb4934;">import</span> app

<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">vaikas_query</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> app.Vaikas.query

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">TevasForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Numeris'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikas</span> = QuerySelectField<span style="color: #fe8019;">(</span>query_factory=vaikas_query, allow_blank=<span style="color: #d3869b;">True</span>, get_label=<span style="color: #b8bb26;">"vardas"</span>, get_pk=<span style="color: #fb4934;">lambda</span> obj: <span style="color: #fe8019;">str</span><span style="color: #cc241d;">(</span>obj<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#302;vesti'</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">VaikasForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Numeris'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#302;vesti'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Formos html failas:</code>
</p>

<p>
Formos html failas praktiškai nesiskiria nuo įprasto neryšinio objekto
įvedimo formos. Vaiko laukas įvedamas, kaip bet kuris kitas laukas. Jo
logika pasiimama iš formos python failo ir vietoje įprasto įvedimo
lauko, jis tampa pasirinkimų lauku.
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span>&gt;
    {{ form.hidden_tag() }}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.vardas.label(class="form-control-label") }}
        {{ form.vardas(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.pavarde.label(class="form-control-label") }}
        {{ form.pavarde(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.vaikas.label(class="form-control-label") }}
        {{ form.vaikas(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    {{ form.submit }}
&lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
<code>Tėvų atvaizdavimo html kodas:</code>
</p>

<p>
Kadangi tėvas gali turėti vaiką (laukas vaikas), kas tiesiog yra
objektas, kiekvieną kartą tikriname, ar šis laukas užpildytas. Jei jis
ne tuščias, atvaizduojame tėvui priskirto vaiko vardą
(tevas.vaikas.vardas) ir pavardę (tevas.vaikas.pavarde).
</p>

<p>
Žemiau yra nuorodos į flask metodus, skirtus tėvo įrašo ištrynimui ir
redagavimui, taip pat – naujo tėvo įvedimui.
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

{% if visi_tevai %}
{% for tevas in visi_tevai %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.vardas}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.pavarde}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% if tevas.vaikas %}
&lt;<span style="color: #b8bb26;">p</span>&gt;Vaikas:&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.vaikas.vardas}} {{tevas.vaikas.pavarde}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endif %}
&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('delete', id=tevas['id']) }}"</span>&gt;I&#353;trinti&lt;/<span style="color: #b8bb26;">a</span>&gt;
&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('update', id=tevas['id']) }}"</span>&gt;Redaguoti&lt;/<span style="color: #b8bb26;">a</span>&gt;
{% endfor %}
{% endif %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('new_parent')}}"</span>&gt;Naujas t&#279;vas&lt;/<span style="color: #b8bb26;">a</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;

{% endblock %}
</pre>
</div>

<p>
<code>Flask funkcijos:</code>
</p>

<p>
<code>Tėvų atvaizdavimo:</code>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/tevai"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">parents</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">try</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_tevai</span> = Tevas.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">except</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_tevai</span> = <span style="color: #fe8019;">[]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"tevai.html"</span>, visi_tevai=visi_tevai<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Tėvų pridėjimo:</code>
</p>

<p>
Dekoratoriuje aprašome, kad funkcija naudos ir GET ir POST metodus
(duomenų priėjimui iš formos).
</p>

<p>
Funkcijos pradžioje inicijuojame duomenų bazę (db.create_all()). Tai
reikalinga norint sukurti duomenų bazę, kai jos nėra.
</p>

<p>
Inicijuojamas tėvo formos objektas (forma = forms.TevasForm(),
pradžioje rašoma forms, nes failo pradžioje yra importuota forms
klasė).
</p>

<p>
Patvirtinus formą (if forma.validate_on_submit()), inicijuojamas tėvo
objektas su duomenimis iš formos. Atkreipkite dėmesį, kad vaiko
objektas priskiriamas ne tiesiogiai, o per vaikas_id lauką).
</p>

<p>
Tėvo objektas pridedamas į sesiją (db.session.add(naujas_tevas)) ir
sesija išsaugoma (db.session.commit()).
</p>

<p>
Galiausiai nukreipiama į parents funkciją (return
redirect(url_for('parents'))), kuri atidaro tėvų puslapį.
</p>

<p>
Pagrindinis (apatinis) return nukreipia į tėvo pridėjimo puslapį,
pasiimdamas formos duomenis (render_template("prideti_teva.html",
form=forma)).
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/naujas_tevas"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">"GET"</span>, <span style="color: #b8bb26;">"POST"</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">new_parent</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">forma</span> = forms.TevasForm<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> forma.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">naujas_tevas</span> = Tevas<span style="color: #fe8019;">(</span>vardas=forma.vardas.data, pavarde=forma.pavarde.data, vaikas_id=forma.vaikas.data.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>naujas_tevas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'parents'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"prideti_teva.html"</span>, form=forma<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Pilnas kodas:
</p>

<p>
<a href="https://github.com/DonatasNoreika/flask-tevas-vaikas">flask-tevas-vaikas</a>
</p>
</div>
</div>

<div id="outline-container-org255ea38" class="outline-3">
<h3 id="org255ea38"><span class="section-number-3">5.4</span> One2Many ryšio įgyvendinimas su Flask</h3>
<div class="outline-text-3" id="text-5-4">
<p>
<code>Sqlalchemy dalis:</code>
</p>

<p>
Vienas tėvas gali turėti daug vaikų. Vaikas gali turėti vieną tėvą
(atvirkščiai, nei Many2one). Šiam ryšiui tėvo klasėje sukuriamas vaikų
vaiko objektas (relationship laukas). Iš vaiko pusės sukuriamas tėvo
id (foreign key) ir tėvo objektas (relationship laukas).
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Tevas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"tevas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavard&#279;"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikai</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vaikas"</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vaikas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"vaikas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavard&#279;"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">tevas_id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, db.ForeignKey<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">"tevas.id"</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">tevas</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Tevas"</span><span style="color: #fe8019;">)</span>p
</pre>
</div>

<p>
<code>Formos python failas:</code>
</p>

<p>
Tam, kad tėvo formoje galėtume turėti pasirenkamą vaikų lauką, turime
panaudoti QuerySelectMultipleField lauką (panašus, kaip Many2one
atveju naudojamas QuerySelectField). Atkreipkite dėmesį, kad jį reikia
importuoti iš wtforms_sqlalchemy.fields, o ne wtforms. Štai ką reiškia
šio lauko argumentai:
</p>

<p>
query_factory nurodome visų vaikų užklausą (app.Vaikas.query.all,
priekyje pridėtas app, nes importuotas visas app failas, kad
pasiektume vaiko ir tėvo objektus).
</p>

<p>
get_label nurodoma, kokį vaiko lauką norime matyti, pasirinkdami vaiką
tėvo formoje.
</p>

<p>
get_pk nurodome, kad laukas pasiimtų vaiko id, kaip stringą. Tam
parašome lambda funkciją (lambda obj: str(obj)). Čia galima naudoti ir
paprastą funkciją.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> StringField, IntegerField, SubmitField, SelectField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired, Email, InputRequired
<span style="color: #fb4934;">from</span> wtforms_sqlalchemy.fields <span style="color: #fb4934;">import</span> QuerySelectField, QuerySelectMultipleField
<span style="color: #fb4934;">import</span> app

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">TevasForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Numeris'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikai</span> = QuerySelectMultipleField<span style="color: #fe8019;">(</span>query_factory=app.Vaikas.query.<span style="color: #fe8019;">all</span>, get_label=<span style="color: #b8bb26;">"vardas"</span>, get_pk=<span style="color: #fb4934;">lambda</span> obj: <span style="color: #fe8019;">str</span><span style="color: #cc241d;">(</span>obj<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#302;vesti'</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">VaikasForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Numeris'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#302;vesti'</span><span style="color: #fe8019;">)</span>
</pre>
</div>


<p>
<code>Formos html failas:</code>
</p>

<p>
Formos html failas praktiškai nesiskiria nuo įprasto neryšinio objekto
įvedimo formos. Vaikų laukas įvedamas, kaip bet kuris kitas laukas. Jo
logika pasiimama iš formos python failo ir vietoje įprasto įvedimo
lauko, jis tampa kelių pasirinkimų lauku (kelis variantus formoje
galima pasirinkti laikant nuspaustą klaviatūros mygtuką CTRL).
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span>&gt;
    {{ form.hidden_tag() }}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.vardas.label(class="form-control-label") }}
        {{ form.vardas(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.pavarde.label(class="form-control-label") }}
        {{ form.pavarde(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.vaikai.label(class="form-control-label") }}
        {{ form.vaikai(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    {{ form.submit }}
&lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
Tėvų atvaizdavimo html kodas:
</p>

<p>
Kadangi tėvas gali daug vaikų (laukas vaikas), kas tiesiog yra
objektai, kiekvieną kartą tikriname, ar šis laukas užpildytas. Jei jis
ne tuščias, praiteruojame (prasukame for ciklą) per visus tėvo vaikus
(per tėvo lauką vaikai tevas.vaikai) ir atvaizduojame kiekvieno vaiko
vardą (vaikas.vardas) ir pavardę (vaikas.pavarde).
</p>

<p>
Žemiau yra nuorodos į flask metodus, skirtus tėvo įrašo ištrynimui ir
redagavimui, taip pat – naujo tėvo įvedimui.
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

{% if visi_tevai %}
{% for tevas in visi_tevai %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.vardas}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.pavarde}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% if tevas.vaikai %}
&lt;<span style="color: #b8bb26;">p</span>&gt;Vaikai:&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% for vaikas in tevas.vaikai %}
&lt;<span style="color: #b8bb26;">p</span>&gt;{{vaikas.vardas}} {{vaikas.pavarde}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endfor %}
{% endif %}

{% endfor %}
{% endif %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('new_parent')}}"</span>&gt;Naujas t&#279;vas&lt;/<span style="color: #b8bb26;">a</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;

{% endblock %}
</pre>
</div>

<p>
<code>Flask funkcijos:</code>
</p>

<p>
Pradžioje truputį pakeičiama DB nuorodos nurodymo kodą. Tai reikalinga
tam, kad nemestų thread klaidų:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span> + os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'data.sqlite?check_same_thread=False'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Tėvų atvaizdavimo:</code>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/tevai"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">parents</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">try</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_tevai</span> = Tevas.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">except</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_tevai</span> = <span style="color: #fe8019;">[]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"tevai.html"</span>, visi_tevai=visi_tevai<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Tėvų pridėjimo:</code>
</p>

<p>
Dekoratoriuje aprašome, kad funkcija naudos ir GET ir POST metodus
(duomenų priėjimui iš formos).
</p>

<p>
Funkcijos pradžioje inicijuojame duomenų bazę (db.create_all()). Tai
reikalinga norint sukurti duomenų bazę, kai jos nėra.
</p>

<p>
Inicijuojamas tėvo formos objektas (forma = forms.TevasForm(),
pradžioje rašoma forms, nes failo pradžioje yra importuota forms
klasė).
</p>

<p>
Patvirtinus formą (if forma.validate_on_submit()), inicijuojamas tėvo
objektas su duomenimis iš formos. Kol kas vaikai nepriskiriami
</p>

<p>
Iteruojama per tėvo vaikus iš formos (forma.vaikai.data), padaromos
kiekvieno vaiko užklausos iš duomenų bazės ir jie pridedami prie tėvo
vaikų objektų sąrašo (per metodą append). Taip išvengiama sesijų
susidubliavimo klaida.
</p>

<p>
Tėvo objektas pridedamas į sesiją (db.session.add(naujas_tevas)) ir
sesija išsaugoma (db.session.commit()).
</p>

<p>
Galiausiai nukreipiama į parents funkciją (return
redirect(url_for('parents'))), kuri atidaro tėvų puslapį.
</p>

<p>
Pagrindinis (apatinis) return nukreipia į tėvo pridėjimo puslapį,
pasiimdamas formos duomenis (render_template("prideti_teva.html",
form=forma)).
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/naujas_tevas"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">"GET"</span>, <span style="color: #b8bb26;">"POST"</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">new_parent</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">forma</span> = forms.TevasForm<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> forma.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">naujas_tevas</span> = Tevas<span style="color: #fe8019;">(</span>vardas=forma.vardas.data, pavarde=forma.pavarde.data<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">for</span> vaikas <span style="color: #fb4934;">in</span> forma.vaikai.data:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">priskirtas_vaikas</span> = Vaikas.query.get<span style="color: #fe8019;">(</span>vaikas.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   naujas_tevas.vaikai.append<span style="color: #fe8019;">(</span>priskirtas_vaikas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>naujas_tevas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'parents'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"prideti_teva.html"</span>, form=forma<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Pilnas kodas:
</p>

<p>
<a href="https://github.com/DonatasNoreika/tevas-vaikai-flask">tevas-vaikai-flask</a>
</p>
</div>
</div>

<div id="outline-container-orgf749f51" class="outline-3">
<h3 id="orgf749f51"><span class="section-number-3">5.5</span> Many2Many ryšio įgyvendinimas su Flask</h3>
<div class="outline-text-3" id="text-5-5">
<p>
<code>Sqlalchemy dalis:</code>
</p>

<p>
Vienas tėvas gali turėti daug vaikų. Vaikas gali turėti daug tėvų.
Šiam ryšiui tėvo ir vaiko klasėse atitinkamai sukuriami vaiko ir tėvo
objektai (relationship laukai). Taip pat būtina tarpinė ryšių lentelė
association_table, kurioje sukuriami tėvo ir vaiko id stulpeliai
(foreign key).
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">association_table</span> = db.Table<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'association'</span>, db.metadata,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.Column<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'tevas_id'</span>, db.Integer, db.ForeignKey<span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'tevas.id'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.Column<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'vaikas_id'</span>, db.Integer, db.ForeignKey<span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'vaikas.id'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span>
<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Tevas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'tevas'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavard&#279;"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikai</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vaikas"</span>, secondary=association_table,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span> back_populates=<span style="color: #b8bb26;">"tevai"</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vaikas</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'vaikas'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavard&#279;"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">tevai</span> = db.relationship<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Tevas"</span>, secondary=association_table,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>back_populates=<span style="color: #b8bb26;">"vaikai"</span><span style="color: #fe8019;">)</span>
</pre>
</div>


<p>
<code>Formos python failas:</code>
</p>

<p>
Viskas praktiškai taip pat, kaip ir One2many atveju. Tam, kad tėvo
formoje galėtume turėti pasirenkamą vaikų lauką, turime panaudoti
QuerySelectMultipleField lauką. Atkreipkite dėmesį, kad jį reikia
importuoti iš wtforms_sqlalchemy.fields, o ne wtforms. Štai ką reiškia
šio lauko argumentai:
</p>

<p>
query_factory nurodome visų vaikų užklausą (app.Vaikas.query.all,
priekyje pridėtas app, nes importuotas visas app failas, kad
pasiektume vaiko ir tėvo objektus).
</p>

<p>
get_label nurodoma, kokį vaiko lauką norime matyti, pasirinkdami vaiką
tėvo formoje.
</p>

<p>
get_pk nurodome, kad laukas pasiimtų vaiko id, kaip stringą. Tam
parašome lambda funkciją (lambda obj: str(obj)). Čia galima naudoti ir
paprastą funkciją.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> StringField, IntegerField, SubmitField, SelectField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired, Email, InputRequired
<span style="color: #fb4934;">from</span> wtforms_sqlalchemy.fields <span style="color: #fb4934;">import</span> QuerySelectField, QuerySelectMultipleField
<span style="color: #fb4934;">import</span> app

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">TevasForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Numeris'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vaikai</span> = QuerySelectMultipleField<span style="color: #fe8019;">(</span>query_factory=app.Vaikas.query.<span style="color: #fe8019;">all</span>, get_label=<span style="color: #b8bb26;">"vardas"</span>, get_pk=<span style="color: #fb4934;">lambda</span> obj: <span style="color: #fe8019;">str</span><span style="color: #cc241d;">(</span>obj<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#302;vesti'</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">VaikasForm</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Numeris'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavarde</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pavard&#279;'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#302;vesti'</span><span style="color: #fe8019;">)</span>
</pre>
</div>


<p>
<code>Formos html failas:</code>
</p>

<p>
Viskas praktiškai taip pat, kaip ir One2many atveju. Formos html
failas praktiškai nesiskiria nuo įprasto neryšinio objekto įvedimo
formos. Vaikų laukas įvedamas, kaip bet kuris kitas laukas. Jo logika
pasiimama iš formos python failo ir vietoje įprasto įvedimo lauko, jis
tampa kelių pasirinkimų lauku (kelis variantus formoje galima
pasirinkti laikant nuspaustą klaviatūros mygtuką CTRL).
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

&lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"post"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">"#"</span>&gt;
    {{ form.hidden_tag() }}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.vardas.label(class="form-control-label") }}
        {{ form.vardas(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.pavarde.label(class="form-control-label") }}
        {{ form.pavarde(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
        {{ form.vaikai.label(class="form-control-label") }}
        {{ form.vaikai(class="form-control") }}
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    {{ form.submit }}
&lt;/<span style="color: #b8bb26;">form</span>&gt;
{% endblock %}
</pre>
</div>

<p>
<code>Tėvų atvaizdavimo html kodas:</code>
</p>

<p>
Viskas praktiškai taip pat, kaip ir One2many atveju. Kadangi tėvas
gali daug vaikų (laukas vaikas), kas tiesiog yra objektai, kiekvieną
kartą tikriname, ar šis laukas užpildytas. Jei jis ne tuščias,
praiteruojame (prasukame for ciklą) per visus tėvo vaikus (per tėvo
lauką vaikai tevas.vaikai) ir atvaizduojame kiekvieno vaiko vardą
(vaikas.vardas) ir pavardę (vaikas.pavarde).
</p>

<p>
Žemiau yra nuorodos į flask metodus, skirtus tėvo įrašo ištrynimui ir
redagavimui, taip pat – naujo tėvo įvedimui.
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

{% if visi_tevai %}
{% for tevas in visi_tevai %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.vardas}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;{{tevas.pavarde}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% if tevas.vaikai %}
&lt;<span style="color: #b8bb26;">p</span>&gt;Vaikai:&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% for vaikas in tevas.vaikai %}
&lt;<span style="color: #b8bb26;">p</span>&gt;{{vaikas.vardas}} {{vaikas.pavarde}}&lt;/<span style="color: #b8bb26;">p</span>&gt;
{% endfor %}
{% endif %}

{% endfor %}
{% endif %}
&lt;<span style="color: #b8bb26;">hr</span>&gt;
&lt;<span style="color: #b8bb26;">p</span>&gt;&lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('new_parent')}}"</span>&gt;Naujas t&#279;vas&lt;/<span style="color: #b8bb26;">a</span>&gt;&lt;/<span style="color: #b8bb26;">p</span>&gt;

{% endblock %}
</pre>
</div>

<p>
Pradžioje truputį pakeičiama DB nuorodos nurodymo kodą. Tai reikalinga
tam, kad nemestų thread klaidų:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span> + os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'data.sqlite?check_same_thread=False'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Tėvų atvaizdavimo:</code>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/tevai"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">parents</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">try</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_tevai</span> = Tevas.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">except</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_tevai</span> = <span style="color: #fe8019;">[]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"tevai.html"</span>, visi_tevai=visi_tevai<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Tėvų pridėjimo:</code>
</p>

<p>
Dekoratoriuje aprašome, kad funkcija naudos ir GET ir POST metodus
(duomenų priėjimui iš formos).
</p>

<p>
Funkcijos pradžioje inicijuojame duomenų bazę (db.create_all()). Tai
reikalinga norint sukurti duomenų bazę, kai jos nėra.
</p>

<p>
Inicijuojamas tėvo formos objektas (forma = forms.TevasForm(),
pradžioje rašoma forms, nes failo pradžioje yra importuota forms
klasė).
</p>

<p>
Patvirtinus formą (if forma.validate_on_submit()), inicijuojamas tėvo
objektas su duomenimis iš formos. Kol kas vaikai nepriskiriami
</p>

<p>
Iteruojama per tėvo vaikus iš formos (forma.vaikai.data), padaromos
kiekvieno vaiko užklausos iš duomenų bazės ir jie pridedami prie tėvo
vaikų objektų sąrašo (per metodą append). Taip išvengiama sesijų
susidubliavimo klaida.
</p>

<p>
Tėvo objektas pridedamas į sesiją (db.session.add(naujas_tevas)) ir
sesija išsaugoma (db.session.commit()).
</p>

<p>
Galiausiai nukreipiama į parents funkciją (return
redirect(url_for('parents'))), kuri atidaro tėvų puslapį.
</p>

<p>
Pagrindinis (apatinis) return nukreipia į tėvo pridėjimo puslapį,
pasiimdamas formos duomenis (render_template("prideti_teva.html",
form=forma)).
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/naujas_tevas"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">"GET"</span>, <span style="color: #b8bb26;">"POST"</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">new_parent</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">forma</span> = forms.TevasForm<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> forma.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">naujas_tevas</span> = Tevas<span style="color: #fe8019;">(</span>vardas=forma.vardas.data, pavarde=forma.pavarde.data<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">for</span> vaikas <span style="color: #fb4934;">in</span> forma.vaikai.data:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">priskirtas_vaikas</span> = Vaikas.query.get<span style="color: #fe8019;">(</span>vaikas.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   naujas_tevas.vaikai.append<span style="color: #fe8019;">(</span>priskirtas_vaikas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>naujas_tevas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'parents'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"prideti_teva.html"</span>, form=forma<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
<code>Pilnas kodas:</code>
</p>

<p>
<a href="https://github.com/DonatasNoreika/tevai-vaikai-flask">tevai-vaikai-flask</a>
</p>
</div>

<div id="outline-container-org0aac03e" class="outline-4">
<h4 id="org0aac03e"><span class="section-number-4">5.5.1</span> Užduotis</h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
Sukurti Flask programą, kuri leistų išsaugoti studentus, dėstytojus ir
paskaitas
</p>

<p>
Kiekvienam dėstytojui leistų priskirti jo paskaitas (one2many ryšys)
</p>

<p>
Kiekvienam studentui leistų priskirti daug paskaitų (many2many ryšys)
</p>

<figure>
  <img src="./static/images/flask4_3.png" alt="flask4_3.png" width="800px">
</figure>

<p>
Atsakymas
</p>

<p>
<a href="https://github.com/DonatasNoreika/studentai_destytojai_paskaitos_flask">Paskaitų programa</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org96a6a13" class="outline-2">
<h2 id="org96a6a13"><span class="section-number-2">6</span> REST API kūrimas su Flask</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org25402e4" class="outline-3">
<h3 id="org25402e4"><span class="section-number-3">6.1</span> REST API su Flask</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-org9ea446e" class="outline-4">
<h4 id="org9ea446e"><span class="section-number-4">6.1.1</span> REST API kūrimo kodas</h4>
<div class="outline-text-4" id="text-6-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, jsonify, request
<span style="color: #fb4934;">from</span> calendar <span style="color: #fb4934;">import</span> isleap

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">index</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> <span style="color: #fe8019;">(</span>request.method == <span style="color: #b8bb26;">'POST'</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">some_json</span> = request.get_json<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> jsonify<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span><span style="color: #b8bb26;">'you sent'</span>: some_json<span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">else</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> jsonify<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span><span style="color: #b8bb26;">'about'</span>: <span style="color: #b8bb26;">'Hello World'</span><span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/keliamieji/&lt;int:metai&gt;"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">keliamieji</span><span style="color: #fe8019;">(</span>metai<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> isleap<span style="color: #fe8019;">(</span>metai<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> jsonify<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span><span style="color: #b8bb26;">'result'</span>: <span style="color: #b8bb26;">"Keliamieji"</span><span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">else</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> jsonify<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span><span style="color: #b8bb26;">'result'</span>: <span style="color: #b8bb26;">"NE Keliamieji"</span><span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca5f965" class="outline-4">
<h4 id="orgca5f965"><span class="section-number-4">6.1.2</span> REST API kūrimo kodas (antras būdas panaudojant flask_restful)</h4>
<div class="outline-text-4" id="text-6-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, request
<span style="color: #fb4934;">from</span> flask_restful <span style="color: #fb4934;">import</span> Resource, Api
<span style="color: #fb4934;">from</span> calendar <span style="color: #fb4934;">import</span> isleap

<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">api</span> = Api<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">HelloWorld</span><span style="color: #fe8019;">(</span>Resource<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">get</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span><span style="color: #fe8019;">{</span><span style="color: #b8bb26;">'about'</span> :<span style="color: #b8bb26;">'Hello world!'</span><span style="color: #fe8019;">}</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">post</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">some_json</span> = request.get_json<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fe8019;">{</span><span style="color: #b8bb26;">'you sent'</span>: some_json<span style="color: #fe8019;">}</span>, 201

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Keliamieji</span><span style="color: #fe8019;">(</span>Resource<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">get</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, metai<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> isleap<span style="color: #fe8019;">(</span>metai<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fe8019;">{</span><span style="color: #b8bb26;">'result'</span>: <span style="color: #b8bb26;">"Keliamieji"</span><span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">else</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #fe8019;">{</span><span style="color: #b8bb26;">'result'</span>: <span style="color: #b8bb26;">"NE Keliamieji"</span><span style="color: #fe8019;">}</span>

api.add_resource<span style="color: #fe8019;">(</span>HelloWorld, <span style="color: #b8bb26;">'/'</span><span style="color: #fe8019;">)</span>
api.add_resource<span style="color: #fe8019;">(</span>Keliamieji, <span style="color: #b8bb26;">'/keliamieji/&lt;int:metai&gt;'</span><span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5e8bce" class="outline-4">
<h4 id="orgc5e8bce"><span class="section-number-4">6.1.3</span> Sukurto REST API panaudojimo kodas</h4>
<div class="outline-text-4" id="text-6-1-3">
<p>
Šis kodas iliustruoja, kaip galėtume panaudoti API iš kitos Python
programos. Tačiau taip pat, galite prasitestuoti ir su Postman ar
alternatyviu įrankiu.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> requests
<span style="color: #fb4934;">import</span> json

<span style="color: #83a598;">payload</span> = <span style="color: #fe8019;">{</span><span style="color: #b8bb26;">'vardas'</span>: <span style="color: #b8bb26;">'Donatas'</span>, <span style="color: #b8bb26;">'pavarde'</span>: <span style="color: #b8bb26;">'Noreika'</span>, <span style="color: #b8bb26;">'amzius'</span>: 2000<span style="color: #fe8019;">}</span>
<span style="color: #83a598;">r</span> = requests.post<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:5000/'</span>, json=payload<span style="color: #fe8019;">)</span>
<span style="color: #83a598;">dictionary</span> = json.loads<span style="color: #fe8019;">(</span>r.text<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>dictionary<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">{'you sent': {'amzius': 2000, 'pavarde': 'Noreika', 'vardas': 'Donatas'}}</span>
<span style="color: #fb4934;">import</span> requests
<span style="color: #fb4934;">import</span> json

<span style="color: #83a598;">r2</span> = requests.get<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:5000/keliamieji/2100'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">dictionary2</span> = json.loads<span style="color: #fe8019;">(</span>r2.text<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>dictionary2<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'result'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">NE Keliamieji</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9a9a9a8" class="outline-3">
<h3 id="org9a9a9a8"><span class="section-number-3">6.2</span> REST API su duomenų baze kūrimas</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask <span style="color: #fb4934;">import</span> Flask, request, jsonify
<span style="color: #fb4934;">from</span> flask_sqlalchemy <span style="color: #fb4934;">import</span> SQLAlchemy
<span style="color: #fb4934;">from</span> flask_marshmallow <span style="color: #fb4934;">import</span> Marshmallow
<span style="color: #fb4934;">import</span> os

<span style="color: #83a598;">basedir</span> = os.path.abspath<span style="color: #fe8019;">(</span>os.path.dirname<span style="color: #cc241d;">(</span>__file__<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app</span> = Flask<span style="color: #fe8019;">(</span><span style="color: #fe8019;">__name__</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_DATABASE_URI'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'sqlite:///'</span> + os.path.join<span style="color: #fe8019;">(</span>basedir, <span style="color: #b8bb26;">'to_do.db'</span><span style="color: #fe8019;">)</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'SQLALCHEMY_TRACK_MODIFICATIONS'</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">False</span>
<span style="color: #83a598;">db</span> = SQLAlchemy<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>
<span style="color: #83a598;">ma</span> = Marshmallow<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">DB objektas</span>
<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Uzduotis</span><span style="color: #fe8019;">(</span>db.Model<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">'uzduotis'</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavadinimas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pavadinimas"</span>, db.String<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">atlikta</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Atlikta"</span>, db.Boolean<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">U&#382;duoties schema</span>
<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">UzduotisSchema</span><span style="color: #fe8019;">(</span>ma.Schema<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Meta</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">fields</span> = <span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'id'</span>, <span style="color: #b8bb26;">'pavadinimas'</span>, <span style="color: #b8bb26;">'atlikta'</span><span style="color: #fe8019;">)</span>

<span style="color: #83a598;">uzduotis_schema</span> = UzduotisSchema<span style="color: #fe8019;">()</span>
<span style="color: #83a598;">uzduotys_schema</span> = UzduotisSchema<span style="color: #fe8019;">(</span>many=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>


<span style="color: #928374;"># </span><span style="color: #928374;">Crud</span>
<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/uzduotis'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">prideti_uzduoti</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">pavadinimas</span> = request.json<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'pavadinimas'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">atlikta</span> = request.json<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'atlikta'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nauja_uzduotis</span> = Uzduotis<span style="color: #fe8019;">(</span>pavadinimas=pavadinimas, atlikta=atlikta<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>nauja_uzduotis<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> uzduotis_schema.jsonify<span style="color: #fe8019;">(</span>nauja_uzduotis<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">cRud</span>
<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/uzduotis'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">gauti_visas_uzduotis</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visos_uzduotys</span> = Uzduotis.query.<span style="color: #fe8019;">all</span><span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">rezultatas</span> = uzduotys_schema.dump<span style="color: #fe8019;">(</span>visos_uzduotys<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> jsonify<span style="color: #fe8019;">(</span>rezultatas<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">cRud</span>
<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/uzduotis/&lt;id&gt;'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">gauti_uzduoti</span><span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">uzduotis</span> = Uzduotis.query.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> uzduotis_schema.jsonify<span style="color: #fe8019;">(</span>uzduotis<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">crUd</span>
<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/uzduotis/&lt;id&gt;'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'PUT'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">pakeisti_uzduoti</span><span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">uzduotis</span> = Uzduotis.query.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">uzduotis.pavadinimas</span> = request.json<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'pavadinimas'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">uzduotis.atlikta</span> = request.json<span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'atlikta'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> uzduotis_schema.jsonify<span style="color: #fe8019;">(</span>uzduotis<span style="color: #fe8019;">)</span>

<span style="color: #928374;"># </span><span style="color: #928374;">cruD</span>
<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'/uzduotis/&lt;id&gt;'</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'DELETE'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">istrinti_uzduoti</span><span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">uzduotis</span> = Uzduotis.query.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.delete<span style="color: #fe8019;">(</span>uzduotis<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> uzduotis_schema.jsonify<span style="color: #fe8019;">(</span>uzduotis<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">if</span> <span style="color: #fe8019;">__name__</span> == <span style="color: #b8bb26;">'__main__'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   app.run<span style="color: #fe8019;">(</span>host=<span style="color: #b8bb26;">'127.0.0.1'</span>, port=8000, debug=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
</pre>
</div>
</div>


<div id="outline-container-org8a8b525" class="outline-4">
<h4 id="org8a8b525"><span class="section-number-4">6.2.1</span> Traukiame duomenis iš API su DB</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
Įrašome užduotį:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">nauja_uzduotis</span> = <span style="color: #fe8019;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">"pavadinimas"</span>: <span style="color: #b8bb26;">"I&#353;plauti indus"</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">"atlikta"</span>: <span style="color: #d3869b;">False</span>
<span style="color: #fe8019;">}</span>

<span style="color: #83a598;">r</span> = requests.post<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:8000/uzduotis'</span>, json=nauja_uzduotis<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>json.loads<span style="color: #cc241d;">(</span>r.text<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Nuskaitome visas užduotis:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">r</span> = requests.get<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:8000/uzduotis'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>json.loads<span style="color: #cc241d;">(</span>r.text<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Nuskaitome vieną užduotį:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">r</span> = requests.get<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:8000/uzduotis/2'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>json.loads<span style="color: #cc241d;">(</span>r.text<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Pakeičiame vieną užduotį:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">nauja_uzduotis</span> = <span style="color: #fe8019;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">"pavadinimas"</span>: <span style="color: #b8bb26;">"I&#353;plauti grindis"</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #b8bb26;">"atlikta"</span>: <span style="color: #d3869b;">False</span>
<span style="color: #fe8019;">}</span>

<span style="color: #83a598;">r</span> = requests.put<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:8000/uzduotis/2'</span>, json=nauja_uzduotis<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>json.loads<span style="color: #cc241d;">(</span>r.text<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Ištriname užduotį:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83a598;">r</span> = requests.delete<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'http://127.0.0.1:8000/uzduotis/1'</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">print</span><span style="color: #fe8019;">(</span>json.loads<span style="color: #cc241d;">(</span>r.text<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4da5942" class="outline-3">
<h3 id="org4da5942"><span class="section-number-3">6.3</span> Užduotis: Flask API</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Sukurti Flask API programą, kuri:
</p>

<p>
Per API (padavus JSON duomenis) leistų įvesti prekę į duomenų bazę
(jos formavimui panaudoti SQLAlchemy ORM).
</p>

<p>
Prekė turi turėti id, pavadinimą, kainą ir kiekį
</p>

<p>
Per API leistų peržiūrėti visas įvestas prekes
</p>

<p>
Per API leistų peržiūrėti vieną konkrečią prekę
</p>

<p>
Per API leistų pakoreguoti prekę
</p>

<p>
Per API leistų ištrinti prekę
</p>

<p>
Paleisti sukurta Flask API programą
</p>

<p>
Sukurti kitą Python programą (API klientą), kuris jungtųsi prie
anksčiau sukurti prekių API ir leistų per naršyklę pridėti prekes, jas
peržiūrėti, paredaguoti, ištrinti ir t.t. Pati kliento programa neturi
saugoti jokių duomenų (DB nereikalinga).
</p>
</div>

<div id="outline-container-org46bbdd3" class="outline-4">
<h4 id="org46bbdd3"><span class="section-number-4">6.3.1</span> atsakymas</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
<a href="https://github.com/CodeAcademy-Online/Python/tree/lesson-18">https://github.com/CodeAcademy-Online/Python/tree/lesson-18</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org4a0174b" class="outline-2">
<h2 id="org4a0174b"><span class="section-number-2">7</span> Vartotojų registravimas ir prisijungimas</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgfdde649" class="outline-3">
<h3 id="orgfdde649"><span class="section-number-3">7.1</span> Registracija</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-org0a85534" class="outline-4">
<h4 id="org0a85534"><span class="section-number-4">7.1.1</span> Kaip padaryti, kad svetainėje būtų atvaizduojamos info žinutės</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
Iš pradžių padarome, kad žinutės būtų atvaizduojamos pagrindiniame
html (base.html). Vietoje, kur atvaizduojamas puslapio turinys (page
content), prieš pat bloką "block content", įrašome šį kodą:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Page Content </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
    &lt;<span style="color: #b8bb26;">br</span>&gt;
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"alert alert-{{ category }}"</span>&gt;
                    {{ message }}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
            {% endfor %}
        {% endif %}
    {% endwith %}
    {% block content %}
    {% endblock %}
&lt;/<span style="color: #b8bb26;">div</span>&gt;
</pre>
</div>

<p>
Šiame kode gaunamos visos žinutės (messages) kartu su kategorijomis
(success, danger, error ir pan) ir atvaizduojamas jų tekstas, pagal
kategoriją atitinkamai pritaikant bootstrap stilių (atitinkamą
spalvą).
</p>

<p>
Tuomet galime aktyvuoti pranešimo žinutes kode, pavyzdžiui:
</p>

<div class="org-src-container">
<pre class="src src-py">flash('Sėkmingai prisiregistravote! Galite prisijungti', 'success')
</pre>
</div>

<p>
Tam kviečiama flash funkcija ir į argumentus paduodamas žinutės
tekstas (pirmas argumentas) ir kategorija.
</p>
</div>
</div>

<div id="outline-container-org23b63e2" class="outline-4">
<h4 id="org23b63e2"><span class="section-number-4">7.1.2</span> Kaip sukurti vartotojų registracijos formą</h4>
<div class="outline-text-4" id="text-7-1-2">
</div>
<ol class="org-ol">
<li><a id="org55ad38b"></a>Inicijuojame login_manager objektą<br />
<div class="outline-text-5" id="text-7-1-2-1">
<p>
Jis nuolatos saugos prisijungusį vartotoją ir leis juo operuoti:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_login <span style="color: #fb4934;">import</span> LoginManager, UserMixin, current_user, logout_user, login_user, login_required

<span style="color: #83a598;">login_manager</span> = LoginManager<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>
<span style="color: #83a598;">login_manager.login_view</span> = <span style="color: #b8bb26;">'registruotis'</span>
<span style="color: #83a598;">login_manager.login_message_category</span> = <span style="color: #b8bb26;">'info'</span>
</pre>
</div>

<p>
Viršuje iš flask_login modulio importuojame visus reikiamus objektus
ir funkcijas
</p>

<p>
Toliau: pirma eilutė inicijuoja patį objektą, antra - nurodo html
puslapį, kuris bus naudojamas vartotojo įvedimui, trečia - nurodo, kad
login_manageris gražintų info žinutes (kurias vėliau atvaizduosime
puslapyje):
</p>
</div>
</li>

<li><a id="orgdc50d37"></a>Sukuriame vartotojo sqlalchemy klasę:<br />
<div class="outline-text-5" id="text-7-1-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vartotojas</span><span style="color: #fe8019;">(</span>db.Model, UserMixin<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"vartotojas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"El. pa&#353;to adresas"</span>, db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Slapta&#382;odis"</span>, db.String<span style="color: #cc241d;">(</span>60<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Nuo įprastos ji skiriasi tuo, kad papildomai paveldi importuotą UserMixin klasę.
</p>
</div>
</li>

<li><a id="orgbbb0aea"></a>Sukuriame papildomą metodą:<br />
<div class="outline-text-5" id="text-7-1-2-3">
<p>
Kuriuo login_manageris pasiims iš duomenų bazės vartotojo objektą:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@login_manager.user_loader</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">load_user</span><span style="color: #fe8019;">(</span>vartotojo_id<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> Vartotojas.query.get<span style="color: #fe8019;">(</span><span style="color: #fe8019;">int</span><span style="color: #cc241d;">(</span>vartotojo_id<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org8256c0b"></a>Sukuriame formas:<br />
<div class="outline-text-5" id="text-7-1-2-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf <span style="color: #fb4934;">import</span> FlaskForm
<span style="color: #fb4934;">from</span> wtforms <span style="color: #fb4934;">import</span> SubmitField, BooleanField, StringField, PasswordField
<span style="color: #fb4934;">from</span> wtforms.validators <span style="color: #fb4934;">import</span> DataRequired, ValidationError, EqualTo
<span style="color: #fb4934;">import</span> app


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">RegistracijosForma</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Vardas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'El. pa&#353;tas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = PasswordField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Slapta&#382;odis'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">patvirtintas_slaptazodis</span> = PasswordField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Pakartokite slapta&#382;od&#303;"</span>, <span style="color: #cc241d;">[</span>EqualTo<span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'slaptazodis'</span>, <span style="color: #b8bb26;">"Slapta&#382;odis turi sutapti."</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Prisiregistruoti'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">tikrinti_varda</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, vardas<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vartotojas</span> = app.Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>vardas=vardas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> vartotojas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">raise</span> ValidationError<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#352;is vardas panaudotas. Pasirinkite kit&#261;.'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">tikrinti_pasta</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, el_pastas<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vartotojas</span> = app.Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>el_pastas=el_pastas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> vartotojas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">raise</span> ValidationError<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#352;is el. pa&#353;to adresas panaudotas. Pasirinkite kit&#261;.'</span><span style="color: #fe8019;">)</span>


<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">PrisijungimoForma</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'El. pa&#353;tas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = PasswordField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Slapta&#382;odis'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">prisiminti</span> = BooleanField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Prisiminti mane"</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Prisijungti'</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="org7ca3241"></a>Paaiškinimai:<br />
<div class="outline-text-5" id="text-7-1-2-5">
<ul class="org-ul">
<li>Slaptažodis saugomas specialiame PasswordField lauke, kad įvedant
jis būtų paslėpiamas.</li>
<li>patvirtintas_slaptazodis turi validatorių EqualTo, kuris validuoja
tik tada, kad šis laukas sutampa su slaptažodžio lauku.</li>
<li>Po registracijos yra du papildomi metodai, kurie yra meta klaidas,
jei įvedami vardai ir el. paštai jau yra duomenų bazėje.</li>
<li>Prisijungimo formoje yra Boolean tipo laukas prisiminti, kuris
vėliau perduos, ar prisijungtą vartotoją reikės prisiminti
kompiuteryje.</li>
</ul>
</div>
</li>

<li><a id="org944f75c"></a>Kuriame registracijos funkciją<br />
<div class="outline-text-5" id="text-7-1-2-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_bcrypt <span style="color: #fb4934;">import</span> Bcrypt

<span style="color: #83a598;">bcrypt</span> = Bcrypt<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>

<span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/registruotis"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">registruotis</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> current_user.is_authenticated:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'index'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = forms.RegistracijosForma<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">koduotas_slaptazodis</span> = bcrypt.generate_password_hash<span style="color: #fe8019;">(</span>form.slaptazodis.data<span style="color: #fe8019;">)</span>.decode<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'utf-8'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vartotojas</span> = Vartotojas<span style="color: #fe8019;">(</span>vardas=form.vardas.data, el_pastas=form.el_pastas.data, slaptazodis=koduotas_slaptazodis<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.add<span style="color: #fe8019;">(</span>vartotojas<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   flash<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'S&#279;kmingai prisiregistravote! Galite prisijungti'</span>, <span style="color: #b8bb26;">'success'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'index'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'registruotis.html'</span>, title=<span style="color: #b8bb26;">'Register'</span>, form=form<span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="orgd4a5670"></a>Paaiškinimai:<br />
<div class="outline-text-5" id="text-7-1-2-7">
<ul class="org-ul">
<li>Pradžioje importuojamas flask_bcrypt ir sukuriamas bcrypt objektas,
kurio dėka vartotojo slaptažodį išsaugosime duomenų bazėje koduotą.</li>
<li>if current_user.is_authenticated reiškia, kad jei vartotojas jau
prisijungęs, vartotojas metamas į kitą puslapį.</li>
<li>Eilutėje koduotas_slaptazodis sukuriamas užkoduotas slaptažodis,
kuris vėliau išsaugomas duomenų bazėje kartu su kitais vartotojo
duomenimis.</li>
<li>flash išmeta žinutę apie pavykusią registraciją</li>
</ul>
</div>
</li>

<li><a id="org05c9994"></a>Registracijos html<br />
<div class="outline-text-5" id="text-7-1-2-8">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"POST"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">""</span>&gt;
            {{ form.hidden_tag() }}
            &lt;<span style="color: #b8bb26;">fieldset</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                &lt;<span style="color: #b8bb26;">legend</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-bottom mb-4"</span>&gt;Prisiregistruokite&lt;/<span style="color: #b8bb26;">legend</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.vardas.label(class="form-control-label") }}

                    {% if form.vardas.errors %}
                        {{ form.vardas(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.vardas.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.vardas(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.el_pastas.label(class="form-control-label") }}
                    {% if form.el_pastas.errors %}
                        {{ form.el_pastas(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.el_pastas.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.el_pastas(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.slaptazodis.label(class="form-control-label") }}
                    {% if form.slaptazodis.errors %}
                        {{ form.slaptazodis(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.slaptazodis.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.slaptazodis(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.patvirtintas_slaptazodis.label(class="form-control-label") }}
                    {% if form.patvirtintas_slaptazodis.errors %}
                        {{ form.patvirtintas_slaptazodis(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.patvirtintas_slaptazodis.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.patvirtintas_slaptazodis(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
            &lt;/<span style="color: #b8bb26;">fieldset</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.submit(class="btn btn-outline-info") }}
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
        &lt;/<span style="color: #b8bb26;">form</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-top pt-3"</span>&gt;
        &lt;<span style="color: #b8bb26;">small</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"text-muted"</span>&gt;
<span style="color: #928374;">&lt;!--            </span><span style="color: #928374;">Already Have An Account? &lt;a class="ml-2" href="{{ url_for('index') }}"&gt;Sign In&lt;/a&gt;</span><span style="color: #928374;">--&gt;</span>
        &lt;/<span style="color: #b8bb26;">small</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
Panašu į tai, ką jau darėme anksčiau. Atvaizduojami visi formos laukai
ir jų pavadinimai. Taip pat validatorių išmestos žinutės.
</p>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgb6a2306" class="outline-3">
<h3 id="orgb6a2306"><span class="section-number-3">7.2</span> Prisijungimas</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org5d21398" class="outline-4">
<h4 id="org5d21398"><span class="section-number-4">7.2.1</span> Kuriame prisijungimo funkciją</h4>
<div class="outline-text-4" id="text-7-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/prisijungti"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">prisijungti</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> current_user.is_authenticated:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'index'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = forms.PrisijungimoForma<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">user</span> = Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>el_pastas=form.el_pastas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> user <span style="color: #fb4934;">and</span> bcrypt.check_password_hash<span style="color: #fe8019;">(</span>user.slaptazodis, form.slaptazodis.data<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   login_user<span style="color: #fe8019;">(</span>user, remember=form.prisiminti.data<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">next_page</span> = request.args.get<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'next'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>next_page<span style="color: #fe8019;">)</span> <span style="color: #fb4934;">if</span> next_page <span style="color: #fb4934;">else</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'index'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">else</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   flash<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Prisijungti nepavyko. Patikrinkite el. pa&#353;t&#261; ir slapta&#382;od&#303;'</span>, <span style="color: #b8bb26;">'danger'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'prisijungti.html'</span>, title=<span style="color: #b8bb26;">'Prisijungti'</span>, form=form<span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f9e809" class="outline-4">
<h4 id="org4f9e809"><span class="section-number-4">7.2.2</span> Paaiškinimai:</h4>
<div class="outline-text-4" id="text-7-2-2">
<ul class="org-ul">
<li>bcrypt.check_password_hash tikrinta, ar formoje įrašytas slaptažodis
atitinka duomenų bazėje įrašytą hash kodą.</li>
<li>Jei taip, kviečia login_user funkciją, kuri aktyvuoja prisijungusį
vartotoją (jis tampa current_user, kurį galima visada pasiekti).
Funkcijai taip pat paduodamas remember= argumentas iš formos (jei
formoje varnelė pažymėta, vartotojas liks prisijungęs ir uždarius
interneto naršyklę).</li>
<li>return redirect(next_page) if next_page else
redirect(url_for('index')) nukreipia į puslapį, į kurį einant
reikėjo prisijungimo arba į index.</li>
</ul>
</div>
</div>

<div id="outline-container-org372db9b" class="outline-4">
<h4 id="org372db9b"><span class="section-number-4">7.2.3</span> Prisijungimo html</h4>
<div class="outline-text-4" id="text-7-2-3">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"POST"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">""</span>&gt;
            {{ form.hidden_tag() }}
            &lt;<span style="color: #b8bb26;">fieldset</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                &lt;<span style="color: #b8bb26;">legend</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-bottom mb-4"</span>&gt;Prisijunkite&lt;/<span style="color: #b8bb26;">legend</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.el_pastas.label(class="form-control-label") }}
                    {% if form.el_pastas.errors %}
                        {{ form.el_pastas(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.el_pastas.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.el_pastas(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.slaptazodis.label(class="form-control-label") }}
                    {% if form.slaptazodis.errors %}
                        {{ form.slaptazodis(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.slaptazodis.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.slaptazodis(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-check"</span>&gt;
                    {{ form.prisiminti(class="form-check-input") }}
                    {{ form.prisiminti.label(class="form-check-label") }}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
            &lt;/<span style="color: #b8bb26;">fieldset</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.submit(class="btn btn-outline-info") }}
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
        &lt;/<span style="color: #b8bb26;">form</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-top pt-3"</span>&gt;
        &lt;<span style="color: #b8bb26;">small</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"text-muted"</span>&gt;
<span style="color: #928374;">&lt;!--            </span><span style="color: #928374;">Already Have An Account? &lt;a class="ml-2" href="{{ url_for('index') }}"&gt;Sign In&lt;/a&gt;</span><span style="color: #928374;">--&gt;</span>
        &lt;/<span style="color: #b8bb26;">small</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock content %}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2d6289" class="outline-4">
<h4 id="orgb2d6289"><span class="section-number-4">7.2.4</span> Atsijungimo funkcija</h4>
<div class="outline-text-4" id="text-7-2-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/atsijungti"</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">atsijungti</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   logout_user<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'index'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Viskas paprasta: logout_user() tiesiog atjungia prisijungusį vartotoją
(current_user nuo šio yra None)
</p>
</div>
</div>

<div id="outline-container-org5ff609e" class="outline-4">
<h4 id="org5ff609e"><span class="section-number-4">7.2.5</span> Sutvarkome pagrindinį meniu:</h4>
<div class="outline-text-4" id="text-7-2-5">
<div class="org-src-container">
<pre class="src src-html"><span style="color: #928374;">&lt;!-- </span><span style="color: #928374;">Navigation </span><span style="color: #928374;">--&gt;</span>
&lt;<span style="color: #b8bb26;">nav</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar navbar-expand-lg navbar-dark bg-primary static-top"</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"container"</span>&gt;
        &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-brand"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/"</span>&gt;Vartotojai&lt;/<span style="color: #b8bb26;">a</span>&gt;
        &lt;<span style="color: #b8bb26;">button</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler"</span> <span style="color: #83a598;">type</span>=<span style="color: #b8bb26;">"button"</span> <span style="color: #83a598;">data-toggle</span>=<span style="color: #b8bb26;">"collapse"</span> <span style="color: #83a598;">data-target</span>=<span style="color: #b8bb26;">"#navbarResponsive"</span>
                <span style="color: #83a598;">aria-controls</span>=<span style="color: #b8bb26;">"navbarResponsive"</span> <span style="color: #83a598;">aria-expanded</span>=<span style="color: #b8bb26;">"false"</span> <span style="color: #83a598;">aria-label</span>=<span style="color: #b8bb26;">"Toggle navigation"</span>&gt;
            &lt;<span style="color: #b8bb26;">span</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-toggler-icon"</span>&gt;&lt;/<span style="color: #b8bb26;">span</span>&gt;
        &lt;/<span style="color: #b8bb26;">button</span>&gt;
        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"collapse navbar-collapse"</span> <span style="color: #83a598;">id</span>=<span style="color: #b8bb26;">"navbarResponsive"</span>&gt;
            &lt;<span style="color: #b8bb26;">ul</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"navbar-nav ml-auto"</span>&gt;
                &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/"</span>&gt;Home&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">li</span>&gt;
                &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> &gt;|&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">li</span>&gt;
                {% if current_user.is_authenticated %}
                &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/irasai"</span>&gt;&#302;ra&#353;ai&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">li</span>&gt;
                &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/atsijungti"</span>&gt;Atsijungti&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">li</span>&gt;
                {% else %}
                &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/registruotis"</span>&gt;Registruotis&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">li</span>&gt;
                &lt;<span style="color: #b8bb26;">li</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-item"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"nav-link"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"/prisijungti"</span>&gt;Prisijungti&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">li</span>&gt;
                {% endif %}
            &lt;/<span style="color: #b8bb26;">ul</span>&gt;
        &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
&lt;/<span style="color: #b8bb26;">nav</span>&gt;
</pre>
</div>

<p>
Padarome, kad meniu Įrašai ir Atsijungti būtų matomi tik vartotojui
prisijungus, o Registruotis ir Prisijungti – tik atsijungus.
</p>
</div>
</div>
</div>
<div id="outline-container-orgd4636e7" class="outline-3">
<h3 id="orgd4636e7"><span class="section-number-3">7.3</span> Vartotojo turinys</h3>
<div class="outline-text-3" id="text-7-3">
</div>
<div id="outline-container-org4114267" class="outline-4">
<h4 id="org4114267"><span class="section-number-4">7.3.1</span> Sukuriame vartotojo įrašų atvaizdavimo funkciją</h4>
<div class="outline-text-4" id="text-7-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/irasai"</span><span style="color: #fe8019;">)</span>
<span style="color: #fabd2f;">@login_required</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">irasai</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'irasai.html'</span>, title=<span style="color: #b8bb26;">'&#302;ra&#353;ai'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Ji tiesiog nukelia į irasai.html puslapį. Atkreipkite dėmesį, kad ant
funkcijos uždėtas dekoratorius @login_required, todėl puslapis bus
atvaizduojamas tik prisijungus vartotojui.
</p>
</div>
</div>

<div id="outline-container-orgedf22bd" class="outline-4">
<h4 id="orgedf22bd"><span class="section-number-4">7.3.2</span> Įrašų puslapio html</h4>
<div class="outline-text-4" id="text-7-3-2">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}

&lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#268;ia yra vartotojo {{ current_user.vardas}} &#303;ra&#353;ai</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;

{% endblock %}
</pre>
</div>

<p>
Atvaizduojame puslapį, kuris gali būti rodomas tik vartotojui
prisijungus. Jame, per current_user, galime pasiekti būtent
prisijungusio vartotojo duomenis.
</p>

<p>
Demo programos kodas - <a href="https://github.com/DonatasNoreika/vartotojai_demo">https://github.com/DonatasNoreika/vartotojai_demo</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgea831d8" class="outline-3">
<h3 id="orgea831d8"><span class="section-number-3">7.4</span> Užduotis: Biudžeto programa su vartotojais</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Perdaryti nesudėtingą biudžeto programą taip, kad būtų joje būtų
atvaizduojami konkretaus vartotojo biudžeto įrašai ir jie būtų matomi
tik jam prisijungus.
</p>
</div>

<div id="outline-container-orgf7d6dcb" class="outline-4">
<h4 id="orgf7d6dcb"><span class="section-number-4">7.4.1</span> Atsakymas</h4>
<div class="outline-text-4" id="text-7-4-1">
<p>
Biudžetas demo su vartotojais - <a href="https://github.com/DonatasNoreika/biudzetas_demo_su_vartotojais">https://github.com/DonatasNoreika/biudzetas_demo_su_vartotojais</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org8cb324e" class="outline-2">
<h2 id="org8cb324e"><span class="section-number-2">8</span> Nuotraukos pridėjimas, admin puslapis, puslapiavimas</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org5657c91" class="outline-3">
<h3 id="org5657c91"><span class="section-number-3">8.1</span> Paskyros nuotraukos pridėjimas ir paskyros redagavimo puslapis</h3>
<div class="outline-text-3" id="text-8-1">
</div>
<div id="outline-container-org156448a" class="outline-4">
<h4 id="org156448a"><span class="section-number-4">8.1.1</span> Papildome sqlalchemy klasę:</h4>
<div class="outline-text-4" id="text-8-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vartotojas</span><span style="color: #fe8019;">(</span>db.Model, UserMixin<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"vartotojas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"El. pa&#353;to adresas"</span>, db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nuotrauka</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span>, default=<span style="color: #b8bb26;">'default.jpg'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Slapta&#382;odis"</span>, db.String<span style="color: #cc241d;">(</span>60<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org04acf16" class="outline-4">
<h4 id="org04acf16"><span class="section-number-4">8.1.2</span> Pridedame paskyros redagavimo formą:</h4>
<div class="outline-text-4" id="text-8-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_wtf.<span style="color: #fe8019;">file</span> <span style="color: #fb4934;">import</span> FileField, FileAllowed

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">PaskyrosAtnaujinimoForma</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Vardas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'El. pa&#353;tas'</span>, <span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nuotrauka</span> = FileField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Atnaujinti profilio nuotrauk&#261;'</span>, validators=<span style="color: #cc241d;">[</span>FileAllowed<span style="color: #b8bb26;">(</span><span style="color: #83a598;">[</span><span style="color: #b8bb26;">'jpg'</span>, <span style="color: #b8bb26;">'png'</span><span style="color: #83a598;">]</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Atnaujinti'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">tikrinti_varda</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, vardas<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> vardas.data != app.current_user.vardas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vartotojas</span> = app.Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>vardas=vardas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> vartotojas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">raise</span> ValidationError<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#352;is vardas panaudotas. Pasirinkite kit&#261;.'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">tikrinti_pasta</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, el_pastas<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> el_pastas.data != app.current_user.el_pastas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vartotojas</span> = app.Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>el_pastas=el_pastas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> vartotojas:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">raise</span> ValidationError<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'&#352;is el. pa&#353;to adresas panaudotas. Pasirinkite kit&#261;.'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Panašiai, kaip ir registracijos formoje, tik vardo ir el. pašto
tikrinimo metodai papildomai patikrina, ar įvestas vardas ar el.
paštas nesutampa su prisijungtu vartotoju ir tik tada atlieka
patikrinimus. Taip pat pridėtas FileField tipo nuotrauka laukas su
FileAllowed validatoriumi. Juos reikia suimportuoti iš flask_wtf.file.
</p>
</div>
</div>

<div id="outline-container-org65fe4f5" class="outline-4">
<h4 id="org65fe4f5"><span class="section-number-4">8.1.3</span> Pakeičiame paskyros atvaizdavimo puslapį:</h4>
<div class="outline-text-4" id="text-8-1-3">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
&lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
    &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"POST"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">""</span> <span style="color: #83a598;">enctype</span>=<span style="color: #b8bb26;">"multipart/form-data"</span>&gt;
        {{ form.hidden_tag() }}
        &lt;<span style="color: #b8bb26;">fieldset</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
            &lt;<span style="color: #b8bb26;">legend</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-bottom mb-4"</span>&gt;Paskyros informacija&lt;/<span style="color: #b8bb26;">legend</span>&gt;
            &lt;<span style="color: #b8bb26;">img</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"rounded-circle account-img"</span> <span style="color: #83a598;">src</span>=<span style="color: #b8bb26;">"{{ nuotrauka }}"</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.vardas.label(class="form-control-label") }}

                {% if form.vardas.errors %}
                {{ form.vardas(class="form-control form-control-lg is-invalid") }}
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                    {% for error in form.vardas.errors %}
                    &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                    {% endfor %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                {% else %}
                {{ form.vardas(class="form-control form-control-lg") }}
                {% endif %}
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.el_pastas.label(class="form-control-label") }}
                {% if form.el_pastas.errors %}
                {{ form.el_pastas(class="form-control form-control-lg is-invalid") }}
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                    {% for error in form.el_pastas.errors %}
                    &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                    {% endfor %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                {% else %}
                {{ form.el_pastas(class="form-control form-control-lg") }}
                {% endif %}
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.nuotrauka.label() }}
                {{ form.nuotrauka(class="form-control-file") }}
                {% if form.nuotrauka.errors %}
                    {% for error in form.nuotrauka.errors %}
                        &lt;<span style="color: #b8bb26;">span</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"text-danger"</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;&lt;/<span style="color: #b8bb26;">br</span>&gt;
                    {% endfor %}
                {% endif %}
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
        &lt;/<span style="color: #b8bb26;">fieldset</span>&gt;
        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
            {{ form.submit(class="btn btn-outline-info") }}
        &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;/<span style="color: #b8bb26;">form</span>&gt;
&lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
Panašus puslapis, kaip ir registracijos formoje, bet paliktas tik
vardo ir el. pašto redagavimas. Taip pat įdėtas nuotraukos redagavimas
ir atvaizdavimas (žr. img). Atkreipkite dėmesį, kad į formos žymą
įdėtas parametras enctype="multipart/form-data", kad galėtume pridėti
ir failą.
</p>
</div>
</div>

<div id="outline-container-orgc31f869" class="outline-4">
<h4 id="orgc31f869"><span class="section-number-4">8.1.4</span> Pakeičiame paskyros Flask funkciją:</h4>
<div class="outline-text-4" id="text-8-1-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/paskyra"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fabd2f;">@login_required</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">paskyra</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = forms.PaskyrosAtnaujinimoForma<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.nuotrauka.data:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nuotrauka</span> = save_picture<span style="color: #fe8019;">(</span>form.nuotrauka.data<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">current_user.nuotrauka</span> = nuotrauka
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">current_user.vardas</span> = form.vardas.data
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">current_user.el_pastas</span> = form.el_pastas.data
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   flash<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Tavo paskyra atnaujinta!'</span>, <span style="color: #b8bb26;">'success'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'paskyra'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">elif</span> request.method == <span style="color: #b8bb26;">'GET'</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form.vardas.data</span> = current_user.vardas
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form.el_pastas.data</span> = current_user.el_pastas
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nuotrauka</span> = url_for<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'static'</span>, filename=<span style="color: #b8bb26;">'profilio_nuotraukos/'</span> + current_user.nuotrauka<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'paskyra.html'</span>, title=<span style="color: #b8bb26;">'Account'</span>, form=form, nuotrauka=nuotrauka<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>Atkeipkite dėmesį, kad atnaujinant duomenis, vartotojas ne ieškomas
duomenų bazėje, o tiesiog pakeičiami prisijungto vartotojo
(current_user) duomenys ir padaromas db.session.commit(). To užtenka
norint atnaujinti vartotojo duomenis.</li>
<li>elif skiltyje formai prisikiriamas vartotojo vardas ir el. paštas,
kad redaguojamoje formoje šie laukai jau būtų užpildyti, beliktų
juos pakeisti redaguojant.</li>
<li>Jei formoje prisegama nuotrauka, ji pasiimama (jos pavadinimas),
priskiriama prisijungusiam vartotojui. Tuomet prieš return nuotrauka
pasiimama iš static katalogo ir paduodama atgal į formą.</li>
</ul>
</div>
</div>

<div id="outline-container-org4d6ec19" class="outline-4">
<h4 id="org4d6ec19"><span class="section-number-4">8.1.5</span> Pridėdame nuotraukos išsaugojimo funkciją:</h4>
<div class="outline-text-4" id="text-8-1-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">import</span> secrets
<span style="color: #fb4934;">from</span> PIL <span style="color: #fb4934;">import</span> Image

<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">save_picture</span><span style="color: #fe8019;">(</span>form_picture<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">random_hex</span> = secrets.token_hex<span style="color: #fe8019;">(</span>8<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">_</span>, <span style="color: #83a598;">f_ext</span> = os.path.splitext<span style="color: #fe8019;">(</span>form_picture.filename<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">picture_fn</span> = random_hex + f_ext
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">picture_path</span> = os.path.join<span style="color: #fe8019;">(</span>app.root_path, <span style="color: #b8bb26;">'static/profilio_nuotraukos'</span>, picture_fn<span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">output_size</span> = <span style="color: #fe8019;">(</span>125, 125<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">i</span> = Image.<span style="color: #fe8019;">open</span><span style="color: #fe8019;">(</span>form_picture<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   i.thumbnail<span style="color: #fe8019;">(</span>output_size<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   i.save<span style="color: #fe8019;">(</span>picture_path<span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> picture_fn
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>Ši funkcija pasiima nuotrauką (iš formos), išsaugo ją
'static/profilio_nuotraukos' kataloge ir gražina nuotraukos
pavadinimą, kuris vėliau išsaugomas vartotojo DB lentelėje.</li>
<li>random_hex sugeneruojamas atsitiktinis 8 simboliu stringas.</li>
<li>Kitoje eilutėje pasiimamas formoje išsaugoto failo plėtinys.</li>
<li>Vėliau prie sugeneruoto stringo prijungiamas plėtinys.</li>
<li>Nustatomas picture_path - pilnas kelias iki paveikslėlio</li>
<li>Kitose keturiose eilutėse nustatomas miniatiūros dydis, per Pillow
atidaroma nuotrauka, pamažinama nustatytu dydžiu ir išsaugoma prieš
tai sugeneruotu pavadinimu.</li>
<li>Funkcija gražina tą sugeneruotą pavadinimą.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org834716d" class="outline-3">
<h3 id="org834716d"><span class="section-number-3">8.2</span> Admin puslapis</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_admin <span style="color: #fb4934;">import</span> Admin
<span style="color: #fb4934;">from</span> flask_admin.contrib.sqla <span style="color: #fb4934;">import</span> ModelView

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">ManoModelView</span><span style="color: #fe8019;">(</span>ModelView<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">is_accessible</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span><span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> current_user.is_authenticated <span style="color: #fb4934;">and</span> current_user.el_pastas == <span style="color: #b8bb26;">"el@pastas.lt"</span>

<span style="color: #83a598;">admin</span> = Admin<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>
admin.add_view<span style="color: #fe8019;">(</span>ModelView<span style="color: #cc241d;">(</span>Irasas, db.session<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
admin.add_view<span style="color: #fe8019;">(</span>ManoModelView<span style="color: #cc241d;">(</span>Vartotojas, db.session<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>Importuojame Admin ir ModelView objektus iš flask_admin modulio</li>
<li>Inicijuojame Admin objektą ir priskiriame app.</li>
<li>Administratoriui priskiriame norimus administruoti sqlalchemy
objektus. Pirmu atveju daromas paprastas priskyrimas, antru –
priskirta paveldėtas ManoModelView objektas ir jame perrašomas
is_accesisible metodas taip, kad puslapis būtų rodomas tik tuo
atveju, kai vartotojas prisijungęs ir jo el. pašto adresas yra
el@pastas.lt (jį galima pakeisti).</li>
</ul>
</div>
</div>
<div id="outline-container-orgdafa3f2" class="outline-3">
<h3 id="orgdafa3f2"><span class="section-number-3">8.3</span> Įrašų puslapiavimas svetainėje</h3>
<div class="outline-text-3" id="text-8-3">
</div>
<div id="outline-container-org846212f" class="outline-4">
<h4 id="org846212f"><span class="section-number-4">8.3.1</span> Pakoreguojame įrašų atvaizdavimą:</h4>
<div class="outline-text-4" id="text-8-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/irasai"</span><span style="color: #fe8019;">)</span>
<span style="color: #fabd2f;">@login_required</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">records</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.create_all<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">page</span> = request.args.get<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'page'</span>, 1, <span style="color: #fe8019;">type</span>=<span style="color: #fe8019;">int</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">visi_irasai</span> = Irasas.query.filter_by<span style="color: #fe8019;">(</span>vartotojas_id=current_user.<span style="color: #fe8019;">id</span><span style="color: #fe8019;">)</span>.order_by<span style="color: #fe8019;">(</span>Irasas.data.desc<span style="color: #cc241d;">()</span><span style="color: #fe8019;">)</span>.paginate<span style="color: #fe8019;">(</span>page=page, per_page=5<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"irasai.html"</span>, visi_irasai=visi_irasai, datetime=datetime<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>'page' pasiima iš HTTP užklausos page objektą, pagal nutylėjimą
nustato 1 puslapį (jei nebūtų page objekto, rodys pirmo puslapio
rezultatus) ir nurodo integer tipą (type=int)</li>
<li>visi įrašai užklausoje kviečiame .paginate() funkciją ir jai
paduodame prieš tai gautą page objektą bei kiek įrašų norėsime
matyti viename puslapyje.</li>
<li>Įrašai taip pat rūšiuojami pagal datą atbulai, kad naujausi būtų
matomi pirmajame puslapyje.</li>
<li>Taip pat filtruojami, kad būtų rodomi tik priklausantys
prisijungusiam vartotojui.</li>
</ul>
</div>
</div>

<div id="outline-container-org672ceda" class="outline-4">
<h4 id="org672ceda"><span class="section-number-4">8.3.2</span> Pakeičiame susijusį html puslapį:</h4>
<div class="outline-text-4" id="text-8-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fe8019;">{</span>% extends <span style="color: #b8bb26;">"base.html"</span> %<span style="color: #fe8019;">}</span>

<span style="color: #fe8019;">{</span>% block content %<span style="color: #fe8019;">}</span>

<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">if</span> visi_irasai %<span style="color: #fe8019;">}</span>
<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">for</span> irasas <span style="color: #fb4934;">in</span> visi_irasai.items %<span style="color: #fe8019;">}</span>
&lt;hr&gt;
<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">if</span> irasas.pajamos %<span style="color: #fe8019;">}</span>
&lt;p&gt;Pajamos: <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span>irasas.suma<span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/p&gt;
&lt;p&gt;Data: <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> datetime.strftime<span style="color: #b8bb26;">(</span>irasas.data, <span style="color: #b8bb26;">"%Y-%m-%d %H:%M:%S"</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/p&gt;
<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">else</span> %<span style="color: #fe8019;">}</span>
&lt;p&gt;I&#353;laidos: <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span>irasas.suma<span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/p&gt;
&lt;p&gt;Data: <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span>irasas.data<span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/p&gt;
<span style="color: #fe8019;">{</span>% endif %<span style="color: #fe8019;">}</span>
&lt;a <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('delete', id=irasas['id']) }}"</span>&gt;I&#353;trinti&lt;/a&gt;
&lt;a <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('update', id=irasas['id']) }}"</span>&gt;Redaguoti&lt;/a&gt;
<span style="color: #fe8019;">{</span>% endfor %<span style="color: #fe8019;">}</span>
&lt;hr&gt;
<span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">for</span> page_num <span style="color: #fb4934;">in</span> visi_irasai.iter_pages<span style="color: #cc241d;">(</span>left_edge=1, right_edge=1, left_current=1, right_current=2<span style="color: #cc241d;">)</span> %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">if</span> page_num %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">if</span> visi_irasai.page == page_num %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span> &lt;a <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"btn btn-info mb-4"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('records', page=page_num) }}"</span>&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> page_num <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/a&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">else</span> %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span> &lt;a <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"btn btn-outline-info mb-4"</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('records', page=page_num) }}"</span>&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> page_num <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/a&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% endif %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">else</span> %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   ...
<span style="color: #cd5c5c; background-color: #3c3836;"> </span> <span style="color: #fe8019;">{</span>% endif %<span style="color: #fe8019;">}</span>
<span style="color: #fe8019;">{</span>% endfor %<span style="color: #fe8019;">}</span>
<span style="color: #fe8019;">{</span>% endif %<span style="color: #fe8019;">}</span>

&lt;p&gt;&lt;a <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('new_record')}}"</span>&gt;Naujas &#303;ra&#353;as&lt;/a&gt;&lt;/p&gt;

<span style="color: #fe8019;">{</span>% endblock %<span style="color: #fe8019;">}</span>
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>Pirmame for cikle pakeičiame visi_irasai į visi_irasai.items. Taip
išvengsime iteravimo klaidos.</li>
<li>Po visų įrašų for ciklo, įdedame papildomą for ciklą per įrašus.
Iškviečiame funkciją .iter_pages() ir jai nurodome, kiek puslapių
mygtukų norėsime kairėje, dešinėje, prieš ir už aktyvaus puslapio.</li>
<li>Pirmas {% if page_num %} prafiltruoja tik aktyvius puslapius, nes
sąraše visi_irasai.iter_pages() lieka ir None objektų.</li>
<li>Antras {% if visi_irasai.page == page_num %} išfiltruoja aktyvaus
puslapio rodinį: jam pritaikytas kitoks stilius (spalva), nei
neaktyviems puslapiams, kurių rodinys atvaizduojamas {% else %}
skiltyje.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org1eb48de" class="outline-3">
<h3 id="org1eb48de"><span class="section-number-3">8.4</span> Užduotis: Biudžeto programa su nuotraukomis, admin ir puslapiavimu</h3>
<div class="outline-text-3" id="text-8-4">
<p>
Į biudžeto programą įdėti šioje paskaitoje aptartas funkcijas:
paskyros redagavimą su nuotraukos pridėjimu, admin puslapį, biudžeto
įrašų puslapiavimą.
</p>

<p>
Tuos pačius dalykus galima pritaikyti ir kitai kurtai Flask programai
(pvz. prekių užsakymo, egzaminavimo).
</p>
</div>

<div id="outline-container-orge776830" class="outline-4">
<h4 id="orge776830"><span class="section-number-4">8.4.1</span> Atsakymas</h4>
<div class="outline-text-4" id="text-8-4-1">
<p>
Biudžeto programa su nuotraukomis, admin ir puslapiavimu -
<a href="https://github.com/DonatasNoreika/vartotojai_demo_su_admin">https://github.com/DonatasNoreika/vartotojai_demo_su_admin</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org70bf933" class="outline-2">
<h2 id="org70bf933"><span class="section-number-2">9</span> Slaptažodžio keitimas ir klaidų puslapiai</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org78a89c3" class="outline-3">
<h3 id="org78a89c3"><span class="section-number-3">9.1</span> Slaptažodžio keitimas</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Tam, kad vartotojas galėtų pasikeisti pamirštą slaptažodį, sukursime
jam laikinai veikiančią nuorodą ir išsiųsime el. paštu. Paspaudęs
nuorodą, jis pateks į puslapį, kur pagal savo žetoną (token), galės
atnaujinti slaptažodį.
</p>
</div>

<div id="outline-container-org9193dac" class="outline-4">
<h4 id="org9193dac"><span class="section-number-4">9.1.1</span> Į prisijungimo html failą įdedame nuorodą į slaptažodžio pakeitimo funkciją:</h4>
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"POST"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">""</span>&gt;
            {{ form.hidden_tag() }}
            &lt;<span style="color: #b8bb26;">fieldset</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                &lt;<span style="color: #b8bb26;">legend</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-bottom mb-4"</span>&gt;Prisijunkite&lt;/<span style="color: #b8bb26;">legend</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.el_pastas.label(class="form-control-label") }}
                    {% if form.el_pastas.errors %}
                        {{ form.el_pastas(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.el_pastas.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.el_pastas(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.slaptazodis.label(class="form-control-label") }}
                    {% if form.slaptazodis.errors %}
                        {{ form.slaptazodis(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.slaptazodis.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.slaptazodis(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-check"</span>&gt;
                    {{ form.prisiminti(class="form-check-input") }}
                    {{ form.prisiminti.label(class="form-check-label") }}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
            &lt;/<span style="color: #b8bb26;">fieldset</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.submit(class="btn btn-outline-info") }}
                &lt;<span style="color: #b8bb26;">small</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"text-muted ml-2"</span>&gt;
                    &lt;<span style="color: #b8bb26;">a</span> <span style="color: #83a598;">href</span>=<span style="color: #b8bb26;">"{{ url_for('reset_request') }}"</span>&gt;Pamir&#353;ote slapta&#382;od&#303;?&lt;/<span style="color: #b8bb26;">a</span>&gt;
                &lt;/<span style="color: #b8bb26;">small</span>&gt;
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
        &lt;/<span style="color: #b8bb26;">form</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-top pt-3"</span>&gt;
        &lt;<span style="color: #b8bb26;">small</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"text-muted"</span>&gt;
<span style="color: #928374;">&lt;!--            </span><span style="color: #928374;">Already Have An Account? &lt;a class="ml-2" href="{{ url_for('index') }}"&gt;Sign In&lt;/a&gt;</span><span style="color: #928374;">--&gt;</span>
        &lt;/<span style="color: #b8bb26;">small</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
Nuoroda su tekstu “Pamiršote slaptažodį?” nukreipia į Flask funkciją
`reset_request`.
</p>
</div>
</div>

<div id="outline-container-orgf816f1c" class="outline-4">
<h4 id="orgf816f1c"><span class="section-number-4">9.1.2</span> Pridedame slaptažodžio atnaujinimo Flask funkciją:</h4>
<div class="outline-text-4" id="text-9-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/reset_password"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">reset_request</span><span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> current_user.is_authenticated:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'home'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = forms.UzklausosAtnaujinimoForma<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">user</span> = Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>el_pastas=form.el_pastas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   send_reset_email<span style="color: #fe8019;">(</span>user<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   flash<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Jums i&#353;si&#371;stas el. lai&#353;kas su slapta&#382;od&#382;io atnaujinimo instrukcijomis.'</span>, <span style="color: #b8bb26;">'info'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'prisijungti'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'reset_request.html'</span>, title=<span style="color: #b8bb26;">'Reset Password'</span>, form=form<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>Funkcija atidaro reset_request.html failą, iš kurio pasiima įvestą
vartotojo el. pašto adresą.</li>
<li>Tam sukuriama papildoma flask-wtf forma.</li>
<li>Patvirtinus formą, kviečiama sent_reset_email funkcija su paduotu
vartotoju ir jam išsiunčiamas el. laiškas.</li>
<li>Parodoma flash žinutė ir gražinama į prisijungimo langą.</li>
</ul>
</div>
</div>

<div id="outline-container-org6d1fa0e" class="outline-4">
<h4 id="org6d1fa0e"><span class="section-number-4">9.1.3</span> Slaptažodžio atnaujinimo nuorodos html</h4>
<div class="outline-text-4" id="text-9-1-3">
<p>
(kur vartotojas įveda savo el. pašto adresą): reset_request.html
failas:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fe8019;">{</span>% extends <span style="color: #b8bb26;">"base.html"</span> %<span style="color: #fe8019;">}</span>
<span style="color: #fe8019;">{</span>% block content %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;div <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;form <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"POST"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">""</span>&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> form.hidden_tag<span style="color: #b8bb26;">()</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;fieldset <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;legend <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"border-bottom mb-4"</span>&gt;Slapta&#382;od&#382;io pakeitimas&lt;/legend&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;div <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> form.el_pastas.label<span style="color: #b8bb26;">(</span><span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"form-control-label"</span><span style="color: #b8bb26;">)</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">if</span> form.el_pastas.errors %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> form.el_pastas<span style="color: #b8bb26;">(</span><span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"form-control form-control-lg is-invalid"</span><span style="color: #b8bb26;">)</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;div <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">for</span> error <span style="color: #fb4934;">in</span> form.el_pastas.errors %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;span&gt;<span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> error <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>&lt;/span&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% endfor %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;/div&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% <span style="color: #fb4934;">else</span> %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> form.el_pastas<span style="color: #b8bb26;">(</span><span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"form-control form-control-lg"</span><span style="color: #b8bb26;">)</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span>% endif %<span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;/div&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;/fieldset&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;div <span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">{</span><span style="color: #cc241d;">{</span> form.submit<span style="color: #b8bb26;">(</span><span style="color: #fb4934;">class</span>=<span style="color: #b8bb26;">"btn btn-outline-info"</span><span style="color: #b8bb26;">)</span> <span style="color: #cc241d;">}</span><span style="color: #fe8019;">}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;/div&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;/form&gt;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   &lt;/div&gt;
<span style="color: #fe8019;">{</span>% endblock content %<span style="color: #fe8019;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1db96b6" class="outline-4">
<h4 id="org1db96b6"><span class="section-number-4">9.1.4</span> Slaptažodžio atnaujinimo nuorodos forma</h4>
<div class="outline-text-4" id="text-9-1-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">UzklausosAtnaujinimoForma</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = StringField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'El. pa&#353;tas'</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span>, Email<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Gauti'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">validate_email</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, el_pastas<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">user</span> = app.Vartotojas.query.filter_by<span style="color: #fe8019;">(</span>el_pastas=el_pastas.data<span style="color: #fe8019;">)</span>.first<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> user <span style="color: #fb4934;">is</span> <span style="color: #d3869b;">None</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">raise</span> ValidationError<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'N&#279;ra paskyros, registruotos &#353;iuo el. pa&#353;to adresu. Registruokit&#279;s.'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Šiame etape pasiimamas tik vartotojo el. pašto adresas. Bet
patikrinama, ar yra vartotojas su tokiu el. pašto adresu.
</p>
</div>
</div>

<div id="outline-container-orgb768d10" class="outline-4">
<h4 id="orgb768d10"><span class="section-number-4">9.1.5</span> Pridedame el. laiško siuntimo funkciją:</h4>
<div class="outline-text-4" id="text-9-1-5">
<p>
(Jame siunčiama slaptažodžio atnaujinimo nuoroda)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> flask_mail <span style="color: #fb4934;">import</span> Message, Mail

<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'MAIL_SERVER'</span><span style="color: #fe8019;">]</span> = <span style="color: #b8bb26;">'smtp.gmail.com'</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'MAIL_PORT'</span><span style="color: #fe8019;">]</span> = 587
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'MAIL_USE_TLS'</span><span style="color: #fe8019;">]</span> = <span style="color: #d3869b;">True</span>
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'MAIL_USERNAME'</span><span style="color: #fe8019;">]</span> = MAIL_USERNAME
<span style="color: #83a598;">app.config</span><span style="color: #fe8019;">[</span><span style="color: #b8bb26;">'MAIL_PASSWORD'</span><span style="color: #fe8019;">]</span> = MAIL_PASSWORD

<span style="color: #83a598;">mail</span> = Mail<span style="color: #fe8019;">(</span>app<span style="color: #fe8019;">)</span>

<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">send_reset_email</span><span style="color: #fe8019;">(</span>user<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">token</span> = user.get_reset_token<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">msg</span> = Message<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Slapta&#382;od&#382;io atnaujinimo u&#382;klausa'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span> sender=<span style="color: #b8bb26;">'el@pastas.lt'</span>,
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span> recipients=<span style="color: #cc241d;">[</span>user.el_pastas<span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">msg.body</span> = f<span style="color: #b8bb26;">'''Nor&#279;dami atnaujinti slapta&#382;od&#303;, paspauskite nuorod&#261;:</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span><span style="color: #b8bb26;">   {url_for('reset_token', token=token, _external=True)}</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span><span style="color: #b8bb26;">   Jei j&#363;s nedar&#279;te &#353;ios u&#382;klausos, nieko nedarykite ir slapta&#382;odis nebus pakeistas.</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span><span style="color: #b8bb26;">   '''</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   mail.send<span style="color: #fe8019;">(</span>msg<span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Paaiškinimai:
</p>

<ul class="org-ul">
<li>Iš flask_mail importuojami reikiami dalykai</li>
<li>Inicijuojamas mail objektas</li>
<li>Per app sukonfiguruojamas el. pašto serveris (el. pašto dėžutė, per
kurią bus siunčiami laiškai). Jei tai gmail dėžutė, nepamirškite
įjungti leidimo mažiau saugioms programoms (žr. paskaitą apie el.
laiškų siuntimą per python). Taip pat gali būti, kad pašto serveris
laiškus iš jūsų programos blokuos.</li>
<li>Per vartotojo metodą get_reset_token() sugeneruojamas unikalus
atnaujinimo žetonas, kuris bus naudojamas slaptažodžio atnaujinimo
nuorodai suformuoti.</li>
<li>Sugeneruojamas el. laiškas su nuorodą į kitą Flask funkciją
reset_token() bei gautu žetonu.</li>
<li>aiškas išsiunčiamas per mail objektą.</li>
<li>SVARBU: mail = Mail(app) objektą inicijuokite po konfiguracijos
nustatymo, o ne prieš (nes kitaip siuntimas neveiks).</li>
</ul>
</div>
</div>

<div id="outline-container-orgd985a2b" class="outline-4">
<h4 id="orgd985a2b"><span class="section-number-4">9.1.6</span> Žetono (token) sugeneravimo metodas:</h4>
<div class="outline-text-4" id="text-9-1-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">from</span> itsdangerous <span style="color: #fb4934;">import</span> TimedJSONWebSignatureSerializer <span style="color: #fb4934;">as</span> Serializer

<span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vartotojas</span><span style="color: #fe8019;">(</span>db.Model, UserMixin<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"vartotojas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"El. pa&#353;to adresas"</span>, db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nuotrauka</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span>, default=<span style="color: #b8bb26;">'default.jpg'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Slapta&#382;odis"</span>, db.String<span style="color: #cc241d;">(</span>60<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">get_reset_token</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, expires_sec=1800<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">s</span> = Serializer<span style="color: #fe8019;">(</span>app.config<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'SECRET_KEY'</span><span style="color: #cc241d;">]</span>, expires_sec<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> s.dumps<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span><span style="color: #b8bb26;">'user_id'</span>: <span style="color: #fb4934;">self</span>.<span style="color: #fe8019;">id</span><span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>.decode<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'utf-8'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Iš itsdangerous importuojame serializatorių</li>
<li>Jam paduodame mūsų programos SECRET_KEY ir laiką, kurį žetonas bus
aktyvus</li>
<li>Gražiname sugeneruotą kodą (žetoną), kuris bus įdedamas į laikiną
nuorodą pašte</li>
</ul>
</div>
</div>

<div id="outline-container-org0656167" class="outline-4">
<h4 id="org0656167"><span class="section-number-4">9.1.7</span> Kai vartotojas paspaudžia nuorodą laiške</h4>
<div class="outline-text-4" id="text-9-1-7">
</div>
<ol class="org-ol">
<li><a id="orga0f4c96"></a>Slaptažodžio nunulinimo Flask metodas:<br />
<div class="outline-text-5" id="text-9-1-7-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.route</span><span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"/reset_password/&lt;token&gt;"</span>, methods=<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'GET'</span>, <span style="color: #b8bb26;">'POST'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">reset_token</span><span style="color: #fe8019;">(</span>token<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> current_user.is_authenticated:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'home'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">user</span> = Vartotojas.verify_reset_token<span style="color: #fe8019;">(</span>token<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> user <span style="color: #fb4934;">is</span> <span style="color: #d3869b;">None</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   flash<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'U&#382;klausa netinkama arba pasibaigusio galiojimo'</span>, <span style="color: #b8bb26;">'warning'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'reset_request'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">form</span> = forms.SlaptazodzioAtnaujinimoForma<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">if</span> form.validate_on_submit<span style="color: #fe8019;">()</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">hashed_password</span> = bcrypt.generate_password_hash<span style="color: #fe8019;">(</span>form.slaptazodis.data<span style="color: #fe8019;">)</span>.decode<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'utf-8'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">user.slaptazodis</span> = hashed_password
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   db.session.commit<span style="color: #fe8019;">()</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   flash<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Tavo slapta&#382;odis buvo atnaujintas! Gali prisijungti'</span>, <span style="color: #b8bb26;">'success'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> redirect<span style="color: #fe8019;">(</span>url_for<span style="color: #cc241d;">(</span><span style="color: #b8bb26;">'prisijungti'</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'reset_token.html'</span>, title=<span style="color: #b8bb26;">'Reset Password'</span>, form=form<span style="color: #fe8019;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Iš vartotojo klasės kviečiamas metodas verify_reset_token(token),
kuris patikrina, ar vartotojo nuorodos žetonas dar aktyvus ir
gražina susijusio vartotojo objektą.</li>
<li>Jei ši funkcija objekto negražina, rodoma klaida, kad nuoroda
pasibaigus arba negalioja ir vėl nukreipiama į slaptažodžio
atnaujinimo puslapį.</li>
<li>Inicijuojama slaptažodžio atnaujinimo forma ir vartotojas
nukreipiamas į reset_token.html puslapį, iš kurio pasiimamas naujas
slaptažodis.</li>
<li>Jei naujas slaptažodis patvirtinamas, jis vėl encryptinamas ir
pakeičiamas to vartotojo slaptažodis duomenų bazėje.</li>
</ul>
</div>
</li>

<li><a id="orgfc6e35a"></a>Žetono patvirtinimo metodas Vartotojo klasėje:<br />
<div class="outline-text-5" id="text-9-1-7-2">
<p>
verify_reset_token(token):
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">Vartotojas</span><span style="color: #fe8019;">(</span>db.Model, UserMixin<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">__tablename__</span> = <span style="color: #b8bb26;">"vartotojas"</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">id</span> = db.Column<span style="color: #fe8019;">(</span>db.Integer, primary_key=<span style="color: #d3869b;">True</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">vardas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Vardas"</span>, db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">el_pastas</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"El. pa&#353;to adresas"</span>, db.String<span style="color: #cc241d;">(</span>120<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">nuotrauka</span> = db.Column<span style="color: #fe8019;">(</span>db.String<span style="color: #cc241d;">(</span>20<span style="color: #cc241d;">)</span>, nullable=<span style="color: #d3869b;">False</span>, default=<span style="color: #b8bb26;">'default.jpg'</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = db.Column<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"Slapta&#382;odis"</span>, db.String<span style="color: #cc241d;">(</span>60<span style="color: #cc241d;">)</span>, unique=<span style="color: #d3869b;">True</span>, nullable=<span style="color: #d3869b;">False</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">get_reset_token</span><span style="color: #fe8019;">(</span><span style="color: #fb4934;">self</span>, expires_sec=1800<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">s</span> = Serializer<span style="color: #fe8019;">(</span>app.config<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'SECRET_KEY'</span><span style="color: #cc241d;">]</span>, expires_sec<span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> s.dumps<span style="color: #fe8019;">(</span><span style="color: #cc241d;">{</span><span style="color: #b8bb26;">'user_id'</span>: <span style="color: #fb4934;">self</span>.<span style="color: #fe8019;">id</span><span style="color: #cc241d;">}</span><span style="color: #fe8019;">)</span>.decode<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'utf-8'</span><span style="color: #fe8019;">)</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   @<span style="color: #fe8019;">staticmethod</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">verify_reset_token</span><span style="color: #fe8019;">(</span>token<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">s</span> = Serializer<span style="color: #fe8019;">(</span>app.config<span style="color: #cc241d;">[</span><span style="color: #b8bb26;">'SECRET_KEY'</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">try</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">user_id</span> = s.loads<span style="color: #fe8019;">(</span>token<span style="color: #fe8019;">)[</span><span style="color: #b8bb26;">'user_id'</span><span style="color: #fe8019;">]</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">except</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">None</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> Vartotojas.query.get<span style="color: #fe8019;">(</span>user_id<span style="color: #fe8019;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Statinis metodas verify_reset_token(token) inicijuoja
serializatorių.</li>
<li>Iš jo bandomas gauti vartotojo ID</li>
<li>Jei pavyksta, gražinamas vartotojo objektas (rastas pagal ID), jei
ne (pvz. jei žetono galiojimas pasibaigęs) - gražinama None.</li>
</ul>
</div>
</li>

<li><a id="orgbec25f2"></a>Slaptažodžio nunulinimo forma:<br />
<div class="outline-text-5" id="text-9-1-7-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fb4934;">class</span> <span style="color: #fabd2f;">SlaptazodzioAtnaujinimoForma</span><span style="color: #fe8019;">(</span>FlaskForm<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">slaptazodis</span> = PasswordField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Slapta&#382;odis'</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">patvirtintas_slaptazodis</span> = PasswordField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Pakartokite slapta&#382;od&#303;'</span>, validators=<span style="color: #cc241d;">[</span>DataRequired<span style="color: #b8bb26;">()</span>, EqualTo<span style="color: #b8bb26;">(</span><span style="color: #b8bb26;">'slaptazodis'</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">]</span><span style="color: #fe8019;">)</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #83a598;">submit</span> = SubmitField<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">'Atnaujinti Slapta&#382;od&#303;'</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Joje reikia tik patvirtinto slaptažodžio
</p>
</div>
</li>

<li><a id="org4313717"></a>Slaptažodžio nunulinimo puslapio html<br />
<div class="outline-text-5" id="text-9-1-7-4">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}
{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">form</span> <span style="color: #83a598;">method</span>=<span style="color: #b8bb26;">"POST"</span> <span style="color: #83a598;">action</span>=<span style="color: #b8bb26;">""</span>&gt;
            {{ form.hidden_tag() }}
            &lt;<span style="color: #b8bb26;">fieldset</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                &lt;<span style="color: #b8bb26;">legend</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"border-bottom mb-4"</span>&gt;Slapta&#382;od&#382;io pakeitimas&lt;/<span style="color: #b8bb26;">legend</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.slaptazodis.label(class="form-control-label") }}
                    {% if form.slaptazodis.errors %}
                        {{ form.slaptazodis(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.slaptazodis.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.slaptazodis(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
                &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                    {{ form.patvirtintas_slaptazodis.label(class="form-control-label") }}
                    {% if form.patvirtintas_slaptazodis.errors %}
                        {{ form.patvirtintas_slaptazodis(class="form-control form-control-lg is-invalid") }}
                        &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"invalid-feedback"</span>&gt;
                            {% for error in form.patvirtintas_slaptazodis.errors %}
                                &lt;<span style="color: #b8bb26;">span</span>&gt;{{ error }}&lt;/<span style="color: #b8bb26;">span</span>&gt;
                            {% endfor %}
                        &lt;/<span style="color: #b8bb26;">div</span>&gt;
                    {% else %}
                        {{ form.patvirtintas_slaptazodis(class="form-control form-control-lg") }}
                    {% endif %}
                &lt;/<span style="color: #b8bb26;">div</span>&gt;
            &lt;/<span style="color: #b8bb26;">fieldset</span>&gt;
            &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"form-group"</span>&gt;
                {{ form.submit(class="btn btn-outline-info") }}
            &lt;/<span style="color: #b8bb26;">div</span>&gt;
        &lt;/<span style="color: #b8bb26;">form</span>&gt;
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock content %}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org08525e3" class="outline-3">
<h3 id="org08525e3"><span class="section-number-3">9.2</span> Klaidų (404, 403, 500) puslapių kūrimas</h3>
<div class="outline-text-3" id="text-9-2">
</div>
<div id="outline-container-orgca2d26a" class="outline-4">
<h4 id="orgca2d26a"><span class="section-number-4">9.2.1</span> Sukuriame klaidų sugaudymo Flask funkcijas</h4>
<div class="outline-text-4" id="text-9-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #fabd2f;">@app.errorhandler</span><span style="color: #fe8019;">(</span>404<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">klaida_404</span><span style="color: #fe8019;">(</span>klaida<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"404.html"</span><span style="color: #fe8019;">)</span>, 404

<span style="color: #fabd2f;">@app.errorhandler</span><span style="color: #fe8019;">(</span>403<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">klaida_403</span><span style="color: #fe8019;">(</span>klaida<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"403.html"</span><span style="color: #fe8019;">)</span>, 403

<span style="color: #fabd2f;">@app.errorhandler</span><span style="color: #fe8019;">(</span>500<span style="color: #fe8019;">)</span>
<span style="color: #fb4934;">def</span> <span style="color: #b8bb26;">klaida_500</span><span style="color: #fe8019;">(</span>klaida<span style="color: #fe8019;">)</span>:
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fb4934;">return</span> render_template<span style="color: #fe8019;">(</span><span style="color: #b8bb26;">"500.html"</span><span style="color: #fe8019;">)</span>, 500
</pre>
</div>

<p>
Ant funkcijų turi būti spec. dekoratorius su paduotu klaidos kodu.
Gražinamas klaidos html puslapis ir klaidos kodas.
</p>
</div>
</div>

<div id="outline-container-org4ba8d8b" class="outline-4">
<h4 id="org4ba8d8b"><span class="section-number-4">9.2.2</span> Sukuriame html puslapius, kurie bus rodomi įvykus tam tikrai klaidai:</h4>
<div class="outline-text-4" id="text-9-2-2">
</div>
<ol class="org-ol">
<li><a id="org0e540ce"></a>404:<br />
<div class="outline-text-5" id="text-9-2-2-1">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Oops. Puslapis nerastas (404)</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
        &lt;<span style="color: #b8bb26;">p</span>&gt;&#352;is puslapis neegzistuoja. Pabandykite &#303;vesti kit&#261; adres&#261;&lt;/<span style="color: #b8bb26;">p</span>&gt;.
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</li>

<li><a id="orge130747"></a>403:<br />
<div class="outline-text-5" id="text-9-2-2-2">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">J&#363;s neturite teisi&#371; atlikti &#353;io veiksmo (403)</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
        &lt;<span style="color: #b8bb26;">p</span>&gt;Patikrinkite savo paskyr&#261; ir bandykite dar kart&#261;&lt;/<span style="color: #b8bb26;">p</span>&gt;.
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</li>

<li><a id="org94953ba"></a>500:<br />
<div class="outline-text-5" id="text-9-2-2-3">
<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}
    &lt;<span style="color: #b8bb26;">div</span> <span style="color: #83a598;">class</span>=<span style="color: #b8bb26;">"content-section"</span>&gt;
        &lt;<span style="color: #b8bb26;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Ka&#382;kas negerai (500)</span>&lt;/<span style="color: #b8bb26;">h1</span>&gt;
        &lt;<span style="color: #b8bb26;">p</span>&gt;Serveris laikinai neveikia. Bandykite v&#279;liau&lt;/<span style="color: #b8bb26;">p</span>&gt;.
    &lt;/<span style="color: #b8bb26;">div</span>&gt;
{% endblock %}
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org0f1d029" class="outline-3">
<h3 id="org0f1d029"><span class="section-number-3">9.3</span> Užduotis: Biudžeto programa su slaptažodžio keitimu ir klaidų puslapiais</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Į biudžeto programą įdėti šioje paskaitoje aptartas funkcijas:
slaptažodžio atnaujinimą, klaidų puslapius Tuos pačius dalykus galima
pritaikyti ir kitai kurtai Flask programai (pvz. prekių užsakymo,
egzaminavimo).
</p>

<p>
Atsakymas
</p>

<p>
Biudžeto programa su slaptažodžio atnaujinimu, klaidų puslapiais -
<a href="https://github.com/DonatasNoreika/biudzetas_treciadienis">https://github.com/DonatasNoreika/biudzetas_treciadienis</a>
</p>
</div>
</div>
<div id="outline-container-org5e049b3" class="outline-3">
<h3 id="org5e049b3"><span class="section-number-3">9.4</span> Projekto struktūrizavimas naudojant paketus</h3>
<div class="outline-text-3" id="text-9-4">
</div>
<div id="outline-container-org7ed1c8d" class="outline-4">
<h4 id="org7ed1c8d"><span class="section-number-4">9.4.1</span> Kaip geriau struktūrizuoti projektą?</h4>
<div class="outline-text-4" id="text-9-4-1">
<p>
Kad išvengtumėme netvarkos Flask projekte, galima kodą išskirstyti į
atskirus failus pagal paskirtį. Taip pat panaudoti paketus, siekant
sutvarkyti importavimo problemas.
</p>

<p>
Paketas - tai katalogas, esantis projekte, turinti init.py failą. Jame
dedame visus importus ir pagrindinius procesus, naudojamus visuose
kituose failuose.
</p>

<p>
Programoje rekomenduojama visus failą sudėti į vieną paketą su
programos pavadinimu. Išorėje palikti tik paleidžiamąjį failą (ten
dedamas Flask paleidimas) ir jį pervardinti, pavyzdžiui į run py.
</p>
</div>

<ol class="org-ol">
<li><a id="org16b41fe"></a>Projekto dalis rekomenduojama išskirstyti į tokias atskiras dalis (failus):<br />
<div class="outline-text-5" id="text-9-4-1-1">
<p>
init.py faile kviečiame visus importus, kurie bus bendrai
naudojami projekte. Taip pat Flask programos inicijavimas. Atkreipkite
dėmesį, kad kai kuriuos importus reikia dėti po app ar db inicijavimo,
kad nevyktų konfliktų.
</p>

<p>
forms.py - čia laikome viską, kas susiję su formomis (flask_wtf)
</p>

<p>
models.py - šiame faile saugome modelius - sqlalchemy klases
</p>

<p>
routes.py - čia keliauja visos Flask funkcijos (su @app.route
rekoratoriais ir panašios).
</p>
</div>
</li>
</ol>
</div>

<div id="outline-container-org6b9b261" class="outline-4">
<h4 id="org6b9b261"><span class="section-number-4">9.4.2</span> Užduotis: Biudžeto programos moduliarizavimas</h4>
<div class="outline-text-4" id="text-9-4-2">
<p>
Sutvarkyti savo biudžeto projektą pagal šioje paskaitoje pateiktas
rekomendacijas. Tą patį vertą padaryti ir su egzaminavimo programa.
</p>

<p>
Sutvarkyto biudžeto projekto pavyzdys - <a href="https://github.com/DonatasNoreika/biudzetas_20200402">https://github.com/DonatasNoreika/biudzetas_20200402</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org2765c1b" class="outline-2">
<h2 id="org2765c1b"><span class="section-number-2">10</span> Diegimas į serverį</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org6f89aad" class="outline-3">
<h3 id="org6f89aad"><span class="section-number-3">10.1</span> Virtualios aplinkos paruošimas</h3>
<div class="outline-text-3" id="text-10-1">
<p>
Diegsime Flask programą biudzetas į Linux Ubuntu serverį per sukurtą
vartotoją "vartotojas"
</p>
</div>

<div id="outline-container-org95123a9" class="outline-4">
<h4 id="org95123a9"><span class="section-number-4">10.1.1</span> Savo projekte sukuriame requirements.txt failą (žr. temą virtualios aplinkos)</h4>
<div class="outline-text-4" id="text-10-1-1">
<p>
Per FTP programą įsirašome savo flask programos katalogą į
<i>home/vartotojas</i>.
</p>

<p>
Pvz.: Iš Desktop katalogą biudzetas per WINSCP nukopijuojame į
<i>home/vartotojas</i>
</p>

<p>
Jei reikia, serveryje įdiegiame openssh:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ sudo apt install openssh-server
</pre>
</div>

<p>
Prisijungiame prie mūsų serverio su cmd (jei sukurtas vartotojas - per
jį, jei ne - per root):
</p>

<div class="org-src-container">
<pre class="src src-bash">C:\Users\Donoras&gt;ssh vartotojas@192.168.43.108
</pre>
</div>

<p>
Serveryje atnaujiname programas:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ sudo apt update &amp;&amp; apt upgrade
</pre>
</div>
</div>
</div>


<div id="outline-container-org96bb3f8" class="outline-4">
<h4 id="org96bb3f8"><span class="section-number-4">10.1.2</span> Susikuriame virtualią aplinką:</h4>
<div class="outline-text-4" id="text-10-1-2">
<p>
Įdiegiame pip:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ sudo apt install python3-pip
</pre>
</div>

<p>
Įdiegiame venv:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ sudo apt install python3-venv
</pre>
</div>

<p>
Sukuriame venv:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ python3 -m venv biudzetas/venv
</pre>
</div>

<p>
Aktyvuojame sukurtą aplinką:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ cd biudzetas/
vartotojas@ubuntu:~/biudzetas$ source venv/bin/activate
</pre>
</div>

<p>
Įdiegiame programas iš requirements.txt failo:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ pip install -r requirements.txt
</pre>
</div>

<p>
Nustatome app kintamąjį ir išbandome programą:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ export <span style="color: #83a598;">FLASK_APP</span>=run.py
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ flask run --host=0.0.0.0
</pre>
</div>

<p>
Galime kompiuterio naršyklėje užeiti į IP ir portą ir patikrinti, ar
veikia programa, pvz.: <a href="http://192.168.43.108:5000/">http://192.168.43.108:5000/</a>
</p>

<p>
Matome užrašą: WARNING: This is a development server. Do not use it in
a production deployment. Todėl toks paleidimas tinka tik kūrimo
tikslams. Normaliam veikimui serveryje mums reikės programų nginx ir
gunicorn.
</p>

<p>
Sustabdome procesą cmd programoje paspaudę CTRL+C
</p>
</div>
</div>
</div>
<div id="outline-container-orgbf6fc6f" class="outline-3">
<h3 id="orgbf6fc6f"><span class="section-number-3">10.2</span> nginx ir gunicorn konfigūracija</h3>
<div class="outline-text-3" id="text-10-2">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ cd
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ sudo apt install nginx
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ pip install gunicorn
</pre>
</div>
</div>

<div id="outline-container-org7f41cd0" class="outline-4">
<h4 id="org7f41cd0"><span class="section-number-4">10.2.1</span> Konfiguruojame ngnix:</h4>
<div class="outline-text-4" id="text-10-2-1">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ sudo rm /etc/nginx/sites-enabled/default
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ sudo nano /etc/nginx/sites-enabled/biudzetas
</pre>
</div>

<p>
Šiame faile įdedame tokį kodą:
</p>

<p>
Prie server_name įrašome savo serverio IP
</p>

<p>
Į location /static - kelia iki programos static katalogo
</p>

<div class="org-src-container">
<pre class="src src-bash">server <span style="color: #fe8019;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   listen 80;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   server_name 192.168.43.108;

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   location /static <span style="color: #cc241d;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #fe8019;">alias</span> /home/vartotojas/biudzetas/biudzetas/static;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cc241d;">}</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   location / <span style="color: #cc241d;">{</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   proxy_pass http://localhost:8000;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   include /etc/nginx/proxy_params;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   proxy_redirect off;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cc241d;">}</span>
<span style="color: #fe8019;">}</span>
</pre>
</div>

<p>
Perkrauname nginx:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ sudo systemctl restart nginx
</pre>
</div>

<p>
Jei naršyklėje atidarysime <a href="http://192.168.43.108/">http://192.168.43.108/</a>, pamatysime, kad
programa vis dar neveikia (nginx klaida)
</p>
</div>
</div>

<div id="outline-container-org4c96aca" class="outline-4">
<h4 id="org4c96aca"><span class="section-number-4">10.2.2</span> Konfiguruojame ir paleidžiame gunicorn:</h4>
<div class="outline-text-4" id="text-10-2-2">
<p>
Sužinome, kiek mūsų serveris turi branduolių:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ nproc --all
1
</pre>
</div>

<p>
Reiškia, paleisdami gunicorn, prie -w turėsime įrašyti 3 ((2 x branduolių_kiekis) + 1)
</p>

<p>
Paleidžiame gunicorn:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~$ cd biudzetas/
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ gunicorn -w 3 run:app
</pre>
</div>

<p>
Galime užeiti į naršyklę ir pažiūrėti, ar viskas veikia, pvz.: <a href="http://192.168.43.108/">http://192.168.43.108/</a>
</p>

<p>
Bėda, kad nutraukę gunicorn procesą, vėl neprieisime prie programos per naršyklę. Tam reikia įsidiegti ir sukonfiguruoti supervisor
</p>
</div>
</div>

<div id="outline-container-orgf1d0af5" class="outline-4">
<h4 id="orgf1d0af5"><span class="section-number-4">10.2.3</span> Konfiguruojame ir paleidžiame supervisor:</h4>
<div class="outline-text-4" id="text-10-2-3">
<p>
Įsidiegiame:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ sudo apt install supervisor
</pre>
</div>

<p>
Sukuriame konfiguracinį failą:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ sudo nano /etc/supervisor/conf.d/biudzetas.conf
</pre>
</div>

<p>
Į failą įrašome tokį kodą:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">[</span>program:biudzetas<span style="color: #fe8019;">]</span>
<span style="color: #83a598;">directory</span>=/home/vartotojas/biudzetas
<span style="color: #83a598;">command</span>=/home/vartotojas/biudzetas/venv/bin/gunicorn -w 3 run:app
<span style="color: #83a598;">user</span>=vartotojas
<span style="color: #83a598;">autostart</span>=true
<span style="color: #83a598;">autorestart</span>=true
<span style="color: #83a598;">stopasgroup</span>=true
<span style="color: #83a598;">killasgroup</span>=true
<span style="color: #83a598;">stderr_logfile</span>=/var/log/biudzetas/biudzetas.err.log
<span style="color: #83a598;">stdout_logfile</span>=/var/log/biudzetas/biudzetas.out.log
</pre>
</div>

<p>
Sukuriame aprašytus log failus:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ sudo mkdir -p /var/log/biudzetas
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ sudo touch /var/log/biudzetas/biudzetas.err.log
<span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ sudo touch /var/log/biudzetas/biudzetas.out.log
</pre>
</div>

<p>
Perkrauname supervisor:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #fe8019;">(</span>venv<span style="color: #fe8019;">)</span> vartotojas@ubuntu:~/biudzetas$ sudo supervisorctl reload
</pre>
</div>

<p>
Galime naršyklėje atsidaryti <a href="http://192.168.43.108/">http://192.168.43.108/</a>
</p>
</div>
</div>

<div id="outline-container-org8a798eb" class="outline-4">
<h4 id="org8a798eb"><span class="section-number-4">10.2.4</span> Padidiname atsiunčiamos nuotraukos dydžio limitą:</h4>
<div class="outline-text-4" id="text-10-2-4">
<p>
Atsidarome nginx konfiguracinį failą:
</p>


<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ sudo nano /etc/nginx/nginx.conf
</pre>
</div>

<p>
Jame pridedame eilutę client_max_body_size 5M:
</p>

<div class="org-src-container">
<pre class="src src-bash">http <span style="color: #fe8019;">{</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;">##</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">Basic Settings</span>
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;">##</span>

<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   sendfile on;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   tcp_nopush on;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   tcp_nodelay on;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   keepalive_timeout 65;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   types_hash_max_size 2048;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   client_max_body_size 5M;
<span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #cd5c5c; background-color: #3c3836;"> </span>   <span style="color: #928374;"># </span><span style="color: #928374;">server_tokens off;</span>
</pre>
</div>

<p>
Perkrauname nginx:
</p>

<div class="org-src-container">
<pre class="src src-bash">vartotojas@ubuntu:~$ sudo systemctl restart nginx
</pre>
</div>

<p>
VISKAS!
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<!-- bootstrap scripts -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
<script src="../scripts.js"></script>
</body>
</html>
</div>
</body>
</html>
